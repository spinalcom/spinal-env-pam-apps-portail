(self.webpackChunkspinal_env_pam_apps_portail_master=self.webpackChunkspinal_env_pam_apps_portail_master||[]).push([[77],{7785:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,".app[data-v-626f5be7]{--app-container-width: 40%;width:100%;height:100%}.app .selectors[data-v-626f5be7]{position:absolute;display:flex;justify-content:flex-end;top:5px;right:5px;height:60px;width:100%;border:1px solid #f5f5f5;border-radius:12px;z-index:82}.app .selectors .DButton[data-v-626f5be7]{width:60px;height:60px}.app .selectors .temporality[data-v-626f5be7]{position:relative;width:200px;height:60px}.app .selectors .space[data-v-626f5be7]{position:relative;width:40%;height:60px}.app .dataBody[data-v-626f5be7]{height:calc(100% - 90px);margin:80px 8px 0 8px}.app .dataBody .viewerContainer[data-v-626f5be7]{width:60%;height:100%;float:left;position:relative;transition:all 1s}.app .dataBody .viewerContainer-zero[data-v-626f5be7]{width:calc(100% - 2em) !important}.app .dataBody .viewerContainer-half[data-v-626f5be7]{width:50% !important}.app .dataBody .viewerContainer-invisible[data-v-626f5be7]{width:0% !important}.app .dataBody .appContainer[data-v-626f5be7]{width:var(--app-container-width);height:calc(100% - 60px);z-index:80;transition:all 1s;background-color:#f9f9f9}.app .dataBody .app-container-halfscreen[data-v-626f5be7]{width:50% !important}.app .dataBody .app-container-fullscreen[data-v-626f5be7]{width:100% !important}.app .dataBody .app-container-zero[data-v-626f5be7]{width:2em !important}.loading[data-v-626f5be7]{height:100%;display:flex;align-items:center;justify-content:center}",""]),t.default=s},422:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,"#app{font-family:Avenir,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:#2c3e50;background:rgba(0,0,0,0);height:100%;width:100%}html{overflow-y:hidden !important;background:rgba(0,0,0,0)}body{margin:0;width:100%;height:100vh;overflow-y:hidden;background:rgba(0,0,0,0)}.app-content{width:calc(100% - 16px);height:calc(100% - 80px);overflow-y:hidden;display:flex;position:relative;margin:80px 8px 8px 8px}.list-container{overflow-y:auto;height:calc(100% - 51px);padding:8px}.spinal-scrollbar::-webkit-scrollbar{width:8px;height:8px}.spinal-scrollbar::-webkit-scrollbar-thumb{-webkit-border-radius:5px;border-radius:5px;background:rgba(169,169,169,.9)}.spinal-scrollbar::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 3px rgba(0,0,0,.3);box-shadow:inset 0 0 3px rgba(0,0,0,.3);-webkit-border-radius:5px;border-radius:5px}.appContainer .dataContainer .calcul_content .calcul .select .v-text-field.v-text-field--solo .v-input__control{min-height:unset !important}.menu-wrapper{display:flex;justify-content:center;align-items:center}.bottom-container{position:absolute;bottom:0em;left:0em;padding:1em;display:flex;justify-content:space-between;align-items:flex-end;width:100%;height:100%}",""]),t.default=s},5442:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,".staggered-fade-item[data-v-46846356]{transition-timing-function:cubic-bezier(0.57, 0.06, 0, 1);transition-duration:500ms;transition-property:transform;opacity:0}.staggered-fade-enter[data-v-46846356],.staggered-fade-leave-to[data-v-46846356]{opacity:0;transform:translateY(-50px)}.card-list[data-v-46846356]{max-height:calc(100% - 64px);padding-top:10px;padding-bottom:10px;overflow:auto}.space-selector[data-v-46846356]{z-index:10;width:calc(100% - 0px);height:59px;float:right;border-radius:10px !important;overflow:hidden;transition:height .2s ease-in;box-shadow:none !important}.space-selector-container[data-v-46846356]{position:absolute;max-height:calc(100vh - 10px);width:100%;right:0;overflow:hidden}.space-selector-container.isopen[data-v-46846356]{width:100%}.space-selector-header[data-v-46846356]{display:flex;align-items:center;border-radius:0px;height:59px;background-color:#14202c;cursor:pointer}.space-selector-header-title[data-v-46846356]{width:calc(100% - 20px);display:flex;align-items:center;margin:0;font-weight:300;padding:8px;font-size:20px;color:#f5f5f5;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.space-selector-header-title-icon[data-v-46846356]{margin-top:5px;float:left;padding:0 10px;font-size:20px}.space-selector-open[data-v-46846356]{overflow-y:auto;max-height:calc(100vh - 20px)}.rotate-enabled[data-v-46846356]{transform:rotate(-180deg);transition:transform .3s ease-in}.card-hover[data-v-46846356]:hover{background-color:#444}[data-v-46846356] .v-btn--fab.v-size--default{height:49px;width:50px}[data-v-46846356] .v-application p{margin-bottom:0px !important}.spinal-scrollbar[data-v-46846356]::-webkit-scrollbar{width:0;height:1px}.spinal-scrollbar[data-v-46846356]::-webkit-scrollbar-thumb{-webkit-border-radius:5px;border-radius:5px;background:rgba(169,169,169,.9)}.spinal-scrollbar[data-v-46846356]::-webkit-scrollbar-track{-webkit-border-radius:5px;border-radius:5px}.legend[data-v-46846356]{color:#fff;font-size:9px;position:absolute;top:3px;left:11px;letter-spacing:1.1px}",""]),t.default=s},9890:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,"html{scroll-behavior:smooth;overflow:auto}",""]),t.default=s},1303:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,".space-selector-list-item[data-v-3540edfe]{display:flex !important;margin-right:10px;height:50px;background-color:#14202c;border:1px solid #bfbfbf;border-radius:6px;margin-bottom:0px;padding:0;color:#bfbfbf !important;margin-top:6px}.space-selector-list-item-angle[data-v-3540edfe]{margin-left:-11px;height:24px;background-color:rgba(0,0,0,0);border:1px solid #4b6079;margin-top:-23px;width:10px;border-right:none;border-top:none;position:absolute;border-radius:0 0 0 6px;pointer-events:none}.space-selector-list-item.space-selector-list-item-level-0+.space-selector-list-item-level-1[data-v-3540edfe],.space-selector-list-item.space-selector-list-item-level-1+.space-selector-list-item-level-2[data-v-3540edfe],.space-selector-list-item.space-selector-list-item-level-2+.space-selector-list-item-level-3[data-v-3540edfe],.space-selector-list-item.space-selector-list-item-level-3+.space-selector-list-item-level-4[data-v-3540edfe],.space-selector-list-item.space-selector-list-item-level-4+.space-selector-list-item-level-5[data-v-3540edfe],.space-selector-list-item.space-selector-list-item-level-5+.space-selector-list-item-level-6[data-v-3540edfe],.space-selector-list-item.space-selector-list-item-level-6+.space-selector-list-item-level-7[data-v-3540edfe],.space-selector-list-item.space-selector-list-item-level-7+.space-selector-list-item-level-8[data-v-3540edfe]{margin-top:-1px}.space-selector-list-item-angle-extend[data-v-3540edfe]{margin-left:-11px;height:50px;background-color:rgba(0,0,0,0);border:1px solid #4b6079;border-radius:6px;margin-top:-75px;width:10px;border-right:none;border-bottom:none;border-top:none;position:absolute;border-bottom-left-radius:0;border-bottom-right-radius:0;border-top-left-radius:0;pointer-events:none}.parent-link[data-v-3540edfe]{height:65px;background-color:rgba(0,0,0,0);border:1px solid #4b6079;border-radius:6px;margin-top:-45px;width:10px;border-right:none;border-bottom:none;border-top:none;position:absolute;border-bottom-left-radius:0;border-bottom-right-radius:0;border-top-left-radius:0;pointer-events:none}.color-square[data-v-3540edfe]{margin-left:8px;border-radius:2px;display:inline-block;position:absolute;height:16px;width:6px}.space-selector-list-item-isSelected[data-v-3540edfe]{background-color:#444}.actionsDiv[data-v-3540edfe]{display:flex;flex-direction:row;align-items:center}.space-selector-list-item.space-selector-list-item-isopen+.space-selector-list-item .space-selector-list-item-angle-extend[data-v-3540edfe]{display:none}",""]),t.default=s},7074:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,'[data-v-4b8e760a] .v-text-field.v-input--is-focused>.v-input__control>.v-input__slot:after{color:rgba(255,255,255,0) !important}[data-v-4b8e760a] .theme--light.v-text-field>.v-input__control>.v-input__slot:before{border-color:rgba(255,255,255,0) !important}.red-background[data-v-4b8e760a]{background-color:#fff !important;color:#14202c !important;border:1px solid #14202c !important}[data-v-4b8e760a] .theme--light.menuable__content__active{background-color:red !important;z-index:99999999 !important}[data-v-4b8e760a] .v-chip{height:22px !important;margin:3px !important;transform:translate(0, -10%);overflow:visible}[data-v-4b8e760a] .v-breadcrumbs__divider{background-color:red !important}[data-v-4b8e760a] .v-data-table__wrapper>table>thead>tr>th:nth-child(1){position:sticky;left:0;z-index:9}.blur-background[data-v-4b8e760a]{background-color:rgba(0,0,0,.528);top:0;left:0;position:fixed;width:100%;height:100%;z-index:99999;content:""}.custom-hover-color[data-v-4b8e760a]{background-color:#8ec4dd !important}tr .colortd.custom-hover-color[data-v-4b8e760a]{background-color:#9bdfff !important}[data-v-4b8e760a] .custom-hover-color{background-color:#64ceff !important}[data-v-4b8e760a] .v-breadcrumbs{padding:2px !important}.colortd[data-v-4b8e760a]{background-color:#c9e8ff}td[data-v-4b8e760a]{min-width:1em}.fixed-first-column table[data-v-4b8e760a]{position:relative}[data-v-4b8e760a] .v-data-footer{display:none}[data-v-4b8e760a] div.v-data-table__wrapper>table>thead>tr>th>i{display:none}.mouse[data-v-4b8e760a]{width:101%;height:50px;background-color:#fff;border-radius:5px;border:1px solid #000;padding-left:20px;font-size:17px;display:flex;align-items:center;cursor:pointer;transition:.5s;color:#2f2f2f}.animate[data-v-4b8e760a]{-webkit-animation:scale-in-ver-top-4b8e760a .3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;animation:scale-in-ver-top-4b8e760a .3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both}@-webkit-keyframes scale-in-ver-top-4b8e760a{0%{-webkit-transform:scaleY(0);transform:scaleY(0);-webkit-transform-origin:100% 0%;transform-origin:100% 0%;opacity:1}100%{-webkit-transform:scaleY(1);transform:scaleY(1);-webkit-transform-origin:100% 0%;transform-origin:100% 0%;opacity:1}}@keyframes scale-in-ver-top-4b8e760a{0%{-webkit-transform:scaleY(0);transform:scaleY(0);-webkit-transform-origin:100% 0%;transform-origin:100% 0%;opacity:1}100%{-webkit-transform:scaleY(1);transform:scaleY(1);-webkit-transform-origin:100% 0%;transform-origin:100% 0%;opacity:1}}[data-v-4b8e760a] .v-treeview-node__children{padding-left:20px}[data-v-4b8e760a] .v-treeview-node__root{position:relative;border-radius:5px;border:.2px solid #8f8f8f;max-height:20px !important;overflow:hidden;background-color:#fff}[data-v-4b8e760a] .v-treeview-node__root:hover{background-color:#eee;border:1px solid #535353}.fixed-first-column tbody td[data-v-4b8e760a]:first-child{position:sticky;left:0;z-index:1}[data-v-4b8e760a] .v-data-table__wrapper>table>tbody>tr:nth-child(1)>td:nth-child(1){position:sticky;left:0;z-index:1}.scrollable-table-container[data-v-4b8e760a]{overflow-x:auto}.fixed-first-column thead th[data-v-4b8e760a]:first-child{position:sticky;left:0;z-index:2;background-color:#fff}.select-attr[data-v-4b8e760a]{-webkit-animation:fade-in-4b8e760a 1.2s cubic-bezier(0.39, 0.575, 0.565, 1) both;animation:fade-in-4b8e760a 1.2s cubic-bezier(0.39, 0.575, 0.565, 1) both}@-webkit-keyframes fade-in-4b8e760a{0%{opacity:0}100%{opacity:1}}@keyframes fade-in-4b8e760a{0%{opacity:0}100%{opacity:1}}.line[data-v-4b8e760a]{position:relative;width:0;top:16px;height:1px;background-color:#8f8f8f;animation:expandLine-4b8e760a .5s forwards}@keyframes expandLine-4b8e760a{to{width:46px}}.font-table[data-v-4b8e760a]{font:normal normal normal 16px/13px Charlevoix !important;letter-spacing:1.1px;color:#14202c;opacity:1;box-shadow:none !important;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.hover-magnify[data-v-4b8e760a]:hover{background-color:#dbdada !important}.card-title[data-v-4b8e760a]{color:#214353 !important;font-size:20px !important}.text-start[data-v-4b8e760a]{justify-content:center;display:flex !important;flex-direction:row !important}.v-data-table[data-v-4b8e760a]{display:flex;flex-direction:column}[data-v-4b8e760a] .v-data-table__wrapper{flex-shrink:0;flex-grow:1;overflow-y:auto !important}[data-v-4b8e760a] th{height:48px !important;font-size:14px !important;color:#214353 !important}[data-v-4b8e760a] td{font-size:14px !important;color:#14202c !important;background-color:#f4f4f4;border-bottom:1px solid #fff !important;border-right:1px solid #fff !important}[data-v-4b8e760a] tr:hover td{cursor:pointer;background-color:#f0f0f0 !important}[data-v-4b8e760a] .v-icon__svg{fill:#214353 !important}[data-v-4b8e760a] .v-list .v-list-item--active,.v-list .v-list-item--active .v-icon[data-v-4b8e760a]{background-color:#2f5321 !important}[data-v-4b8e760a] .v-text-field.v-input--is-focused>.v-input__control>.v-input__slot:after{color:#214353}[data-v-4b8e760a] .v-list-item--link:before{background-color:#1500ff !important}[data-v-4b8e760a] .v-application .primary--text{color:#14202c !important;caret-color:#14202c !important;background-color:#1500ff !important}[data-v-4b8e760a] .v-data-footer__select{visibility:hidden}.title[data-v-4b8e760a]{letter-spacing:1.1px;color:#214353;opacity:1;font-size:20px !important}.text[data-v-4b8e760a]{font-size:14px;font-family:Charlevoix;letter-spacing:.7px;color:#214353;opacity:1;font-size:14px}.theme--light.v-data-table .v-data-footer[data-v-4b8e760a]{background:#7b5151 !important}[data-v-4b8e760a] .v-data-footer{width:100%;margin-right:0px !important;background:#fff !important;border-bottom-left-radius:10px;border-bottom-right-radius:0px}[data-v-4b8e760a] tr>th:first-child{border-top-left-radius:10px !important}[data-v-4b8e760a] tr>th:last-child{border-top-right-radius:0px !important}[data-v-4b8e760a] tr>td.text-start{display:flex;align-items:center}[data-v-4b8e760a] .v-data-table__wrapper::-webkit-scrollbar-thumb{background:#e8e8e8;border-top-right-radius:5px;border-bottom-right-radius:5px;border:1px solid #c3c3c3;transition:1s}[data-v-4b8e760a] .v-data-table__wrapper::-webkit-scrollbar{width:10px}[data-v-4b8e760a] .v-data-table__wrapper::-webkit-scrollbar-track{background:#fff}[data-v-4b8e760a] .v-data-table__wrapper::-webkit-scrollbar-thumb{background:#e8e8e8;border-top-right-radius:5px;border-bottom-right-radius:5px;border:1px solid #c3c3c3;transition:1s}[data-v-4b8e760a] .v-data-table__wrapper::-webkit-scrollbar-thumb:hover{background:#dedede}.min-width[data-v-4b8e760a]{width:min-content}',""]),t.default=s},7273:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,".entitie{text-align:center;transition:all .1s ease}.entitie:active{transform:scale(1.1)}.data-side{position:relative}.expander-wrapper{position:absolute;z-index:inherit;top:40vh;left:-1em}",""]),t.default=s},5780:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,".button-wrapper[data-v-3fac6a15]{height:15vh}.button-wrapper .buttons[data-v-3fac6a15]{display:flex;flex-direction:column;justify-content:space-between;align-items:center}",""]),t.default=s},934:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,'.list-wrapper[data-v-e2b16f44]{--global-font-size: 15px;--height-legend-list: 15em;--height-legend-action-bar: 2em;z-index:59;position:relative;height:fit-content;width:fit-content;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);border-radius:.5em;font-size:var(--global-font-size)}.list[data-v-e2b16f44]{background:rgba(255,255,255,.452);border-radius:.5em;padding:1.5em 1.5em 1.5em 1.5em;overflow:hidden;height:100%;width:100%;box-shadow:0px 10px 8px -5px rgba(0,0,0,.1);display:flex;justify-content:space-around;flex-direction:column;flex-wrap:wrap}.list .item[data-v-e2b16f44]{display:flex;justify-content:flex-start;align-items:center;height:1.5em;overflow-x:hidden;overflow-y:hidden;margin-bottom:.8em;cursor:pointer}.list .item .color[data-v-e2b16f44]{border-radius:.2em;border:.1em solid #000;width:2.5em !important;height:40%;box-shadow:0px 10px 8px -5px rgba(0,0,0,.1)}.list .item .title[data-v-e2b16f44]{margin-left:1.7em;text-align:start;font-size:.8em !important;font-family:"charlevoix" !important;color:#9e9e9e;font-weight:600}.list .item[data-v-e2b16f44]:last-child{margin-bottom:0}@keyframes slide-down-e2b16f44{0%{height:var(--height-legend-list) !important}100%{height:var(--height-legend-action-bar) !important}}@keyframes slide-up-keyframes-e2b16f44{from{height:var(--height-legend-action-bar) !important}100%{height:var(--height-legend-list) !important}}.slide-down-anim[data-v-e2b16f44]{animation:slide-down-e2b16f44 1s both !important}.slide-up-anim[data-v-e2b16f44]{animation:slide-up-keyframes-e2b16f44 1s both !important}',""]),t.default=s},3787:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,".v-icon[data-v-76037cdc]{cursor:pointer;transition:all .2s}.v-icon[data-v-76037cdc]:active{transform:scale(1.4)}h5[data-v-76037cdc]{margin-top:1.5em;text-align:center;font-weight:100;font-style:italic}.text-wrapper[data-v-76037cdc]{display:flex;justify-content:flex-start;align-items:center;padding:0;margin:auto 0;height:100%;width:100%}.v-list[data-v-76037cdc]{overflow-y:auto}ul[data-v-76037cdc]{padding-left:0 !important}.list-enter-active[data-v-76037cdc],.list-leave-active[data-v-76037cdc]{transition:all 80ms}.list-enter[data-v-76037cdc],.list-leave-to[data-v-76037cdc]{opacity:0;transform:translateY(30px)}.helper[data-v-76037cdc]{width:100%;height:100%;transform:translateY(-20px);display:flex;justify-content:center;align-items:center;color:#acacac;text-align:center;padding:0 20px}.text-h5[data-v-76037cdc]{text-align:center;display:block;width:100%}.scroll-list[data-v-76037cdc]{overflow-y:auto;height:400px}",""]),t.default=s},4832:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,'.menu-wrapper[data-v-084ba5c6]{--global-font-size: 15px;--cell-max-height: 4em;--cell-max-width: 8em;--cell-main-height: 4em;--cell-main-width: 4em;--cell-z-index: 60;--component-z-index: 59;--menu-padding-x: 0.4em;--menu-padding-y: 1em;border-radius:.6em;background-color:#fff;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);padding:var(--menu-padding-x) var(--menu-padding-y);width:fit-content;position:relative;z-index:var(--component-z-index);font-size:var(--global-font-size)}.menu-wrapper .v-icon[data-v-084ba5c6]{font-size:2em !important}.menu-wrapper .menu[data-v-084ba5c6]{height:min-content;display:flex;flex-direction:row;flex-wrap:nowrap;height:var(--cell-max-height);max-height:var(--cell-max-height)}.menu-wrapper .menu .cell[data-v-084ba5c6]{height:inherit;max-height:inherit;display:grid;grid-template-columns:1fr;grid-template-rows:2fr 1fr;grid-column-gap:0;grid-row-gap:0;width:var(--cell-max-width);max-width:var(--cell-max-width);background-color:rgba(0,0,0,0);cursor:pointer;z-index:var(--cell-z-index)}.menu-wrapper .menu .cell .icon[data-v-084ba5c6]{display:flex;justify-content:center;align-items:center;height:100%;width:100%;transition:transform background 400ms ease;transform:scale(1.2)}.menu-wrapper .menu .cell .icon[data-v-084ba5c6]:hover{transform:scale(1.3)}.menu-wrapper .menu .cell .icon[data-v-084ba5c6]:hover::after{content:"";position:absolute;background:rgba(128,128,128,.438)}.menu-wrapper .menu .cell .icon[data-v-084ba5c6]:active,.menu-wrapper .menu .cell .icon[data-v-084ba5c6]:focus{transform:scale(1.1)}.menu-wrapper .menu .cell .text[data-v-084ba5c6]{display:flex;align-items:flex-start;justify-content:center;height:100%;width:100%;font-size:.9em;font-weight:600;font-family:"Charlevoix"}.menu-wrapper .cell-main[data-v-084ba5c6]{display:flex;margin:0 1em;justify-content:center;align-items:center;width:var(--cell-main-width);height:var(--cell-main-height);background:#000;transform:translateY(-2.5em) rotate(45deg);border-radius:.7em;transition:transform 200ms ease;cursor:pointer;z-index:var(--cell-z-index)}.menu-wrapper .cell-main[data-v-084ba5c6]:hover{transform:translateY(-2.5em) rotate(45deg) scale(1.1)}.menu-wrapper .cell-main[data-v-084ba5c6]:active,.menu-wrapper .cell-main[data-v-084ba5c6]:focus{transform:translateY(-2.5em) rotate(45deg) scale(0.9)}.menu-wrapper .cell-main .icon[data-v-084ba5c6]{transform:rotate(-45deg)}',""]),t.default=s},6849:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,".h-60{height:60% !important}.w-30{width:33.3% !important}.appear-custom{opacity:0;animation-fill-mode:forwards}.fadeInLeft0{animation:fadeInLeft .3s 0s}.fadeInLeft1{animation:fadeInLeft .3s .2s}.fadeInLeft2{animation:fadeInLeft .3s .4s}",""]),t.default=s},9516:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,'.content-wrapper[data-v-2febee4c]{height:70vh;width:100%;margin:0 auto;display:flex;flex-direction:row;flex-wrap:nowrap;overflow-x:hidden}.content-wrapper .first-view[data-v-2febee4c]{width:100%;display:grid;grid-template-rows:.6fr 3fr .1fr;grid-template-columns:1fr;row-gap:0em;column-gap:0em}.content-wrapper .first-view .body-wrapper[data-v-2febee4c]{height:100%;max-height:100%}.content-wrapper .first-view .action-wrapper .search-wrapper[data-v-2febee4c]{width:20em}.content-wrapper .bg-red[data-v-2febee4c]{background:red}.content-wrapper .second-view[data-v-2febee4c]{display:block;height:100%;width:100%;column-gap:1em}.content-wrapper .second-view .select-grid[data-v-2febee4c]{order:-1;display:flex;flex-direction:column}.content-wrapper .second-view .select-grid v-select[data-v-2febee4c]{margin-top:2em}.content-wrapper .second-view .group-picker-wrapper[data-v-2febee4c]{order:1;height:fit-content}.content-wrapper .second-view .recap[data-v-2febee4c]{border:.2em dashed rgba(0,0,0,.3);height:97%;display:grid;grid-template-rows:1fr 4fr 1fr}.content-wrapper .second-view .recap .body[data-v-2febee4c]{font-family:"Charlevoix"}.content-wrapper .second-view .recap .body .assignation[data-v-2febee4c],.content-wrapper .second-view .recap .body .application[data-v-2febee4c]{padding-left:2em}.content-wrapper .second-view .recap .body .assignation .assignation-table[data-v-2febee4c]{display:grid;grid-template-columns:1fr 2fr;grid-template-rows:1fr 1fr 1fr;row-gap:.8em}.content-wrapper .second-view .recap .body .assignation .assignation-table .text-wrapper[data-v-2febee4c]{display:flex;justify-items:flex-start;align-items:flex-end}.content-wrapper .second-view .recap .body .assignation .assignation-table .select-wrapper[data-v-2febee4c]{width:15em}.content-wrapper .second-view .recap .body .bg-black[data-v-2febee4c]{background-color:#000;color:#fff;padding:.2em;border-radius:.4em}.content-wrapper .second-view .recap .body .underlined[data-v-2febee4c]{text-decoration:underline .1em #000}.search-bar-wrapper[data-v-2febee4c]{display:grid;grid-template-columns:3fr 1fr;row-gap:0px;column-gap:0px;background-color:#00ffd0}.search-bar-wrapper .text-field-wrapper[data-v-2febee4c]{display:flex;justify-content:center;align-items:center;height:100%}.search-bar-wrapper .button-wrapper[data-v-2febee4c]{background-color:green;display:flex;justify-content:center;align-items:center;height:100%}',""]),t.default=s},425:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,".content{overflow-x:hidden}",""]),t.default=s},5030:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,".list-enter-active[data-v-4367b94a],.list-leave-active[data-v-4367b94a]{transition:all .8s}.list-enter[data-v-4367b94a],.list-leave-to[data-v-4367b94a]{opacity:0;transform:translateY(100%);position:absolute}.list-move[data-v-4367b94a]{transition:transform .5s}.item-row[data-v-4367b94a]{display:table-row}.chip-legend-item[data-v-4367b94a]{width:.5em;height:3em;position:absolute;top:calc(50% - 1em);left:-14px;border-radius:.5em;height:100%;display:flex;justify-content:center;align-items:center}.bold-cell[data-v-4367b94a]{font-weight:900;position:relative}.greyed[data-v-4367b94a]{color:var(--mdc-theme-primary) !important;opacity:.35;background-color:rgba(0,0,0,0) !important}.cursor-pointer[data-v-4367b94a]{cursor:pointer}",""]),t.default=s},8164:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,'.sub-title-content[data-v-e815e0ee]{font-size:.3em;margin-top:.5em}.name-category[data-v-e815e0ee]{font-size:.3em;background-color:var(--mdc-theme-primary);color:#f9f9f9;padding:.2em;border-radius:.2em}.select-wrapper[data-v-e815e0ee]{width:100%;margin-top:2em}.z-index-60[data-v-e815e0ee]{z-index:160}.grid-cont[data-v-e815e0ee]{--global-font-size: 16px;display:grid;grid-template-columns:1fr 0fr;grid-column-gap:0px;grid-row-gap:0px;height:100%;transition:all .1s;background-color:#f9f9f9;overflow-x:hidden;color:var(--mdc-theme-primary);font-size:var(--global-font-size)}.grid-fullscreen[data-v-e815e0ee]{grid-template-columns:1fr 1fr !important}.grid-fullscreen .radar-fullscreen[data-v-e815e0ee]{height:90%;display:flex;justify-content:center;align-items:center}.component-wrapper[data-v-e815e0ee]{display:grid;grid-template-columns:1fr;grid-template-rows:1fr 4fr .3fr;padding:2em;position:relative;background-color:#f9f9f9;height:100%;overflow:hidden}.component-wrapper .data-table-wrapper[data-v-e815e0ee]{height:100%;overflow-y:hidden;overflow-x:hidden;font-family:"Charlevoix" !important}.component-wrapper .data-table-wrapper tbody td[data-v-e815e0ee]{font-size:2em !important}.component-wrapper .header-wrapper[data-v-e815e0ee]{display:block;height:fit-content;height:11em}.component-wrapper .header-wrapper .header[data-v-e815e0ee]{display:grid;grid-template-columns:1fr 1fr}.component-wrapper .header-wrapper .header .title-wrapper[data-v-e815e0ee]{display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-start}.component-wrapper .header-wrapper .header .title-wrapper .title[data-v-e815e0ee]{position:relative;font-family:"charlevoix" !important;font-weight:900;font-size:3em !important;line-height:1em;text-transform:uppercase}.component-wrapper .header-wrapper .header .title-wrapper .title .tooltip[data-v-e815e0ee]{position:absolute;top:-0.6em;right:-0.9em}.component-wrapper .header-wrapper .header .info-wrapper[data-v-e815e0ee]{display:flex;flex-direction:column;flex-wrap:wrap;align-items:flex-end;position:relative}.component-wrapper .header-wrapper .header .info-wrapper .area-wrapper[data-v-e815e0ee]{display:flex;flex-direction:column;justify-content:center}.component-wrapper .header-wrapper .header .info-wrapper .area-wrapper .area[data-v-e815e0ee]{display:inline-flex;flex-direction:row;justify-content:flex-end;flex-wrap:nowrap;align-items:baseline;padding:0 .4em;transition:.5s all}.component-wrapper .header-wrapper .header .info-wrapper .area-wrapper .area .value[data-v-e815e0ee]{font-family:var(--main-font) !important;font-weight:900;font-size:2.9em !important}.component-wrapper .header-wrapper .header .info-wrapper .area-wrapper .area .unit[data-v-e815e0ee]{margin-left:10px;color:gray;font-weight:600}.component-wrapper .header-wrapper .header .info-wrapper .area-wrapper .separator-wrapper[data-v-e815e0ee]{display:flex;justify-content:flex-end;padding:0 .3em}.component-wrapper .header-wrapper .header .info-wrapper .area-wrapper .separator-wrapper .separator[data-v-e815e0ee]{width:50%;height:.2em;background-color:gray}.component-wrapper .header-wrapper .header .info-wrapper .gain-wrapper[data-v-e815e0ee]{padding:0 .5em;display:inline-flex;flex-wrap:nowrap;align-items:flex-start}.component-wrapper .body-wrapper .component-actions-wrapper[data-v-e815e0ee]{display:flex;flex-direction:column;width:100%;padding:0em 0}.component-wrapper .body-wrapper .component-actions-wrapper .actions[data-v-e815e0ee],.component-wrapper .body-wrapper .component-actions-wrapper .categories-wrapper[data-v-e815e0ee]{margin-top:0em;display:grid;grid-template-columns:3fr 1fr;grid-template-rows:1fr;grid-column-gap:.5em;grid-row-gap:0px}.component-wrapper .body-wrapper .component-actions-wrapper .actions[data-v-e815e0ee]{margin:1em 0}.component-wrapper .subtitle-wrapper[data-v-e815e0ee]{margin-top:.7em;font-family:"Charlevoix"}.component-wrapper .footer-wrapper[data-v-e815e0ee]{display:flex;justify-content:flex-end}.component-wrapper .footer-wrapper .footer[data-v-e815e0ee]{margin-top:.5em;display:flex;justify-content:space-between;align-items:flex-end;width:100%}.component-wrapper .v-btn[data-v-e815e0ee]{margin-left:1em}.component-wrapper .gain-cell[data-v-e815e0ee]{display:inline-flex;flex-direction:row;flex-wrap:nowrap;justify-content:center;align-items:center}.component-wrapper .greyed[data-v-e815e0ee]{color:var(--mdc-theme-primary) !important;opacity:.35;background-color:rgba(0,0,0,0) !important}.component-wrapper .elevation[data-v-e815e0ee]{box-shadow:0px 10px 8px -5px rgba(0,0,0,.1)}.component-wrapper .extend[data-v-e815e0ee]{height:100%}.component-wrapper .highlighted-row[data-v-e815e0ee]{background-color:gray !important;color:#fff}.component-wrapper .normal-row[data-v-e815e0ee]{background-color:green}.component-wrapper .bold-element[data-v-e815e0ee]{font-weight:600}.component-wrapper .bold-darkgrey[data-v-e815e0ee]{font-weight:900;text-transform:uppercase;color:#a9a9a9}.component-wrapper .charlevoix[data-v-e815e0ee]{font-family:"Charlevoix"}.component-wrapper .radar-wrapper[data-v-e815e0ee]{display:flex;justify-content:center;align-items:center;max-height:60vh;height:90%;width:100%}.component-wrapper .big-radar[data-v-e815e0ee]{height:100%}.component-wrapper .toggle-group[data-v-e815e0ee]{display:flex;flex-direction:row;flex-wrap:nowrap;width:10em;justify-content:space-around}.component-wrapper .mini-text[data-v-e815e0ee]{font-size:.6em !important}.component-wrapper .icon-fullscreen[data-v-e815e0ee]{display:inline-flex !important;position:absolute;right:1em;top:1em;z-index:20;cursor:pointer}.chips-legend-container[data-v-e815e0ee]{position:relative}.chip-legend-item[data-v-e815e0ee]{width:.5em;height:3em;position:absolute;top:calc(50% - 1em);left:.2em;border-radius:.5em;height:100%;display:flex;justify-content:center;align-items:center}',""]),t.default=s},4690:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,'body[data-v-60c833eb]{--color1: black;--color2: white}.con[data-v-60c833eb]{background:gray;height:2.4em;width:4em;border-radius:4em;display:flex;justify-content:flex-start;align-items:center;flex-direction:row;flex-wrap:nowrap;overflow:hidden;padding:.05em .1em;border:.2em solid #000;cursor:pointer}.con .ball[data-v-60c833eb]{background:gray;height:1.9em;width:1.9em;border-radius:3em;display:flex;justify-content:center;align-items:center}.con .ball .text[data-v-60c833eb]{height:100%;width:100%;display:flex;font-size:1em;color:#fff;justify-content:center;align-items:center;transform:all .5s ease;font-family:"charlevoix"}',""]),t.default=s},5702:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,'body[data-v-7de34bc7]{--color1: black;--color2: white}.con[data-v-7de34bc7]{background:#fff;height:2.4em;width:2.4em;border-radius:4em;display:flex;justify-content:flex-start;align-items:center;flex-direction:row;flex-wrap:nowrap;overflow:hidden;padding:.05em .1em;border:.15em solid #000;cursor:pointer}.con .text[data-v-7de34bc7]{height:100%;width:100%;display:flex;font-size:1em;color:#fff;justify-content:center;align-items:center;transform:all .5s ease;font-family:"charlevoix"}',""]),t.default=s},9424:function(e,t,i){"use strict";i.r(t);var r=i(3623),o=i.n(r),a=i(2696),s=i.n(a)()(o());s.push([e.id,".viewer-div-container>.adsk-viewing-viewer{background:none !important;position:relative}.adsk-viewing-viewer .canvas-wrap div{pointer-events:auto}",""]),t.default=s},5459:function(e,t,i){"use strict";var r={};i.r(r),i.d(r,{hS:function(){return l},vQ:function(){return n},Gq:function(){return A},g3:function(){return re},Wp:function(){return $}}),i(3104);var o=i(1676),a=i.n(o);class s{_apiUrl;axiosInstance=a().create({baseURL:this.apiUrl});get apiUrl(){return`${s.#e?._apiUrl}${s.#e?._apiUrl?.endsWith("/")?"":"/"}`}constructor(e=""){this._apiUrl=e,this.axiosInstance.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.common.Authorization=`Bearer ${t}`),e}))}static#e;static getInstance(e){return s.#e||(e="http://localhost:2023",console.log("API URL = ",e),s.#e=new s(e)),s.#e}createUrl(e){return e.startsWith("/")&&(e=e.substring(1)),this.apiUrl+e}createUrlWithPlatformId(e,t){return t.startsWith("/")||(t="/"+t),`${this.apiUrl}api/v2/building/${e}${t}`}get=this.axiosInstance.get;post=this.axiosInstance.post;put=this.axiosInstance.put;delete=this.axiosInstance.delete;async*createIteratorCall(e,...t){const i=await e(...t);for(;;)yield i}getIdCurrentBuilding(){return window.localStorage.getItem("idBuilding")||""}}var n,l,c=i(8649),d=i(9904),p=i(1361),u=i(5331),h=i(1626),m=function(){var e=this,t=e._self._c;return e._self._setupProxy,e.pageSate===e.PAGE_STATES.loaded?t(d.A,{staticClass:"app"},[e.showNomenclatureModale?t("NomenclatureModale",{ref:"nomenclatureModale",attrs:{showModal:e.showNomenclatureModale},on:{close:e.closeModaleNomenclature}}):e._e(),e._v(" "),e.showModalEditGroup?t("ModaleEditGroup",{ref:"editGroupModale",attrs:{showModal:e.showModalEditGroup},on:{activateSpaceAssignation:e.activateSpaceAssignation,activateNomenclatureModale:e.activateNomenclatureModale,close:e.closeModaleEditGroup}}):e._e(),e._v(" "),t(u.A,{attrs:{value:e.showModalEditGroup||e.showNomenclatureModale}}),e._v(" "),t("div",{staticClass:"selectors"},[t("div",{staticClass:"DButton"},[t("ScDownloadButton",{attrs:{fileName:"insight_data",csv:!0,data:e.getDataFormatted()}})],1),e._v(" "),t("div",{staticClass:"space"},[t("space-selector",{ref:"space-selector",attrs:{open:e.openSpaceSelector,maxDepth:2,GetChildrenFct:e.onSpaceSelectOpen,label:"ESPACE",spaceSelectorItemButtons:e.spaceSelectorButtons,viewButtonsType:e.config.viewButtons},on:{"update:open":function(t){e.openSpaceSelector=t},onActionClick:e.onActionClick},model:{value:e.selectedZone,callback:function(t){e.selectedZone=t},expression:"selectedZone"}})],1)]),e._v(" "),t("div",{staticClass:"dataBody"},[t("viewerApp",{staticClass:"viewerContainer",class:e.classViewerContainer}),e._v(" "),t("div",{staticClass:"bottom-container"},[t("div",{staticClass:"legend-wrapper"},["full"!==e.currentExpansionMode?t("LegendVue",{directives:[{name:"show",rawName:"v-show",value:"zero"!==e.currentExpansionMode,expression:"currentExpansionMode !== 'zero'"}],attrs:{listItem:e.legendSpaceAssignation}}):e._e()],1),e._v(" "),t("div",{staticClass:"menu-wrapper"},["full"!==e.currentExpansionMode?t("MenuV1",{on:{clickFirstCell:e.openModaleEditGroup,clickSecondCell:e.openNomenclatureModale,clickMainCell:e.toggleHomeMode}}):e._e()],1),e._v(" "),t("dataSideApp",{ref:"dataSideApp",staticClass:"appContainer",class:e.classDataSide,attrs:{config:e.config,selectedZone:e.selectedZone,data:e.displayedData,selectedEntities:e.selectedEntities,selectEntity:e.selectRoom},on:{clickOnDataView:e.onDataViewClicked},scopedSlots:e._u([{key:"expander",fn:function(){return[t("Expansion",{attrs:{iconLeft:"mdi-chevron-left",iconRight:"mdi-chevron-right"},on:{updateExpansion:e.updateExpansion}})]},proxy:!0},{key:"body",fn:function(){return[t("RoomsGroupTable",{ref:"roomsGroupTable"})]},proxy:!0}],null,!1,605850977)})],1)],1)],1):e.pageSate===e.PAGE_STATES.loading?t(p.A,{staticClass:"loading",attrs:{fluid:""}},[t(h.A,{attrs:{size:70,width:3,color:"purple",indeterminate:""}})],1):e._e()};m._withStripped=!0;class g{}class f extends g{_groupTree=[];async loadData(e){return new Promise(((t,i)=>{0===e.length&&i(new Error("[GroupWithChildren] => (loadData)")),this._groupTree=e,t("Success")}))}async addNewItem(e,t){return new Promise(((i,r)=>{e.idIndexesFromRoot=void 0===t?[this._groupTree.length]:[...t.idIndexesFromRoot,t.children.length],e.id=Date.now(),e.children=[],e.operation="create",t?t.children.push(e):this._groupTree.push(e),i(e)}))}async editItem(e,t){return new Promise(((i,r)=>{const o=this.findItemInTree(t,this._groupTree);e&&o||r(new Error("[GroupWithChildren] => (editItem)")),Object.assign(o,e),o.operation="update",i(o)}))}async deleteItem(e){return new Promise(((t,i)=>{const r=this.findItemInTree(e,this._groupTree);void 0===r&&(e.display=!1,i(new Error("Impossible de supprimer l'élément"))),r.display=!1,r.operation="delete",t(r)}))}findItemInTree(e,t){let i,r=[];if(e&&e.idIndexesFromRoot&&(r=e.idIndexesFromRoot,0!==r.length)){i=t.at(r[0]);for(const[e,t]of r.entries()){if(!i)return;0!==e&&(i=i.children.at(t))}return i}}getTree(){return this._groupTree}getPathItem(e,t){let i;const r=[],o=t&&t.length>0?t:this._groupTree;let a;if(!e||!e.idIndexesFromRoot||0===e.idIndexesFromRoot.length)return[];i=o[e.idIndexesFromRoot[0]],r.push(i);for(const[t,o]of e.idIndexesFromRoot.entries())if(0!==t){if(a=i.children.at(o),!a)break;r.push(a),i=a}return r}getParentItem(e,t){const i=t&&t.length>0?t:this._groupTree,r=this.getPathItem(e,i);if(!(r.length<2))return r.at(r.length-2)}}!function(e){e[e.GRP_CONTEXT=0]="GRP_CONTEXT",e[e.GRP_CATEGORY=1]="GRP_CATEGORY",e[e.GRP_GROUP=2]="GRP_GROUP",e[e.ROOM=3]="ROOM",e[e.GRP_NONE=5]="GRP_NONE"}(n||(n={})),function(e){e[e.API_CREATION=0]="API_CREATION",e[e.API_UPDATE=1]="API_UPDATE",e[e.API_DELETION=2]="API_DELETION"}(l||(l={}));var v=i(3161);const _=v.an.makeFactory({name:"Default",min:"0",max:"0",type:"number",value:"",category:"Spatial",displayName:"Default",id:Date.now(),comparaison:"gt"}),y=v.an.makeFactory({value:0,percentage:0}),b=v.an.makeFactory({type:-1,color:"#000000",icon:"mdi-account",verb:0,title:"Empty Title",idIndexesFromRoot:[],children:[],id:-1,display:!1,operation:"create"}),w=v.an.makeFactory({create:0,read:0,delete:0,update:0,deleteByAnother:0,readByAnother:0}),I=(v.an.makeFactory({id:-1,operations:w.build()}),v.an.makeFactory({id:v.__((()=>Date.now())),title:"",children:[],display:!0,tmp:!1,state:["AddedFromClient"],gainKpi:y.build({}),area:0,newArea:0,type:0,idIndexesFromRoot:[],operations:"Not-assigned",previousOperations:"Not-assigned",previousOpsItems:[],floorId:-1,floorName:"Undefined",color:"#f8f8f8",parentId:-1,parentTitle:"",grandParentId:-1,grandParentTitle:"",colorOperationBefore:"",colorOperationAfter:""})),x=v.an.makeFactory({title:"Meaning",color:"black",id:Date.now(),type:"Not-assigned"});class A extends f{_apiInstance;_groupToDisplay;_nbGroup=0;_selectedItems=[void 0,void 0,void 0];_genericErrMsg;constructor(e,t){super(),this._apiInstance=e,this._nbGroup=t,this._genericErrMsg="Une erreur est survenue",this._groupToDisplay=[]}async loadData(){return new Promise(((e,t)=>{this._apiInstance.getGroupContextTree().then((t=>e(super.loadData(t)))).catch((e=>{console.error(e),t(new Error("[GroupCgc] => Erreur loading data ..."))}))}))}async addNewItem(e,t){let i;return new Promise(((r,o)=>{void 0===e.type&&o(Error(this._genericErrMsg)),t=e.type===n.GRP_CONTEXT?void 0:this._selectedItems.find((t=>t?.type===e.type-1)),super.addNewItem(e,t).then((e=>i=e)).then((()=>this.applyBusinessRules(i,l.API_CREATION))).then((e=>this._apiInstance.createGenericRequest(e,l.API_CREATION,this.getPathItem(e)))).then((e=>{this.checkErrorResponse(e),i.title=e.data?.name??this._genericErrMsg,i.id=e.data?.dynamicId??-1,i.display=!0,r(i)})).catch((e=>{super.deleteItem(i).then((t=>{o(new Error(e))})).catch((e=>{o(new Error(e))}))}))}))}async applyBusinessRules(e,t){const i=[this.checkAlreadyExistingName];let r;return new Promise(((o,a)=>{e||a("[Error] Item non definie"),this.assignDefaultValue(e).then((s=>{e.title=s;for(const o of i)r=o.bind(this)(e,t),(r instanceof Error||"Success"!==r)&&a(new Error(r));o(e)})).catch((e=>{a(new Error(e))}))}))}async deleteItem(e){return new Promise(((t,i)=>{super.deleteItem(e).then((e=>this.deleteItemChildRecursive(e))).then((e=>this.checkValidSelected())).then((()=>t(e))).catch((e=>{i(new Error(e))}))}))}async editItem(e,t){let i;return new Promise(((r,o)=>{super.editItem(e,t).then((e=>this.applyBusinessRules(e))).then((e=>i=e)).then((e=>this._apiInstance.createGenericRequest(e,l.API_UPDATE,this.getPathItem(e)))).then((e=>this.checkErrorResponse(e))).then((()=>r(i))).catch((e=>{super.editItem(t,t).then((()=>{o(e)}))}))}))}get groupToDisplay(){return this._groupToDisplay}reloadGroupToDisplay(){const e=Array(this._nbGroup).fill([]),t=e;let i,r;if(void 0===this._groupTree)return e;t[0]=[...this._groupTree];for(const[e,o]of this._selectedItems.entries()){if(o){if(r=this.findItemInTree(o,this._groupTree),!r?.display)break;i=r.children}else i=[];i||=[],e+1<this._nbGroup&&(t[e+1]=i)}return this._groupToDisplay=t,this._groupToDisplay}selectItem(e){return e?(this.saveSelected(e),this.checkValidSelected(),"Success"):"Failure"}getSelected(){return this._selectedItems}checkErrorResponse(e){if(200!==e?.status)throw new Error(this._genericErrMsg);return"Success"}async assignDefaultValue(e){let t=e.title;const i=b.build({...e,idIndexesFromRoot:e.idIndexesFromRoot});return new Promise(((r,o)=>{(!e||e.title.length>0)&&r(e.title);for(let e=0;e<100;e+=1)t="Nouveau groupe-{index}".replace("{index}",e.toString()),i.title=t,"Success"===this.checkAlreadyExistingName(i)&&r(t);r(e.title)}))}checkAlreadyExistingName(e,t){const i=this.getPathItem(e),r=i.findIndex((t=>t.id===e.id));let o,a=[];if(0===i.length)a=this._groupTree;else{if(-1===r)return e.display=!1,"Error";if(a=0===r?this._groupTree:i.at(r-1)?.children,!a)return"Error"}return o=a.find((t=>t.title.trim()===e.title.trim()&&t.id!==e.id&&t.display)),o?(t===l.API_CREATION&&(e.display=!1),new Error("Un élément porte déjà ce nom")):"Success"}checkValidSelected(){let e="Failure",t=[];if(this._selectedItems.length!==this._nbGroup)return this.resetSelectedItem(),"Error";for(const[i,r]of this._selectedItems.entries())if(t=this.buildResetCode(i),r&&(e=this.checkValidSelectedItem(r,...t),"Success"!==e))return"Failure";return"Success"}async deleteItemChildRecursive(e){const t=[];let i,r;return new Promise(((o,a)=>{for(const o of e.children)this.deleteItemChildRecursive(o),r=this.getPathItem(o),r&&(i=this._apiInstance.createGenericRequest(o,l.API_DELETION,r),t.push(i));r=this.getPathItem(e),i=this._apiInstance.createGenericRequest(e,l.API_DELETION,r),t.push(i),Promise.all(t).catch((e=>{this.checkErrorResponse(e)})),o(e)}))}resetSelectedItem(...e){let t=0;const i=Array(this._nbGroup).fill(void 0);if(e.length!==this._nbGroup)return this._selectedItems=i,"Error";for(const[i,r]of this._selectedItems.entries())t=e.at(i),this._selectedItems[i]=0===t?r:void 0;return"Success"}checkValidSelectedItem(e,...t){return e?this.findItemInTree(e,this._groupTree)&&this.isValidRelationSelectedItems()?"Success":(console.error("L'item selectione n'est pas correct"),this.resetSelectedItem(...t),"Error"):(this.resetSelectedItem(...t),"Failure")}isValidRelationSelectedItems(){let e;if(e=this._selectedItems.at(0),!e)return!1;for(const[t,i]of this._selectedItems.entries())if(0!==t){if(!i)break;if(!e.children.find((e=>e.id===i?.id)))return!1;e=i}return!0}buildResetCode(e){const t=[];for(let i=0;i<this._nbGroup;i+=1)i<=e?t.push(0):t.push(void 0);return t}saveSelected(e){return e.id&&e.type!==n.GRP_NONE?(this._selectedItems[e.type]={...e},"Success"):"Error"}}class C{_lexicon=[];constructor(){this.initLexicon()}translate(e,t){return this._lexicon[t][e.type](e)}initLexicon(){const e=[this.getCreateGrpContextPayload,this.getCreateGrpCategoryPayload,this.getCreateGrpGroupPayload],t=[this.getUpdateGrpContextPayload,this.getUpdateGrpCategoryPayload,this.getUpdateGrpGroupPayload],i=Array(3).fill((e=>{}));this._lexicon=[e,t,i]}getCreateGrpContextPayload(e){return{contextName:e.title,childrenType:"geographicRoom"}}getCreateGrpCategoryPayload(e){return{categoryName:e.title,iconName:e?.icon??""}}getCreateGrpGroupPayload(e){return{groupName:e.title,colorName:e?.color??""}}getUpdateGrpContextPayload(e){return{newContextName:e.title}}getUpdateGrpCategoryPayload(e){return{newNameCategory:e.title,newNameIcon:e?.icon}}getUpdateGrpGroupPayload(e){return{newNameGroup:e.title,newNameColor:e?.color}}}class E{getIdCurrentBuilding(){return window.localStorage.getItem("idBuilding")||""}}class R extends E{_apiInstance=void 0;get _endpointGroupContextList(){return"api/v1/groupContext/list"}get _endpointGroupContextTree(){return"api/v1/groupContext/[id-0]/tree"}_genericError;_grpCtxPayloadGenerator=void 0;_lexicon=[];constructor(e){super();try{this._apiInstance=e,this._grpCtxPayloadGenerator=new C,this._genericError="Une erreur est survenue !",this.initLexicon()}catch(e){throw new Error(this._genericError)}}async getGroupContextTree(){return new Promise(((e,t)=>{const i=this.getGrpContextListFromServer();this.extractGrpCtxList(i).then((e=>e)).then((e=>this.getPmsGrpCtxTree(e))).then((([e,t])=>this.buildGroupItemTree(e,t))).then((t=>e(t))).catch((e=>{console.error(e),t(e)}))}))}async createGenericRequest(e,t,i){let r,o="";return new Promise(((a,s)=>{switch(this._apiInstance||s(new Error(this._genericError)),o=this._apiInstance?.createUrlWithPlatformId(this.getIdCurrentBuilding(),this.fillUrlTemplate(this._lexicon[t][e.type],i))??"",r=this._grpCtxPayloadGenerator?.translate(e,t),t){case l.API_CREATION:a(this._apiInstance.post(o,r));break;case l.API_UPDATE:a(this._apiInstance.put(o,r));break;case l.API_DELETION:a(this._apiInstance.delete(o))}}))}initLexicon(){this._lexicon=[["api/v1/groupContext/create","api/v1/groupContext/[id-0]/create_category","api/v1/groupeContext/[id-0]/category/[id-1]/create_group"],["api/v1/groupContext/[id-0]/update","api/v1/groupContext/[id-0]/category/[id-1]/update","api/v1/groupContext/[id-0]/category/[id-1]/group/[id-2]/update"],["api/v1/groupContext/[id-0]/delete","api/v1/groupContext/[id-0]/category/[id-1]/delete","api/v1/groupContext/[id-0]/category/[id-1]/group/[id-2]/delete"]]}async extractGrpCtxList(e){let t=[],i=[];return new Promise(((r,o)=>{e.then((e=>{e?.data&&200===e.status||o(new Error(this._genericError)),i=e.data.filter((e=>e.name&&e.dynamicId&&"geographicRoomGroupContext"===e.type)),t=i.map(((e,t)=>b.build({title:e.name,id:e.dynamicId,display:!0,children:[],type:n.GRP_CONTEXT,idIndexesFromRoot:[t]}))),r(t)}))}))}async buildGroupItemTree(e,t){let i;return new Promise(((r,o)=>{Promise.all(e).then((e=>{for(const r of e)r?.data?.children&&200===r.status&&(i=t.find((e=>e.id===r.data.dynamicId)),i&&this.getGrpCategoryFromGrpContext(i,r.data.children));r(t)})).catch((e=>{console.error(e),o(new Error(this._genericError))}))}))}getGrpCategoryFromGrpContext(e,t){let i;for(const[r,o]of t.entries())o.name&&o.dynamicId&&(i=b.build({title:o.name??"",id:o.dynamicId??-1,children:[],display:!0,type:n.GRP_CATEGORY,idIndexesFromRoot:[...e.idIndexesFromRoot,e.children.length]}),o.children&&Array.isArray(o.children)&&this.getGrpGroupFromGrpCategory(i,o.children),e.children.push(i))}getGrpGroupFromGrpCategory(e,t){let i;for(const[r,o]of t.entries())o.name&&o.dynamicId&&(i=b.build({title:o.name,id:o.dynamicId,children:[],display:!0,type:n.GRP_GROUP,idIndexesFromRoot:[...e.idIndexesFromRoot,r]}),i.children=this.getRoomFromGrpGroup(o,i),e.children.push(i))}getRoomFromGrpGroup(e,t){let i;try{return e.children.map(((e,r)=>e.name&&e.dynamicId?(i=b.build({...e,type:n.ROOM,title:e.name,id:e.dynamicId,idIndexesFromRoot:[...t.idIndexesFromRoot,r]}),i):{}))}catch(e){throw new Error(e)}}async getGrpContextListFromServer(){let e="";return new Promise(((t,i)=>{this._apiInstance||i("[API Instance] => Not defined"),e=this._apiInstance.createUrlWithPlatformId(this.getIdCurrentBuilding(),this._endpointGroupContextList),t(this._apiInstance.get(e))}))}getPmsGrpCtxTree(e){let t="";const i=[];try{if(!this._apiInstance)throw new Error(this._genericError);for(const[,r]of e.entries())t=this._apiInstance.createUrlWithPlatformId(this.getIdCurrentBuilding(),this._endpointGroupContextTree.replace("[id-0]",r.id.toString())),i.push(this._apiInstance.get(t));return[i,e]}catch(e){throw new Error(e)}}fillUrlTemplate(e,t){let i=e,r="";try{for(const[e,o]of t.entries())r=`id-${e}`,i=i.replace(r,o.id.toString()),i=i.replaceAll(/[${}]/gm,""),i=i.replaceAll(/[\[\]]/gm,"");return i}catch(e){throw new Error(e)}}}class T extends E{_spinalApi;_genericErrMsg="";constructor(){super();try{this._genericErrMsg="[Erreur] Une erreur est survenue !",this._spinalApi=s.getInstance("http://localhost:2023")}catch(e){console.error(e)}}async getAttributesMultipleNode(e){let t,i,r,o=[];return new Promise(((a,s)=>{r=this._spinalApi?.createUrlWithPlatformId(super.getIdCurrentBuilding(),"/api/v1/node/attribute_list_multiple"),t=this._spinalApi?.post(r,[...e]),void 0===t&&s(new Error(this._genericErrMsg)),t.then((e=>{200!==e.status&&s(new Error(this._genericErrMsg));for(const t of e.data)i=S.build({dynamicId:t.dynamicId,categoryAttributes:t.categoryAttributes}),o.push(i);a(o)})).catch((e=>{s(new Error(this._genericErrMsg))}))}))}}const S=v.an.makeFactory({dynamicId:-1,categoryAttributes:[]});class G extends E{_spinalApi;_genericErrMsg="";_roomGroupTree=[];constructor(){super();try{this._genericErrMsg="[Erreur] Une erreur est survenue !",this._spinalApi=s.getInstance("http://localhost:2023")}catch(e){console.error(e)}}async getRoomsGroupTree(){const e=[];let t;return this._roomGroupTree=[],new Promise(((i,r)=>{this.getRoomsGroupList().then((r=>{for(const t of r)e.push(this.getRoomsGroupIdTree(t.dynamicId));Promise.all(e).then((e=>{for(const i of e)t=i,this._roomGroupTree.push(i);i(this._roomGroupTree)})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}))}))}async getRoomsGroupList(){let e,t,i;return i=this._spinalApi?.createUrlWithPlatformId(super.getIdCurrentBuilding(),"/api/v1/roomsGroup/list"),e=this._spinalApi?.get(i),new Promise(((i,r)=>{try{void 0===e&&r(new Error(this._genericErrMsg)),e.then((e=>{t=e?.data,Array.isArray(t)&&200===e.status||r(new Error(this._genericErrMsg)),console.log("Response = ",t),i(t)})).catch((e=>{console.error(e),r(new Error(this._genericErrMsg))}))}catch(e){console.error(e),r(new Error(this._genericErrMsg))}}))}async getRoomsGroupIdTree(e){let t,i,r;const o="api/v1/roomsGroup/{id-0}/tree".replace(/{id-0}/,e.toString());return r=this._spinalApi?.createUrlWithPlatformId(super.getIdCurrentBuilding(),o),t=this._spinalApi?.get(r),new Promise(((e,r)=>{try{void 0===t&&r(new Error(this._genericErrMsg)),t.then((t=>{i=t.data,200!==t.status&&(console.error("Response = ",i),r(new Error(this._genericErrMsg))),e(i)})).catch((e=>{console.error(e),r(new Error(this._genericErrMsg))}))}catch(e){console.error(e),r(new Error(this._genericErrMsg))}}))}async addRoomToRoomGroup(e,t,i,r){let o,a,s;const n="api/v1/roomsGroup/{contextId}/category/{categoryId}/group/{groupId}/addRooms".replace(/{contextId}/,e.toString()).replace(/{categoryId}/,t.toString()).replace(/{groupId}/,i.toString());return s=this._spinalApi?.createUrlWithPlatformId(super.getIdCurrentBuilding(),n),o=this._spinalApi?.post(s,r),new Promise(((e,t)=>{try{void 0===o&&t(new Error(this._genericErrMsg)),o.then((i=>{a=i.data,200!==i.status&&t(new Error(this._genericErrMsg)),e(a)})).catch((e=>{console.error(e),t(new Error(this._genericErrMsg))}))}catch(e){console.error(e),t(new Error(this._genericErrMsg))}}))}async deleteRoomToRoomGroup(e,t,i,r){let o,a,s;const n="api/v1/roomsGroup/{contextId}/category/{categoryId}/group/{groupId}/deleteRooms".replace(/{contextId}/,e.toString()).replace(/{categoryId}/,t.toString()).replace(/{groupId}/,i.toString());return s=this._spinalApi?.createUrlWithPlatformId(super.getIdCurrentBuilding(),n),o=this._spinalApi?.delete(s,{data:r}),new Promise(((e,t)=>{try{void 0===o&&t(new Error(this._genericErrMsg)),o.then((i=>{a=i.data,200!==i.status&&t(new Error(this._genericErrMsg)),e(a)})).catch((e=>{console.error(e),t(new Error(this._genericErrMsg))}))}catch(e){console.error(e),t(new Error(this._genericErrMsg))}}))}async fillGrpContextWithRoomAttributes(e){let t,i;return new Promise(((r,o)=>{Array.isArray(e.children)||o(new Error(this._genericErrMsg));for(const r of e.children)if(t=r.children,Array.isArray(e.children))for(const r of t.children)Array.isArray(e.children)&&(i=r.children)}))}}async function M(e,t){const i=s.getInstance(),r=i.createUrlWithPlatformId(t,"api/v1/floor/list");return(await i.get(r)).data.map((i=>(Object.assign(i,{buildingId:t,patrimoineId:e,color:"#D138DE"}),i)))}async function k(e,t,i,r){const o=s.getInstance(),a=o.createUrlWithPlatformId(t,`api/v1/floor/${r}/room_list`);return(await o.get(a)).data.map((o=>(console.log("Obj = ",o),console.log("Floor dynamicId = ",i),Object.assign(o,{patrimoineId:e,buildingId:t,floorId:r,color:"#ded638"}),o)))}async function D(e,t,i,r,o){const a=s.getInstance(),n=a.createUrlWithPlatformId(t,`api/v1/room/${o}/equipement_list`);return(await a.get(n)).data.map((o=>(Object.assign(o,{patrimoineId:e,buildingId:t,floorId:i,roomId:r,color:"#2693ff"}),o)))}const O=v.an.makeFactory({dynamicId:-1,staticId:"",name:"",type:"",categoryAttributes:[]}),P=v.an.makeFactory({dynamicId:-1,name:"None",type:"None",categoryAttributes:[],floorId:-1,buildingId:"None",staticId:"None",infoReferencesObjects:[],bimFileId:"None",color:"#000000"});class L extends E{_apiInstance=void 0;_genericError;_idBuilding;constructor(){super();try{this._apiInstance=s.getInstance("http://localhost:2023"),this._genericError="Une erreur est survenue !",this._idBuilding=this.getIdCurrentBuilding()}catch(e){throw new Error(this._genericError)}}async getFloorList(){let e,t="";return new Promise(((i,r)=>{this._apiInstance||r(new Error(this._genericError)),t=this._apiInstance.createUrlWithPlatformId(this._idBuilding,"/api/v1/floor/list"),e=this._apiInstance.get(t),e.then((e=>this.checkErrorResponse(e))).then((e=>this.buildFloorList(e.data))).then((e=>i(e))).catch((e=>{r(new Error(this._genericError))}))}))}async getRoomList(e){let t,i="";return i=this._apiInstance.createUrlWithPlatformId(this._idBuilding,"/api/v1/floor/[floorId]/room_list".replace("[floorId]",e.toString())),new Promise(((r,o)=>{this._apiInstance||o(new Error(this._genericError)),t=this._apiInstance.get(i),t.then((e=>this.checkErrorResponse(e))).then((t=>this.buildRoomList(t.data,e))).then((e=>r(e))).catch((e=>{o(new Error(this._genericError))}))}))}async getAllRooms(){let e=[];return new Promise(((t,i)=>{this.getFloorList().then((t=>(e=t,t))).then((e=>e.map((e=>e.dynamicId)))).then((e=>e.map((e=>this.getRoomList(e))))).then((e=>Promise.all(e))).then((i=>t([i.flat(),e]))).catch((e=>{i(new Error(e))}))}))}async checkErrorResponse(e){return new Promise(((t,i)=>{e?200!==e?.status&&i(new Error(this._genericError)):i(new Error(this._genericError)),t(e)}))}async buildFloorList(e){const t=[];let i;return new Promise(((r,o)=>{for(const r of e)i=O.build({...r}),i.categoryAttributes=r.categories??[],t.push(i);r(t)}))}async buildRoomList(e,t){const i=[];let r;return new Promise(((o,a)=>{for(const o of e)r=P.build({...o,categoryAttributes:o.categories??[],floorId:t,buildingId:this._idBuilding,staticId:o.staticId??"-1"}),i.push(r);o(i)}))}}function F(e,t){const i={};for(const r of e)r[t]&&(i[r[t]]=r);return{list:e,obj:i}}const N=v.an.makeFactory({list:[],obj:{}});var V,B;!function(e){e.error="error",e.loading="loading",e.loaded="loaded"}(V||(V={})),function(e){e.GET_BUILDINGS="GET_BUILDINGS",e.GET_BUILDING_BY_ID="GET_BUILDING_BY_ID",e.OPEN_VIEWER="OPEN_VIEWER",e.GET_VIEWER_INFO="GET_VIEWER_INFO",e.SELECT_ITEMS="SELECT_ITEMS",e.FIT_TO_VIEW_ITEMS="FIT_TO_VIEW_ITEMS",e.ISOLATE_ITEMS="ISOLATE_ITEMS",e.UNLOAD_MODEL="UNLOAD_MODEL",e.GET_FLOORS="GET_FLOORS",e.GET_ROOMS="GET_ROOMS",e.GET_EQUIPMENTS="GET_EQUIPMENTS",e.GET_GROUPS_ITEMS="GET_GROUPS_ITEMS",e.GET_CATEGORIES_TREE="GET_CATEGORIES_TREE",e.GET_GROUPS_ITEMS_BY_GEOITEM="GET_GROUPS_ITEMS_BY_GEOITEM",e.GET_ITEM_CONTROL_POINT="GET_ITEM_CONTROL_POINT",e.COLOR_ITEMS="COLOR_ITEMS",e.ADD_SPRITES="ADD_SPRITES",e.ADD_COMPONENT_AS_SPRITES="ADD_COMPONENT_AS_SPRITES",e.REMOVE_ALL_SPRITES="REMOVE_ALL_SPRITES",e.SELECT_SPRITES="SELECT_SPRITES"}(B||(B={}));class U{_genericErrMsg;_geographicContextApi;_floors;_rooms;_referenceObjectList;constructor(){this._rooms=N.build(),this._floors=N.build(),this._referenceObjectList={},this._geographicContextApi=new L,this._genericErrMsg="Une erreur est survenue !"}get rooms(){return this._rooms}get floors(){return this._floors}async loadData(){return this.loadRooms()}getRoomByDbId(e){const t=this._referenceObjectList[e];if(t)return this._rooms.list.at(t.roomIndex)}getRoomByDynamicId(e){return this._rooms.list.find((t=>t.dynamicId===e))}getIdCurrentBuilding(){return window.localStorage.getItem("idBuilding")||""}async loadRooms(){const e=this.getIdCurrentBuilding();let t=[];return new Promise(((i,r)=>{e||r(new Error(this._genericErrMsg)),this._geographicContextApi.getAllRooms().then((([e,i])=>(this._floors.list=this._floors.list.concat(i),t=e,t.map((e=>e.dynamicId))))).then((t=>t.map((t=>async function(e,t){const i=s.getInstance(),r=i.createUrlWithPlatformId(e,`api/v1/room/${t}/reference_Objects_list`);return(await i.get(r)).data}(e,t))))).then((e=>Promise.all(e))).then((e=>this.buildRoomAndFloorList(t,e))).then((()=>i(this._rooms.list))).catch((e=>{r(new Error(e))}))}))}async buildRoomAndFloorList(e,t){let i;return new Promise(((r,o)=>{for(const[r,o]of e.entries())i=this._rooms.list.find((e=>e.dynamicId===o.dynamicId)),i||this.addRoom(o,t,r);this._rooms=F(this._rooms.list,"dynamicId"),this._floors=F(this._floors.list,"dynamicId"),r()}))}addRoom(e,t,i){let r;const o=P.build({...e,infoReferencesObjects:t.find((t=>e.dynamicId===t.dynamicId))?.infoReferencesObjects??[],color:"#010101"});this._rooms.list.push(o);for(const e of o.infoReferencesObjects)r=this._referenceObjectList[e.dbid],r||this.addRefObj(e,i)}addRefObj(e,t){this._referenceObjectList[e.dbid]={dynamicId:e.dynamicId??-1,staticId:e.staticId,name:e.name,type:e.type,version:e.version??-1,externalId:e.externalId,roomIndex:t??-1,dbId:e.dbid??-1,modelId:e.modelId??-1}}}class $ extends f{_allRooms;_filters;_selectedFilters;_genericErrMsg;_nbGroup;_groupToDisplay;_roomToDisplay;_roomAttributeLexicon;_displayNameLexicon;_selectedItems=[void 0,void 0,void 0];_grpCtxApiInstance;_roomGroupApiInstance;_roomManager;constructor(){super(),this._genericErrMsg="Une erreur est survenue",this._roomToDisplay=[],this._selectedFilters=[],this._roomAttributeLexicon={},this._displayNameLexicon={},this._roomManager=new U,this._grpCtxApiInstance=new R(s.getInstance()),this._roomGroupApiInstance=new G,this._nbGroup=3}applyBusinessRules(e){throw new Error("Method not implemented.")}async loadData(){return new Promise(((e,t)=>{this._roomManager.loadData().then((()=>this._allRooms=this._roomManager.rooms)).then((()=>console.log("All rooms = ",this._allRooms))).then((()=>this.buildDisplayNameLexicon())).then((()=>this.extractFilters(this._allRooms.list))).then((e=>this._filters=e)).then((()=>this._grpCtxApiInstance.getGroupContextTree())).then((e=>super.loadData(e))).then((()=>this.transformData())).then((()=>e("Success"))).catch((e=>{console.error(e),t(new Error(this._genericErrMsg))}))}))}reloadGroupToDisplay(){const e=Array(this._nbGroup).fill([]),t=e;let i,r;if(void 0===this._groupTree)return e;t[0]=[...this._groupTree];for(const[e,o]of this._selectedItems.entries()){if(o){if(r=this.findItemInTree(o,this._groupTree),!r?.display)break;i=r.children}else i=[];i||=[],e+1<this._nbGroup&&(t[e+1]=i)}return this._groupToDisplay=t,this._groupToDisplay}selectItem(e){return e?(this.saveSelected(e),this.checkValidSelected(),"Success"):"Failure"}getSelected(){return this._selectedItems}get filters(){return this._filters}async reloadRoomToDisplay(e){const t=[];let i,r,o=0;return new Promise(((a,s)=>{0===e.length&&a(this._allRooms.list);for(const a of this._allRooms.list){for(const t of e)r=parseFloat(this.getAttributByName(a,t.name,t.category)),"string"===t.type?(i=this.getAttributByName(a,t.name,t.category),t.value.length>0&&i.startsWith(t.value)&&(o+=1)):"number"===t.type&&(o+=this.applyFilterRoomNumber(t,r));o===e.length&&t.push(a),o=0}a(t)}))}async commitChange(e,t){return new Promise(((i,r)=>{const o=this.getPathItem(t),a=[];console.log("Rooms = ",e),console.log("groupe selected = ",t),a.push(this._roomGroupApiInstance.addRoomToRoomGroup(o[0]?.id,o[1]?.id,o[2]?.id,e.map((e=>e.dynamicId)))),Promise.all(a).then((()=>i(e))).catch((e=>console.error(e)))}))}get groupToDisplay(){return this._groupToDisplay}buildDisplayNameLexicon(){this._displayNameLexicon.name="Nom",this._displayNameLexicon.category="Catégorie",this._displayNameLexicon.level="Niveau",this._displayNameLexicon.number="Nombre",this._displayNameLexicon.area="Superficie",this._displayNameLexicon.perimeter="Périmètre",this._displayNameLexicon.volume="Volume",this._displayNameLexicon.stype="Stype"}async transformData(){return new Promise(((e,t)=>{for(const e of this._groupTree)for(const t of e.children)for(const e of t.children)delete e.children;e()}))}applyFilterRoomNumber(e,t){switch(e.comparaison){case"gt":return t>parseFloat(e.value)?1:0;case"lt":return t<parseFloat(e.value)?1:0;case"btw":return t>=parseFloat(e.min)&&t<=parseFloat(e.max)?1:0;case"eq":return t===parseFloat(e.value)?1:0}return 0}async extractFilters(e){let t,i={},r={},o=[],a="";return new Promise(((s,n)=>{for(const o of e)if(o.categoryAttributes&&o.categoryAttributes.length)for(const e of o.categoryAttributes){r[e.name]?.[o.id]||(r[e.name]||(r[e.name]={}),r[e.name][o.id]=e.attributs);for(const r of e.attributs){if(t=parseFloat(r.value),a=isNaN(t)?"string":"number",i[r.label]){if("number"!==i[r.label].type)continue;parseFloat(i[r.label].min)>t&&(i[r.label].min=t.toString()),parseFloat(i[r.label].max)<t&&(i[r.label].max=t.toString())}else i[r.label]=_.build({name:r.label,min:"number"===a?t:0,max:"number"===a?t:0,type:a,value:"number"===a?r.value:"",displayName:this._displayNameLexicon[r.label]?this._displayNameLexicon[r.label]:r.label,category:e.name});a=""}}for(const e in i)o.push(i[e]);this._roomAttributeLexicon=r,s(o)}))}getAttributByName(e,t,i){let r,o=e.categoryAttributes?.find((e=>e.name===i))?.attributs;return o&&0!==o.length?(r=o?.find((e=>e.label===t)),r?r.value:""):""}checkValidSelected(){let e="Failure",t=[];if(this._selectedItems.length!==this._nbGroup)return this.resetSelectedItem(),"Error";for(const[i,r]of this._selectedItems.entries())if(t=this.buildResetCode(i),r&&(e=this.checkValidSelectedItem(r,...t),"Success"!==e))return"Failure";return"Success"}checkValidSelectedItem(e,...t){return e?this.findItemInTree(e,this._groupTree)&&this.isValidRelationSelectedItems()?"Success":(this.resetSelectedItem(...t),"Error"):(this.resetSelectedItem(...t),"Failure")}resetSelectedItem(...e){let t=0;const i=Array(this._nbGroup).fill(void 0);if(e.length!==this._nbGroup)return this._selectedItems=i,"Error";for(const[i,r]of this._selectedItems.entries())t=e.at(i),this._selectedItems[i]=0===t?r:void 0;return"Success"}isValidRelationSelectedItems(){let e;if(e=this._selectedItems.at(0),!e)return!1;for(const[t,i]of this._selectedItems.entries())if(0!==t){if(!i)break;if(!e.children.find((e=>e.id===i?.id)))return!1;e=i}return!0}saveSelected(e){return e.id&&e.type!==n.GRP_NONE?(this._selectedItems[e.type]={...e},"Success"):"Error"}buildResetCode(e){const t=[];for(let i=0;i<this._nbGroup;i+=1)i<=e?t.push(0):t.push(void 0);return t}}var j=i(945);class W{static _instance;_modelDico=new Map;constructor(){}static getInstance(){return this._instance||(this._instance=new W),this._instance}setModels(e,t){Array.isArray(t)||(t=[t]),this._modelDico.set(e,t)}addNewModel(e,t){const i=this._modelDico.get(e)||[];Array.isArray(t)||(t=[t]),i.push(...t),this.setModels(e,t)}allModelAreLoaded(){if(0===this._modelDico.size)return!1;for(const[e,t]of this._modelDico)if(t.find((e=>!e.isLoadDone())))return!1;return!0}getSpinalModelID(e){const t="number"==typeof e?e:e.id;for(const[e,i]of this._modelDico)if(i.find((e=>e.id==t)))return e}getModelById(e){for(const[t,i]of this._modelDico)if(e==t)return i}getModelList(){return this._modelDico}deleteModel(e){const t=this._modelDico.delete(e);return t||isNaN(e)?t:this._modelDico.delete(Number(e))}}var z=W;class Z{get=void 0;post=void 0;put=void 0;delete=void 0;static instance;axiosInstance;_apiUrl="";constructor(e=""){this.setApiUrl(e),this.axiosInstance=a().create({baseURL:this._apiUrl}),this.get=this.axiosInstance.get,this.post=this.axiosInstance.post,this.put=this.axiosInstance.put,this.delete=this.axiosInstance.delete,this.axiosInstance.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.common.Authorization=`Bearer ${t}`),e}))}static getInstance(e){return Z.instance||(Z.instance=new Z(e||"http://localhost:2023")),Z.instance}createUrl(e){return e.startsWith("/")&&(e=e.substring(1)),this.apiUrl+e}createUrlWithPlatformId(e,t){return t.startsWith("/")||(t="/"+t),`${this.apiUrl}api/v2/building/${e}${t}`}async*createIteratorCall(e,...t){const i=await e(...t);for(;;)yield i}get apiUrl(){return`${this._apiUrl}${this._apiUrl.endsWith("/")?"":"/"}`}setApiUrl(e){this._apiUrl=e}}let H;const q={};function K(e,t,i){let r=!1;for(const o of e)if(o.bimFileId===t){r=!0,o.dbIds.add(i);break}r||e.push({bimFileId:t,dbIds:new Set([i])})}function Y(e,t){for(const i of t)for(const t of i.dbIds)K(e,i.bimFileId,t)}async function Q(e){if(!q[e]){const t=Z.getInstance();let i=await async function(e,t){const i=e.createUrlWithPlatformId(t,"api/v1/BIM/scene/default");return(await e.get(i)).data}(t,e);i&&0!==Object.keys(i||{}).length||(i=await async function(e,t){const i=await async function(e,t){const i=e.createUrlWithPlatformId(t,"api/v1/BIM/scene/list");return(await e.get(i)).data}(e,t);return i?.scenes[0]}(t,e)),q[e]=i}return q[e]}function X(e){return(e.items[0]?.path||"").replace("/html/viewerForgeFiles","")}function J(e){return(e.items[0]?.aecPath||"").replace("/html/viewerForgeFiles","")}var ee;!function(e){e.UNLOAD="unload",e.UNLOADED="unloaded",e.LOADED="loaded",e.VIEWER_ADD_COMPONENT_SPRITE="viewer add component as sprite"}(ee||(ee={})),new c.Ay;class te{static _instance;viewer;modelManager=W.getInstance();_buildingInfo={};_viewerStores={};_viewerStartedList={};constructor(){}static getInstance(){return this._instance||=new te,this._instance}async initViewer(e){return Autodesk.Viewing.Private.InitParametersSetting.alpha=!0,new Promise((t=>{const i=this;Autodesk.Viewing.Initializer({env:"Local",docid:"",useADP:!1},(()=>{if(e){const r=Autodesk.Viewing.DefaultSettings;r.ghosting=!1;const o=new Autodesk.Viewing.Viewer3D(e,r);i.viewer=o,t(o)}}))}))}async loadInViewer(e,t=!0,i){if(this._viewerStartedList[e.dynamicId])return void this.showAllObjects();if(t){const e=Object.keys(this._viewerStartedList);await this.unload(e)}const r=j.t4.getInstance();r.once(j.Q8,(async()=>{const{buildingId:t}=e,{dynamicId:o}=e;i||={dynamicId:[o],floorRef:!0,roomRef:!0,equipements:!1};const a=await this.getViewerInfoMerged(e,i);r.once(ee.LOADED,(e=>{this._addViewLoaded(e.id,e.models)}));const s=await async function(e,t,i){const r=await Q(e),o=await async function(e,t,i){const r=function(e){return e.reduce(((e,t)=>(e[t.bimFileId]=t.dbIds,e)),{})}(t);return(await async function(e){if(H)return H;const t=Z.getInstance(),i=t.createUrlWithPlatformId(e,"api/v1/BIM/BIMFileContext/list");let r=await t.get(i);return H=r.data,r.data}(e)).reduce(((e,t)=>{const o=r[t.staticId];return o&&e.push({bimFileId:t.staticId,id:i,name:t.name,path:X(t),aecPath:J(t),offset:t.offset,dbids:o}),e}),[])}(e,t,i.dynamicId);return{item:i,buildingId:e,loadingType:r.sceneAlignMethod,models:o}}(t,a,e);r.emit(j.NF,s)}))}async resize(){return new Promise(((e,t)=>{this.viewer.resize(),e()}))}async getViewerInfoMerged(e,t){const i=await this.getViewerInfo(e,void 0,t),r=[];for(const e of i)Y(r,e.data);return Y(r,t?.dbIdsToAdd||[]),r.map((e=>({bimFileId:e.bimFileId,dbIds:Array.from(e.dbIds)})))}async getViewerInfo(e,t,i){void 0===this._viewerStores.GET_VIEWER_INFO&&(this._viewerStores.GET_VIEWER_INFO={});const r=Array.isArray(e)?e:[e],o=t||r[0].buildingId,a=r.map((e=>e.dynamicId)),s=[],n=[];for(const e of a)if(this._viewerStores.GET_VIEWER_INFO[e]){const t=(await this._viewerStores.GET_VIEWER_INFO[e].next())?.value;t&&s.push(t)}else n.push(e);if(n.length>0){i||={dynamicId:n,floorRef:!0,roomRef:!0,equipements:!1};const e=await async function(e,t){const i=Z.getInstance(),r=i.createUrlWithPlatformId(e,"api/v1/geographicContext/viewInfo");return(await i.post(r,t)).data}(o,i);for(const t of e)this._viewerStores.GET_VIEWER_INFO[t.dynamicId]=l(t),s.push(t)}return s;async function*l(e){for(;;)yield e}}async select(e){return console.log("On call la fct select"),this._fctViewerIteract(j.cG,e)}async isolate(e){return this._fctViewerIteract(j.zm,e)}showAllObjects(){j.t4.getInstance().emit(j.zm)}async fitToView(e){return this._fctViewerIteract(j.vt,e)}async unload(e){return this._fctViewerIteract(ee.UNLOAD,e)}async colorItems(e,t){const i=await this._getAndFormatViewerInfos(e,t);j.t4.getInstance().emit(j.vL,i)}async addSprites(e,t){const i=await this._getAndFormatViewerInfos(e,t);j.t4.getInstance().emit(j.Bk,i)}async addComponentAsSprites(e,t,i){const r=await this._getAndFormatViewerInfos(e,t,i);j.t4.getInstance().emit(ee.VIEWER_ADD_COMPONENT_SPRITE,r)}async _getAndFormatViewerInfos(e,t,i){e=Array.isArray(e)?e:[e];const r=(await this.getViewerInfo(e,t)).reduce(((e,t)=>(e[t.dynamicId]=t.data,e)),{});return e.map((e=>({data:r[e.dynamicId],color:e.color,value:e.displayValue,modelId:e.floorId||e.id||e.dynamicId,parent:{...e},position:e.position,component:e.component||i})))}async _fctViewerIteract(e,t){const i=j.t4.getInstance();if(e===ee.UNLOAD){const r=(t=Array.isArray(t)?t:[t]).map((e=>"string"==typeof e||"number"==typeof e?e:e?.dynamicId));return i.emit(e,r),void t.forEach((e=>{const t="string"==typeof e||"number"==typeof e?e:e?.dynamicId;this._removeViewLoaded(t)}))}const r=(await this.getViewerInfoMerged(t)).map((e=>({dbIds:e.dbIds,bimFileId:e.bimFileId,modelId:t.floorId||t.id||t.dynamicId})));i.emit(e,r)}_addViewLoaded(e,t){this._viewerStartedList[e]||(this._viewerStartedList[e]=new Set([]));for(const i of t)this._viewerStartedList[e].add(i.id)}_removeViewLoaded(e){delete this._viewerStartedList[e]}_removeToolbarControl(){this.viewer}}var ie=te;class re extends f{static legendSpaceAssignation=[x.build({title:"Piè̤ce non affectées",color:"#808080",type:"Not-assigned"}),x.build({title:"Piè̤ce affectées au groupe",color:"#13a9e0",type:"Assigned"}),x.build({title:"Piè̤ce affectées à un autre groupe",color:"#ffa400",type:"AssignedToAnother"}),x.build({title:"Piè̤ce à affecter au groupe",color:"#11eda9",type:"ToAssign"}),x.build({title:"Piè̤ce à ré-affecter au groupe",color:"#af97d6",type:"ToReAssign"}),x.build({title:"Piè̤ce à désaffecter du groupe",color:"#ff000b",type:"ToDeAssign"})];_genericErrMsg;_groupToDisplay;_allRooms;_selectedGrpRooms=void 0;_groupRoomTree=[];_grpFocus="GrpRoomList";_lexiconGrpRoomTree;_lexiconAttributes;_currentCategorie;_categories;_roomManager;_viewerManager;_emitterHandler;_globalArea=0;_totalGainGrpRoom;_totalGainListGrpRoom;_totalAreaGrpRoom;_totalAreaListGrpRoom;grpCtxApiInstance;nodeAttrApiInstance;roomGroupApiInstance;constructor(e,t,i){super(),this.grpCtxApiInstance=e,this.nodeAttrApiInstance=t,this.roomGroupApiInstance=i,this._totalGainGrpRoom=y.build({})??void 0,this._totalGainListGrpRoom=y.build({})??void 0,this._totalAreaGrpRoom=y.build({})??void 0,this._totalAreaListGrpRoom=y.build({})??void 0,this._currentCategorie=void 0,this._groupToDisplay=[],this._globalArea=0,this._genericErrMsg="Une erreur est survenue",this._grpFocus="GrpRoomList",this._roomManager=new U,this._allRooms=N.build(),this._emitterHandler=j.t4.getInstance(),this._viewerManager=te.getInstance(),this._categories=[],this.listenSelectionEventViewer()}async loadData(){return new Promise(((e,t)=>{this._roomManager.loadData().then((()=>this._allRooms=this._roomManager.rooms)).then((()=>this.grpCtxApiInstance.getGroupContextTree())).then((e=>super.loadData(e))).then((()=>this.transformTree())).then((e=>this._groupRoomTree=e)).then((()=>this.getCategoryList())).then((e=>this._categories=e)).then((()=>this.recomputeKpi())).then((()=>e("Success"))).catch((e=>{t(new Error(e))}))}))}async addNewItem(e,t){const i=I.build({...e,display:!0,idIndexesFromRoot:[...this._selectedGrpRooms.idIndexesFromRoot,this._selectedGrpRooms.children.length]});return new Promise(((t,r)=>{i.tmp=!0,this.addNewItemErrorManagement(e).then((()=>this.assignRoomArea(i))).then((()=>this.deleteRoomAssignedToOtherGrp(i))).then((()=>this.addNewItemUpdateOperation(i))).then((()=>this.colorizeViewer())).then((()=>this.sortAllGrpRoomDefault())).then((()=>t(i))).catch((e=>{r(new Error(e))}))}))}async deleteItem(e,t){return new Promise(((t,i)=>{"ToReAssign"===e.operations&&this.restoreStateAffectedItem(e.previousOpsItems),this.updateOperationsState(e,"ToDeAssign"),this.checkHardDelete(e),this.colorizeViewer(),this.recomputeKpi(),this.sortAllGrpRoomDefault().then((()=>t(e))).catch((e=>{i(e)}))}))}static guessItemColor(e){const t=re.legendSpaceAssignation.find((t=>t.type===e)),i=re.legendSpaceAssignation.find((e=>"Not-assigned"===e.type));return t?.color??i.color}itemColorBefore;async buildViewerFirstPass(e,t){let i,r=[],o="";return new Promise(((a,s)=>{r=this._allRooms.list.map((r=>(i=e[r.dynamicId],i=I.build({...i}),i.operations="Assigned"===i.operations?"AssignedToAnother":i.operations,o=re.guessItemColor(i.operations),{...r,color:e[r.dynamicId]?o:t.color,id:r.dynamicId}))).filter((e=>e)),a(r)}))}async buildViewerSecondPass(e,t){let i=[],r="";return new Promise(((t,o)=>{i=this._selectedGrpRooms.children.filter((t=>e[t.id])).map((e=>(r=re.guessItemColor(e.operations),{...this._allRooms.obj[e.id],color:r,id:e.id.toString()}))),t(i)}))}async buildLexiconGroupRoomTree(){return new Promise(((e,t)=>{const i={};for(const e of this._groupRoomTree)if(Array.isArray(e.children))for(const t of e.children)i[t.id]||=t;e(i)}))}async buildLexiconGRTByCat(e){return new Promise(((t,i)=>{const r={};for(const t of this._groupRoomTree)if(Array.isArray(t.children)&&t.parentId===e)for(const e of t.children)r[e.id]||=e;t(r)}))}async colorizeViewer(){const e=re.legendSpaceAssignation.find((e=>"Not-assigned"===e.type));let t=this._roomManager.getIdCurrentBuilding(),i=this._lexiconGrpRoomTree;return new Promise(((r,o)=>{this.buildLexiconGRTByCat(this._currentCategorie.id).then((e=>i=e)).then((()=>this.buildViewerFirstPass(i,e))).then((e=>this._viewerManager.colorItems(e,t))).then((()=>this.buildViewerSecondPass(i,e))).then((e=>this._viewerManager.colorItems(e,t))).then((()=>r())).catch((e=>{console.error(e),o(new Error(e))}))}))}async restoreItem(e){return new Promise(((t,i)=>{e.tmp=!1,e.display=!0,this.updateOperationsState(e,e.previousOperations),this.recomputeKpi(),this.colorizeViewer(),t(e)}))}async addNewItemErrorManagement(e){return new Promise(((t,i)=>{e||i(new Error("Aucun pièces n'a été selectioné")),"GrpRoomList"===this._grpFocus&&i(new Error("Il est seulement possible d'ajouter une piéce si un groupe est selectioné")),this._selectedGrpRooms||i(new Error(this._genericErrMsg)),this._selectedGrpRooms.children.find((t=>t.title===e.title))&&i("Cette item éxiste déja"),t()}))}sortAllGrpRoomDefault(){return new Promise(((e,t)=>{for(const e of this._groupRoomTree)e.children=e.children.sort(((e,t)=>+("Assigned"!==t.operations)-+("Assigned"!==e.operations)));e(this._groupRoomTree)}))}checkHardDelete(e){"ToReAssign"!==e.previousOperations&&"ToAssign"!==e.previousOperations||(this._selectedGrpRooms.children=this._selectedGrpRooms.children.filter((t=>t.id!==e.id)))}async assignRoomArea(e){return new Promise(((t,i)=>{e.area=parseFloat(this.getAttributByName(e,"area")),t(e)}))}async addNewItemUpdateOperation(e){return new Promise(((t,i)=>{"Not-assigned"===e.operations&&this.updateOperationsState(e,"ToAssign"),this._selectedGrpRooms.children.push(e),this.recomputeKpi(),t(e)}))}async canAddRoom(e){return new Promise(((t,i)=>{"ToAssign"!==e.operations&&"ToReAssign"!==e.operations||t(e),t(void 0)}))}async canDeleteRoom(e){return new Promise(((t,i)=>{"ToDeAssign"===e.operations&&t(e),t(void 0)}))}operationOnRoomCreation(e,t,i){const r=[];return t===l.API_CREATION&&r.push(this.roomGroupApiInstance.addRoomToRoomGroup(i[0].id,i[1].id,i[2].id,[e.id])),r}operationOnRoomDeletion(e,t,i){const r=[];return t===l.API_DELETION&&r.push(this.roomGroupApiInstance.deleteRoomToRoomGroup(i[0].id,i[1].id,i[2].id,[e.id])),r}async operationOnRoom(e,t){let i,r=[],o=[],a=[];return new Promise(((s,n)=>{for(const s of e)i=this.getParentItem(s),i&&(r=this.getPathItem(s),r.length<3||(o=this.operationOnRoomCreation(s,t,r),a=this.operationOnRoomDeletion(s,t,r)));s([...o,...a])}))}async commitChange(){let e=[],t=[];return new Promise(((i,r)=>{this.guessOperationRoom().then((([i,r])=>{e=i,t=r})).then((()=>Promise.all(t))).then((e=>e.filter((e=>e)))).then((e=>this.operationOnRoom(e,2))).then((e=>Promise.all(e))).then((()=>Promise.all(e))).then((e=>e.filter((e=>e)))).then((e=>this.operationOnRoom(e,0))).then((e=>Promise.all(e))).then((()=>this.rebuildGrpRoom())).then((()=>this.colorizeViewer())).then((()=>this.recomputeKpi(!0))).then((()=>i("Success"))).catch((e=>{r(new Error(e))}))}))}async reset(){return new Promise(((e,t)=>{"GrpRoom"===this._grpFocus?this.resetGrpRoom():"GrpRoomList"===this._grpFocus&&this.resetEveryGrp(),e()}))}async commitChangeGrpRoom(){let e=[],t=[];return new Promise(((i,r)=>{this.guessOperationGrpRoom().then((([i,r])=>{e=i,t=r})).then((()=>Promise.all(t))).then((e=>e.filter((e=>e)))).then((e=>this.operationOnRoom(e,2))).then((e=>Promise.all(e))).then((()=>Promise.all(e))).then((e=>e.filter((e=>e)))).then((e=>this.operationOnRoom(e,0))).then((e=>Promise.all(e))).then((()=>this.rebuildSelectedGrpRoom())).then((()=>this.colorizeViewer())).then((()=>this.recomputeKpi(!0))).then((()=>i("Success"))).catch((e=>{r(new Error(e))}))}))}async saveGrpRoom(){return new Promise(((e,t)=>{}))}selectItem(e){let t;if("GrpRoomList"===this._grpFocus)this._selectedGrpRooms=e,this.recomputeKpi(),this.colorizeViewer();else if("GrpRoom"===this._grpFocus&&(this._viewerManager||=te.getInstance(),"GrpRoom"===this._grpFocus&&this._viewerManager&&this._roomManager)){if(t=this._allRooms.obj[e.id],!t)throw new Error("La pièce selectioné n'éxiste pas");this._viewerManager.select(t).then().catch((e=>{throw console.error(e),new Error(this._genericErrMsg)})),this.colorizeViewer()}}getSelected(){return this._selectedGrpRooms}applyBusinessRules(e){throw new Error("Method not implemented.")}get globalArea(){return this._globalArea}get groupToDisplay(){return this._groupToDisplay}get rooms(){return this._allRooms}get currentCategory(){return this._currentCategorie}get categories(){return this._categories}get selectedGrpRoom(){return this._selectedGrpRooms}reloadGroupToDisplay(){return this.recomputeKpi(),"GrpRoomList"===this._grpFocus?this._groupToDisplay=this._groupRoomTree.filter((e=>this._currentCategorie.id===e.parentId)):"GrpRoom"===this._grpFocus&&this._selectedGrpRooms?this._groupToDisplay=this._selectedGrpRooms.children:this._groupToDisplay=[],this._groupToDisplay}recomputeKpi(e=!1){this.recomputeEveryGrp(e),this.getDataSelectedRoom()}async addItemFromViewer(e,t){let i,r,o,a;return new Promise(((e,s)=>{t.id?i=this._allRooms.obj[t.id]:t.dynamicId&&(i=this._allRooms.obj[t.dynamicId]),r=this._roomManager.floors.obj[this._roomManager.rooms.obj[i.dynamicId].floorId],o=this.getParentItem(this._lexiconGrpRoomTree[i.dynamicId]),a=this.getParentItem(o);const l=I.build({id:i.dynamicId,title:i.name,area:parseFloat(this.getAttributByName(i,"area")),type:n.ROOM,tmp:!0,floorId:r?.dynamicId??-1,floorName:r?.name??"",color:this.getAttributByName(i,"color"),parentId:o?.id,parentTitle:o?.title,grandParentId:a?.id,grandParentTitle:a?.title});"GrpRoomList"!==this._grpFocus&&this.addNewItem(l,void 0).then((()=>this.colorizeViewer())).then((()=>e(l))).catch((e=>{throw new Error(this._genericErrMsg)}))}))}applyColorsToRooms(){this._grpFocus}listenSelectionEventViewer(){let e;this._emitterHandler.on(j.ZM,(async t=>{try{if("GrpRoom"===this._grpFocus){if(e=t.at(0)?.dbIds,!Array.isArray(e))return;e=e.map((e=>this._roomManager?.getRoomByDbId(e.toString()))).flat(1)}}catch(e){console.error(e)}})),this._emitterHandler.on(j.NF,(async e=>{this.colorizeViewer()}))}async resetGrpRoom(){let e=[];try{for(const t of this._selectedGrpRooms.children)"ToAssign"===t.operations?e.push(t.id):"ToReAssign"===t.operations?(e.push(t.id),this.restoreStateAffectedItem(t.previousOpsItems)):"ToDeAssign"===t.operations&&(t.operations=t.previousOperations);this._selectedGrpRooms.children=this._selectedGrpRooms.children.filter((t=>!1===e.includes(t.id))),this._selectedGrpRooms.gainKpi=y.build({}),this._selectedGrpRooms.newArea=this._selectedGrpRooms.area}catch(e){throw new Error(e)}}async resetEveryGrp(){let e=[];for(const t of this._groupRoomTree){for(const i of t.children)"ToAssign"===i.operations?e.push(i.id):"ToReAssign"===i.operations?(e.push(i.id),this.restoreStateAffectedItem(i.previousOpsItems)):"ToDeAssign"===i.operations&&(i.operations=i.previousOperations);t.children=t.children.filter((t=>!e.includes(t.id))),e=[],t.gainKpi=y.build({}),t.newArea=this._selectedGrpRooms?.area??0}this._totalAreaListGrpRoom.value=this.globalArea,this._totalGainListGrpRoom=y.build({})}async rebuildGrpRoom(){return new Promise(((e,t)=>{for(const e of this._groupRoomTree)for(const[t,i]of e.children.entries())switch(i.operations){case"ToAssign":case"ToReAssign":i.operations="Assigned";break;case"ToDeAssign":e.children=e.children.filter((e=>e.id!==i.id))}e()}))}async rebuildSelectedGrpRoom(){return new Promise(((e,t)=>{for(const e of this._selectedGrpRooms.children)switch(e.operations){case"ToAssign":case"ToReAssign":e.operations="Assigned";break;case"ToDeAssign":this._selectedGrpRooms.children=this._selectedGrpRooms.children.filter((t=>t.id!==e.id))}e()}))}selectCategory(e){return new Promise(((t,i)=>{this._currentCategorie=this.categories.find((t=>t.id===e)),this._currentCategorie||i(new Error("Aucune categorie n'a ete selectione")),t(this._currentCategorie)}))}switchCategories(e){return new Promise(((t,i)=>{this.reset().then((()=>this.selectCategory(e))).then((e=>this.fillAreaGrpRoomByCat(this._groupRoomTree,e))).then((()=>this.buildLexiconGRTByCat(this._currentCategorie.id))).then((e=>this._lexiconGrpRoomTree=e)).then((()=>this.recomputeEveryGrpArea())).then((()=>this.recomputeKpi())).then((()=>t(this._currentCategorie))).catch((e=>{console.error(e)}))}))}async guessOperationRoom(e=!1){const t=[];let i=[];return new Promise(((e,r)=>{for(const e of this._groupRoomTree){for(const r of e.children)t.push(this.canAddRoom(r)),i.push(this.canDeleteRoom(r)),r.tmp=!1;e.gainKpi=y.build(),e.area=e.newArea}e([t,i])}))}async guessOperationGrpRoom(){const e=[];let t=[],i=0;return new Promise(((r,o)=>{for(const r of this._selectedGrpRooms.children)e.push(this.canAddRoom(r)),t.push(this.canDeleteRoom(r)),r.tmp=!1,i+=r.area;this._selectedGrpRooms.gainKpi=y.build(),this._selectedGrpRooms.area=i,this._selectedGrpRooms.newArea=i,r([e,t])}))}getGrpAffectedToRoom(e){let t={},i=[];for(const i of this._groupRoomTree)if(i.parentId===this._currentCategorie.id)for(const r of i.children)r.id===e.dynamicId&&(t[e.dynamicId]=r);for(const e in t)i.push(t[e]);return i}getFutureOperation(e){return this.getGrpAffectedToRoom(e).length>0?"ToReAssign":"ToAssign"}recomputeSelectedGrp(e){let t=0,i=0;const r=e??this._selectedGrpRooms;r?(r.newArea=r.children.filter((e=>"ToDeAssign"!==e.operations)).reduce(((e,t)=>e+t.area),0),t=r.newArea-r.area,i=0!==r.area?t/r.area*100:0,r.gainKpi.value=t,r.gainKpi.percentage=i):this._totalGainGrpRoom=y.build({})}recomputeEveryGrpArea(e){for(const e of this._groupRoomTree)e.area=e.children.reduce(((t,i)=>e.parentId===this._currentCategorie.id?t+i.area:t),0)}getDataSelectedRoom(){if(!this._selectedGrpRooms)return this._totalGainGrpRoom=y.build({}),void(this._totalAreaGrpRoom=y.build({}));const e=this._selectedGrpRooms.newArea-this._selectedGrpRooms.area,t=0!==this._selectedGrpRooms.area?e/this._selectedGrpRooms.area*100:0;this._totalGainGrpRoom.value=e,this._totalGainGrpRoom.percentage=t,this._totalAreaGrpRoom.value=this._selectedGrpRooms.newArea,this._totalAreaGrpRoom.percentage=t}recomputeEveryGrp(e=!1){let t=0,i=0,r=0;if(this._groupRoomTree){for(const e of this._groupRoomTree)e.parentId===this._currentCategorie.id&&this.recomputeSelectedGrp(e);r=this._groupRoomTree.reduce(((e,t)=>t.parentId===this._currentCategorie.id?e+t.newArea:e),0),e&&(this._globalArea=r),t=r-this._globalArea,i=t/this._globalArea*100,this._totalAreaListGrpRoom.value=r,this._totalGainListGrpRoom.value=t,this._totalGainListGrpRoom.percentage=i}else this._totalGainListGrpRoom=y.build({})}setFocus(e){this._grpFocus=e}getFocus(){return this._grpFocus}get totalGain(){return"GrpRoomList"===this._grpFocus?this._totalGainListGrpRoom:"GrpRoom"===this._grpFocus?this._totalGainGrpRoom:y.build({})}get totalArea(){return"GrpRoomList"===this._grpFocus?this._totalAreaListGrpRoom:"GrpRoom"===this._grpFocus?this._totalAreaGrpRoom:y.build({})}updateOperationsState(e,t){e.previousOperations=e.operations,e.operations=t}getAttributByName(e,t){let i,r=this._lexiconAttributes[e.id],o=e.id||e.dynamicId;return r||(r=this._lexiconAttributes[o],r)?(i=r?.attributs.find((e=>e.label===t)),i?i.value:""):""}isGoodPath(e){const t=[1===e.filter((e=>e.type===n.GRP_CONTEXT)).length,1===e.filter((e=>e.type===n.GRP_CATEGORY)).length,1===e.filter((e=>e.type===n.GRP_GROUP)).length];for(const e of t)if(!e)return!1;return!0}deleteRoomAssignedToOtherGrpErrMng(e,t){return new Promise(((i,r)=>{t||r(new Error(this._genericErrMsg)),this.isGoodPath(e)&&t.type===n.GRP_GROUP||r(new Error(this._genericErrMsg)),e[1]&&e[1].type===n.GRP_CATEGORY||r(new Error(this._genericErrMsg)),i()}))}async checkRoomAlreadyExist(e,t){const i=this._selectedGrpRooms;let r=-1;const o=[],a=this.getParentItem(e);return new Promise(((s,n)=>{for(const s of this._groupRoomTree)a.id!==s.id&&s.parentId===t.id&&(r=s.children.findIndex((t=>t.id===e.id)),-1!==r&&s.id!==i.id&&(this.updateOperationsState(e,"ToReAssign"),e.previousOpsItems.push(s.children[r]),o.push(this.deleteItem(s.children[r],s))));s(o)}))}async deleteRoomAssignedToOtherGrp(e){const t=this.getPathItem(e);return e.previousOpsItems=[],new Promise(((i,r)=>{this.deleteRoomAssignedToOtherGrpErrMng(t,this._selectedGrpRooms).then((()=>this.checkRoomAlreadyExist(e,this._currentCategorie))).then((e=>Promise.all(e))).then((()=>i("Success"))).catch((e=>{r(new Error(e))}))}))}restoreStateAffectedItem(e){for(const t of e)this.restoreStateAffectedItem(t.previousOpsItems),this.updateOperationsState(t,t.previousOperations),t.previousOpsItems=[]}async transformTree(){let e=[],t=[];return e=this._allRooms.list.map((e=>e.dynamicId)),new Promise(((i,r)=>{this.fillLexiconAttributes(e,"Spatial").then((()=>this.extractGrpGroup())).then((e=>this.transformGrpGroup(e))).then((e=>t=e)).then((e=>this._groupRoomTree=e)).then((()=>this.buildLexiconGroupRoomTree())).then((e=>this._lexiconGrpRoomTree=e)).then((()=>i(this._groupRoomTree))).catch((e=>{r(new Error(this._genericErrMsg))}))}))}async getCategoryList(){return new Promise(((e,t)=>{e(this._groupTree.map((e=>e.children.map((e=>e)))).flat(1))}))}async pickDefaultCategory(){return new Promise(((e,t)=>{this.getCategoryList().then((i=>{this._categories=i,0===i.length&&t(new Error("Il n'y a aucune catégorie disponible")),e(i[0])})).catch((e=>t(e)))}))}async fillAreaGrpRoomByCat(e,t){let i=[];return this._globalArea=0,new Promise(((r,o)=>{i=e.map((e=>{const i=e.children.reduce(((e,i)=>i.grandParentId===t.id?e+i.area:0),0);return this._globalArea+=i,{...e,area:i,newArea:i}})),r(i)}))}async transformGrpGroup(e){let t=[];const i={};return new Promise(((r,o)=>{t=e.map((e=>{const t=this.getParentItem(e);return I.build({id:e.id,title:e.title,type:e.type,idIndexesFromRoot:e.idIndexesFromRoot,parentId:t.id,parentTitle:t.title,children:e.children.map((r=>{const o=parseFloat(this.getAttributByName(r,"area"))??-1,a=parseFloat(this.getAttributByName(r,"color"))??"",s=this._roomManager.floors.obj[this._roomManager.rooms.obj[r.id].floorId],l=I.build({id:r.id,title:r.title,area:o,newArea:o,idIndexesFromRoot:r.idIndexesFromRoot,type:n.ROOM,floorId:s?.dynamicId??-1,floorName:s?.name??"",color:a,parentId:e.id,parentTitle:e.title,grandParentId:t.id,grandParentTitle:t.title});return i[l.grandParentId]?.[l.id]?(l.parentId=i[l.grandParentId]?.[l.id].parentId,l.parentTitle=i[l.grandParentId]?.[l.id].parentTitle,this.updateOperationsState(l,"AssignedToAnother")):(i[l.grandParentId]||(i[l.grandParentId]={}),i[l.grandParentId][l.id]=l,this.updateOperationsState(l,"Assigned")),l}))})})),console.log("TransformGrpGroup"),r(t)}))}async fillLexiconAttributes(e,t){let i,r=[];return this._lexiconAttributes={},new Promise(((o,a)=>{this.nodeAttrApiInstance.getAttributesMultipleNode(e).then((e=>{r=e;for(const e of r)void 0===this._lexiconAttributes&&(this._lexiconAttributes={}),i=e.categoryAttributes?.find((e=>e.name===t)),i&&(this._lexiconAttributes[e.dynamicId]=i);o(this._lexiconAttributes)})).catch((e=>{console.error(e),a(new Error(this._genericErrMsg))}))}))}async extractGrpGroup(){let e=[];return new Promise(((t,i)=>{e=this._groupTree.map((e=>e.children.map((e=>e.children.map((e=>e)))))).flat(2),t(e)}))}async extractRoomIdsFromGrpGroup(e){let t=[];return new Promise(((i,r)=>{t=e.map((e=>e.children.map((e=>e.id)))).flat(1),i(t)}))}}var oe=i(892),ae=i(9774),se=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"space-selector-container",class:{isopen:e.open}},[t(oe.A,{staticClass:"space-selector",class:{"space-selector-open":e.open},staticStyle:{border:"1px solid #f5f5f5","border-left":"2px solid #f5f5f5","border-bottom":"none !important",overflow:"hidden"},style:[{height:e.open?e.selectorHeight+"px !important":"59px"},{"overflow-y":!e.isFill},{"border-right":e.edge?"":"none"},{"border-top-right-radius":e.edge?"":"0 !important"},{"border-bottom-right-radius":e.edge||!e.edge&&e.open?"":"0 !important"}],attrs:{color:"#14202C"}},[t("div",{ref:"SpaceSelectorTitleContainer",staticClass:"space-selector-header",style:{cursor:-1!==e.maxDepth?"pointer":"default"},on:{click:function(t){t.stopPropagation(),e.$emit("update:open",!e.open),e.showSign()}}},[t("span",{staticClass:"legend"},[e._v(e._s(e.label))]),e._v(" "),t("p",{staticClass:"space-selector-header-title"},[t(ae.A,{staticClass:"rotate-disabled space-selector-header-title-icon",class:{"rotate-enabled":e.open},style:[{color:-1!==e.maxDepth?"#f5f5f5":"#14202c"},{width:-1!==e.maxDepth?"auto":"0 !important"},{color:-1!==e.maxDepth?"#f5f5f5":"#14202c"}]},[e._v("\n          mdi-chevron-down\n        ")]),e._v("\n\n        "+e._s(e.selectedZoneName.toUpperCase())+"\n      ")],1)]),e._v(" "),t("transition-group",{staticClass:"card-list spinal-scrollbar",style:[{"overflow-y":"auto !important"}],attrs:{id:"myDiv",name:"staggered-fade",tag:"div",css:!1},on:{"before-enter":e.beforeEnter,enter:e.enter}},e._l(e.buildingStructure,(function(i,r){return t("SpaceSelectorItem",{key:`${r}-${i.staticId}-${i.platformId}-${i.patrimoineId}`,staticClass:"staggered-fade-item",attrs:{item:i,"data-index":r,maxDepth:e.maxDepth,selected:e.selectedZone,spaceSelectorItemButtons:e.spaceSelectorItemButtons,viewButtonsType:e.viewButtonsType},on:{onSelect:function(t){return e.select(i)},onOpenClose:function(t){return e.expandCollapse(i,r)},onActionClick:e.onActionClick}})})),1)],1)],1)};se._withStripped=!0;var ne=i(1568),le=i.n(ne),ce=i(292),de=i(465),pe=i(6598),ue=i(5854),he=i(7435),me=function(){var e=this,t=e._self._c;return e._self._setupProxy,t(pe.A,{staticClass:"space-selector-list-item card-hover fade",class:{["space-selector-list-item-level-"+e.item.level]:!0,"space-selector-list-item-isopen":e.item.isOpen&&e.item.haveChildren,"space-selector-list-item-isSelected":e.isSelected},style:{"margin-left":20*(e.item.level-1)+30+"px"},on:{click:function(t){return t.stopPropagation(),e.onSelect.apply(null,arguments)}}},[e.item.level>0?[t("div",{staticClass:"space-selector-list-item-angle"}),e._v(" "),t("div",{staticClass:"space-selector-list-item-angle-extend"}),e._v(" "),e._l(e.item.level-1,(function(i){return t("div",{directives:[{name:"show",rawName:"v-show",value:e.drawParentLink(i),expression:"drawParentLink(depth)"}],key:i,staticClass:"parent-link",style:{"margin-left":"-"+(20*i+11)+"px"}})}))]:e._e(),e._v(" "),t("div",{staticClass:"color-square",style:{"background-color":e.color}}),e._v(" "),t(he.pr,{staticStyle:{"margin-left":"21px"}},[t(he.UZ,{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.item.name,expression:"item.name"}]},[e._v(e._s(e.item.name)+"\n    ")])],1),e._v(" "),t(ue.A,{staticClass:"actionsDiv"},[e._l(e.spaceSelectorItemButtons,(function(i,r){return"advanced"===e.viewButtonsType?t(de.A,{directives:[{name:"show",rawName:"v-show",value:e.display(i),expression:"display(button)"}],key:r,staticStyle:{color:"#bfbfbf"},attrs:{"x-small":"",elevation:"0",fab:"",icon:"",dark:"",loading:e.item.loading,title:i.title,disabled:e.disableBtn(i)},on:{click:function(t){return t.stopPropagation(),e.onActionClick(i)}}},[t(ae.A,[e._v(e._s(i.icon))])],1):e._e()})),e._v(" "),t(de.A,{directives:[{name:"show",rawName:"v-show",value:e.item.level!=e.maxDepth,expression:"item.level != maxDepth"}],staticStyle:{color:"#bfbfbf"},attrs:{elevation:"0",fab:"",icon:"",dark:"",loading:e.item.loading,disabled:e.item.loading},on:{click:function(t){return t.stopPropagation(),e.onOpenClose.apply(null,arguments)}}},[t(ae.A,{attrs:{dark:""}},[e._v(" "+e._s(e.icon)+" ")])],1)],2)],2)};me._withStripped=!0;var ge=function(e,t,i,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(s=(a<3?o(s):a>3?o(t,i,s):o(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s};let fe=class extends ce.lD{item;maxDepth;selected;spaceSelectorItemButtons;viewButtonsType;get isSelected(){return this.item.patrimoineId===this.selected.patrimoineId&&this.item.platformId===this.selected.platformId&&(this.item.staticId===this.selected?.staticId||this.selected?.parents?.includes(this.item.staticId))}get color(){return"geographicFloor"===this.item.type&&this.isLoaded(this.item)?"#008000":this.item.color}get icon(){return this.item?.isOpen?"mdi-chevron-down":"mdi-chevron-up"}isLoaded(e){const t="geographicFloor"===e.type?e.dynamicId:e.floorId;return!!t&&!!this.$store.state.appDataStore.viewerStartedList[t]}onSelect(){if("base"===this.viewButtonsType){const e=this.getButton();e&&this.$emit("onActionClick",{button:e,item:this.item})}this.$emit("onSelect")}onActionClick(e){this.$emit("onActionClick",{button:e,item:this.item})}display(e){return!e.isShownTypes||-1!==e.isShownTypes.indexOf(this.item.type)}onOpenClose(){this.$emit("onOpenClose")}drawParentLink(e){return!this.item.drawLink.includes(e)}disableBtn(e){switch(e.onclickEvent){case B.OPEN_VIEWER:case B.OPEN_VIEWER:case B.OPEN_VIEWER:case"OPEN_VIEWER_PLUS":return this.isLoaded(this.item);case B.UNLOAD_MODEL:case B.FIT_TO_VIEW_ITEMS:case B.SELECT_ITEMS:case B.ISOLATE_ITEMS:return!this.isLoaded(this.item)}}getButton(){if("building"!==this.item.type)return"geographicFloor"===this.item.type?this.spaceSelectorItemButtons.find((e=>e.onclickEvent===B.OPEN_VIEWER)):this.spaceSelectorItemButtons.find((e=>e.onclickEvent===B.ISOLATE_ITEMS))}};ge([(0,ce.kv)({type:Object,required:!0})],fe.prototype,"item",void 0),ge([(0,ce.kv)({type:Number,required:!0})],fe.prototype,"maxDepth",void 0),ge([(0,ce.kv)({type:Object,required:!0})],fe.prototype,"selected",void 0),ge([(0,ce.kv)({type:Array,required:!1,default:()=>[]})],fe.prototype,"spaceSelectorItemButtons",void 0),ge([(0,ce.kv)({type:String,required:!1})],fe.prototype,"viewButtonsType",void 0),fe=ge([ce.uA],fe);var ve=fe,_e=(i(1356),i(4101)),ye=(0,_e.A)(ve,me,[],!1,null,"3540edfe",null).exports;function be(e,t){let i=t?.drawLink.map((e=>e+1))||[];!0===t?.isLastInGrp&&i.unshift(1);const r=e.map((e=>{let r,o;const a=t?t.level+1:0,s=t?t.parents.concat(t?.staticId):[];return"patrimoine"===e.type?(o=t?.staticId||"",r=""):"building"===e.type?(o=t?.staticId||"",r=e.staticId):(o=t?.patrimoineId||"",r=t?.buildingId||""),function(e,t,i,r,o,a){return{...e,staticId:e.staticId,name:e.name,buildingId:t,patrimoineId:i,level:r,isOpen:!1,parents:o,categories:e.categories,color:e.color,dynamicId:e.dynamicId,type:e.type,loading:!1,isLastInGrp:!1,drawLink:a,haveChildren:!1}}(e,r,o,a,s,i)}));return r.length>0&&(t&&(t.haveChildren=!0),r[r.length-1].isLastInGrp=!0),r}var we=function(e,t,i,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(s=(a<3?o(s):a>3?o(t,i,s):o(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s};let Ie=class extends ce.lD{spaceSelectorItemButtons;viewButtonsType;GetChildrenFct;maxDepth;selectedZone;open;edge;label;selectorHeight=0;get selectedZoneName(){return this.selectedZone?.name||"Sélectionnez une zone"}isFill="hidden";buildingStructure=[];async onSelectedChange(){for(let e=0;e<this.buildingStructure.length;e++){const t=this.buildingStructure[e];let i=!1;if(t.platformId===this.selectedZone.platformId&&t.dynamicId===this.selectedZone.dynamicId&&t.staticId===this.selectedZone.staticId)i=!0;else for(const r of this.selectedZone.parents)if(r===t.staticId&&(this.selectedZone.platformId===t.platformId||"patrimoine"===t.type)){i=!0,t.isOpen||(await this.openItem(t,e),e=0);break}}this.checkingOverflow()}select(e){this.$emit("update:open",!this.open),this.$emit("input",e)}myDiv;checkingOverflow(){const e=document.getElementById("myDiv"),t=window.innerHeight,i=e.offsetHeight;this.isFill=i>=t-421?"auto":"hidden"}async mounted(){const e=await this.GetChildrenFct();this.buildingStructure=be(e),1===this.buildingStructure.length&&await this.expandCollapse(this.buildingStructure[0],0),this.onSelectedChange()}async expandCollapse(e,t,i=!1){!0!==e.isOpen||i?await this.openItem(e,t):this.closeItem(e),this.selectorHeight=56*this.buildingStructure.length+60+30,this.checkingOverflow()}async openItem(e,t){e.isOpen=!0,e.loading=!0;try{const i=await this.GetChildrenFct(e);this.buildingStructure.splice(t+1,0,...be(i,e))}catch(e){console.error("error fetch childrens.",e)}e.loading=!1,this.checkingOverflow()}closeItem(e){e.isOpen=!1;const t=[];for(const i of this.buildingStructure)i.platformId!==e.platformId&&"patrimoine"!==e.type||!i.parents.includes(e.staticId)||t.push(i);for(const e of t){const t=this.buildingStructure.findIndex((t=>t.patrimoineId===e.patrimoineId&&t.platformId===e.platformId&&t.staticId===e.staticId));this.buildingStructure.splice(t,1)}}getParentOfSelected(){for(let e=0;e<this.buildingStructure.length;e++){const t=this.buildingStructure[e];if(t.platformId===this.selectedZone.platformId&&t.dynamicId===this.selectedZone.dynamicId&&t.staticId===this.selectedZone.staticId){const i=t.level;for(let t=e;t>=0;t--){const e=this.buildingStructure[t];if(i>e.level)return e}break}}}showSign(){this.selectorHeight=56*this.buildingStructure.length+60+30}beforeEnter(e){e.style.opacity=0,e.style.height=0}enter(e,t){var i=5*e.dataset.index;setTimeout((function(){le()(e,{opacity:1,height:"50px"},{complete:t})}),i)}onActionClick(e){this.$emit("onActionClick",e)}};we([(0,ce.kv)({type:Array,required:!1,default:()=>[]})],Ie.prototype,"spaceSelectorItemButtons",void 0),we([(0,ce.kv)({type:String,required:!1})],Ie.prototype,"viewButtonsType",void 0),we([(0,ce.kv)({type:Function,required:!1})],Ie.prototype,"GetChildrenFct",void 0),we([(0,ce.kv)({type:Number,required:!1,default:-1})],Ie.prototype,"maxDepth",void 0),we([(0,ce.Qq)({type:Object})],Ie.prototype,"selectedZone",void 0),we([(0,ce.kv)({type:Boolean,required:!0})],Ie.prototype,"open",void 0),we([(0,ce.kv)({type:Boolean,required:!1,default:!0})],Ie.prototype,"edge",void 0),we([(0,ce.kv)({type:String,required:!0})],Ie.prototype,"label",void 0),we([(0,ce.ox)("selectedZone")],Ie.prototype,"onSelectedChange",null),Ie=we([(0,ce.uA)({components:{SpaceSelectorItem:ye}})],Ie);var xe=Ie,Ae=(i(2165),i(7409),(0,_e.A)(xe,se,[],!1,null,"46846356",null).exports),Ce=i(3753);const Ee={load:{title:"charger",icon:"mdi-video-3d",onclickEvent:B.OPEN_VIEWER,isShownTypes:["geographicFloor"]},load_plus:{title:"charger en plus",icon:"mdi-rotate-3d",onclickEvent:"OPEN_VIEWER_PLUS",isShownTypes:["geographicFloor"]},unload:{title:"decharger",icon:"mdi-video-3d-off",onclickEvent:B.UNLOAD_MODEL,isShownTypes:["geographicFloor"]},fitToView:{title:"Zoomer",icon:"mdi-fit-to-screen-outline",onclickEvent:B.FIT_TO_VIEW_ITEMS,isShownTypes:["geographicRoom"]},select:{title:"selectionner",icon:"mdi-selection",onclickEvent:B.SELECT_ITEMS,isShownTypes:["geographicRoom"]},isolate:{title:"isoler",icon:"mdi-target",onclickEvent:B.ISOLATE_ITEMS,isShownTypes:["geographicRoom"]}},Re={base:[Ee.load,Ee.unload,Ee.isolate],advanced:Object.values(Ee)};var Te=function(){var e=this._self._c;return this._self._setupProxy,e("div",{ref:"viewerDiv",staticClass:"viewer-div-container"})};function Se(e,t=""){let i=e;const r="http://localhost:2023";return e.startsWith("/")||(e="/"+e),/https?:\/\//.test(e)||(i=`${r}${r.endsWith("/")?"":"/"}api/v2/building/${t}/BIM/file${e}`),i}async function Ge(e){return(await a().get(e)).data}let Me;async function ke(e,t){if(!Me){const i=await Q(t),r=(i?.scenesItems||[])[0];if(!r||!r.aecPath)return Me=e.model?.getData().globalOffset,Me;const o=Se(r.aecPath,t),a=await Ge(o);if(!a)return Me=e.model?.getData().globalOffset,Me;const s=a&&a.refPointTransformation;Me=s?new THREE.Vector3(s[9],s[10],0):new THREE.Vector3(0,0,0)}return Me}async function De(e){const t=e.map((({model:e,dbIds:t})=>function(e,t){if(e)return Array.isArray(t)||(t=[t]),async function(e,t){t=Array.isArray(t)?t:[t];const i=await function(e){let t=0;return new Promise(((i,r)=>{!function r(){setTimeout((()=>e.getData().instanceTree?i(e.getData().instanceTree):2e3===t?i(void 0):(t+=200,void r())),200)}()}))}(e);if(!i)return;const r=e.getFragmentList();let o=new THREE.Box3;for(const e of t)await Oe(i,r,e,o);return o}(e,t)}(e,t)));let i=await Promise.all(t);return i=i.filter((e=>e)),0===i.length?{x:null,y:null,z:null}:i.reduce(((e,t)=>(t&&e.union(t),e)),new THREE.Box3).getCenter()}function Oe(e,t,i,r){try{e.enumNodeFragments(i,(e=>{let i=new THREE.Box3;t.getWorldBounds(e,i),r.union(i)}),!0)}catch(e){console.error(e)}}Te._withStripped=!0;const Pe=i(7363);class Le{DataVizCore;static _instance;_dataVizExtn;_viewableType;dbIdToViewable={};label3Ds=[];constructor(){}static getInstance(){return this._instance||(this._instance=new Le),this._instance}get dataVizExtn(){return this._dataVizExtn}async loadDataVisualizationExtension(e){this._dataVizExtn=await e.loadExtension("Autodesk.DataVisualization"),await e.loadExtension("Autodesk.Edit3D"),this.DataVizCore||(this.DataVizCore=Autodesk.DataVisualization.Core,this._viewableType=this.DataVizCore.ViewableType.SPRITE),e.addEventListener(this.DataVizCore.MOUSE_CLICK,this._onSpriteClicked.bind(this)),e.addEventListener(this.DataVizCore.MOUSE_HOVERING,this._onSpriteHovering.bind(this))}async addComponentAsSprite(e,t){t=Array.isArray(t)?t:[t];for(const i of t){if(!i.component)continue;const t=new(c.Ay.extend(i.component))({propsData:i}),r=new Autodesk.Edit3D.Label3D(e,i.position,""),o=t.$mount().$el;r.container.appendChild(o),this.label3Ds.push({dynamicId:i.data.dynamicId,label:r,component:t})}}async selectSprites(e){for(let t of this.label3Ds)e.includes(t.dynamicId)?t.component._isSelected():t.component._isNotSelected()}async createSprite(e,t){const i=new this.DataVizCore.ViewableData;i.spriteSize=24,t=Array.isArray(t)?t:[t];for(const e of t){if(!e.position||null==e.position.x&&null==e.position.y&&null==e.position.z)continue;const t=new THREE.Color(e.color),r=new this.DataVizCore.ViewableStyle(this._viewableType,t,Pe),o=new this.DataVizCore.SpriteViewable(e.position,r,e.dbId);o.contextData=e.data,this.dbIdToViewable[e.dbId]=i,this._addSpriteToObject(e.dbId,e.dbId,o),i.addViewable(o)}await i.finish(),this._dataVizExtn.addViewables(i)}removeSprites(){this._dataVizExtn&&this.dataVizExtn.removeAllViewables(),this.label3Ds.slice().forEach((e=>e.label.dtor())),this.label3Ds=[]}_addSpriteToObject(e,t,i){this.dbIdToViewable[e]||(this.dbIdToViewable[e]={}),this.dbIdToViewable[e][t]=i}_showOrHideSpritesOnIsolation(e){}_converToObject(e){return e.reduce(((e,{model:t,ids:i})=>(e[t.id]||(e[t.id]=[]),e[t.id].push(...i),e)),{})}_onSpriteHovering(e){this._sendSpriteEvent(e.dbId,j.TY)}_onSpriteClicked(e){this._sendSpriteEvent(e.dbId,j.UK)}_sendSpriteEvent(e,t){const i=this.dbIdToViewable[e];if(!i)return;const r=i.viewables.find((t=>t.dbId===e));r&&r.contextData&&j.t4.getInstance().emit(t,{pos:r.position,style:r.style,img:r.style?.url,node:r.contextData})}}var Fe=Le;class Ne{static _instance;_isFirstModel=!0;waitBeforeDisplaySprites=!0;constructor(){}static getInstance(){return this._instance||=new Ne,this._instance}setWaitBeforeDisplaySprites(e){this.waitBeforeDisplaySprites=e,e||setTimeout((()=>{this.waitBeforeDisplaySprites=!0}),1e3)}async load3DModels(e,t){const i=[];for(const e of t.models)i.push({bimFileId:e.bimFileId,path:this._addSlash(e.path),dbids:e.dbids,aecPath:this._addSlash(e.aecPath),offset:e.offset?.[Object.keys(e.offset)[0]],id:e.id,name:e.name});return this.setWaitBeforeDisplaySprites(!0),async function(e,t,i){const r=[];let o=0;e.length>0&&i&&(o=1,await t(e[0]).then((t=>{t&&(t.bimFileId=e[0].bimFileId,r.push(t))})));const a=[];for(;o<e.length;o++){const i=e[o];a.push(t(i).then((function(e){e&&(e.bimFileId=i.bimFileId,r.push(e))})))}return Promise.all(a).then((()=>r))}(i,(async i=>this._loadBimFile(e,t.loadingType,i,t.buildingId)),this._isFirstModel).then((i=>(W.getInstance().addNewModel(t.item?.dynamicId,i),this.setWaitBeforeDisplaySprites(!1),this.setCamera(e,j.N2.top),i)))}async unloadModel(e,t){if(!t||0===t.length)return;await Fe.getInstance().removeSprites();const i=W.getInstance();for(const r of t){const t=i.getModelById(r);if(t){for(const i of t)e.impl.unloadModel(i);i.deleteModel(r)}}}clearSelect(e){e?.clearSelection&&e?.clearSelection()}viewerSelect(e,t){e&&this.clearSelect(e);const i=this._classifyDbIdsByModel(t);for(const{model:e,dbIds:t}of i)e.selector.setSelection(t,"selectOnly")}viewerIsolation(e,t){this.setWaitBeforeDisplaySprites(!0);const i=this._classifyDbIdsByModel(t);for(const{model:t,dbIds:o}of i)o.length>0?t.visibilityManager&&e.isolate(o,t):r(t);function r(t){const i=t.getRootId();t.getObjectTree((r=>{const o=r.nodeAccess.dbIdToIndex[i];e.isolate([o],t)}))}this.setWaitBeforeDisplaySprites(!1),this.viewerFitToView(e,t)}showAllObject(e){this.setWaitBeforeDisplaySprites(!0);const t=e.getAggregateIsolation();for(const i of t)e.isolate(0,i.model);const i=e.getHiddenModels();for(const t of i)e.showModel(t.id,!1);this.setWaitBeforeDisplaySprites(!1),e.fitToView()}viewerFitToView(e,t){const i=this._classifyDbIdsByModel(t).map((({dbIds:e,model:t})=>({model:t,selection:e})));e.fitToView(i)}setCamera(e,t=j.N2["top,front"]){Array.isArray(t)||(t=[t]);const i=t.map((e=>(isNaN(e)||(e=j.N2[e]),`[${e.replace(",","/")}]`))),r=e.getExtension("Autodesk.ViewCubeUi");r&&r.setViewCube(i.join(", "))}async setObjColor(e,t){await this._waitModelIsLoading();for(const i of t){const t=i.data;for(const r of t){const t=this._getModel(i.modelId,r.bimFileId);if(!t)continue;const o=Ve(i.color),a=o?new THREE.Vector4(o.r/255,o.g/255,o.b/255,.7):new THREE.Vector4(1,0,0,0);for(const i of r.dbIds)e.setThemingColor(i,a,t)}}}async addSprite(e,t){await this._waitModelIsLoading();const i=t.map((async e=>{const t=e.data.map((({bimFileId:t,dbIds:i})=>({dbIds:i,model:this._getModel(e.modelId,t)})));return{modelId:e.modelId,color:e.color,value:e.value,models:t,dbId:t[0]?.dbIds[0],position:e.position||await De(t),data:e.parent,component:e.component}}));Promise.all(i).then((t=>{Fe.getInstance().createSprite(e,t)}))}async addComponentAsSprite(e,t){await this._waitModelIsLoading();const i=t.map((async e=>{const t=e.data.map((({bimFileId:t,dbIds:i})=>({dbIds:i,model:this._getModel(e.modelId,t)})));return{modelId:e.modelId,color:e.color,value:e.value,models:t,dbId:t[0]?.dbIds[0],position:e.position||await De(t),data:e.parent,component:e.component}}));return Promise.all(i).then((async t=>Fe.getInstance().addComponentAsSprite(e,t)))}async _loadBimFile(e,t,i,r){try{const o={headlessViewer:!0};i.dbids&&(o.ids=i.dbids),i.offset?(t===j.Ri.ShareCoordinates&&(o.applyRefPoint=!0),o.globalOffset=i.offset):t===j.Ri.OriginToOrigin?o.globalOffset=await ke(e,r,i.aecPath):t===j.Ri.ShareCoordinates&&i.aecPath&&(o.applyRefPoint=!0,o.globalOffset=await async function(e,t,i){const r=await ke(t,i),o=await Ge(e);if(o){const e=o&&o.refPointTransformation,t=e?{x:e[9],y:e[10],z:0}:{x:0,y:0,z:0},i=4e6,a=r&&THREE.Vector3.prototype.distanceToSquared.call(t,r);if(a&&(!r||a>i))return(new THREE.Vector3).copy(t)}return r}(i.aecPath,e,r));const a=Se(i.path,r),s=await this._loadModel(i.id,e,a,o,this._isFirstModel);return this._isFirstModel&&=!1,s}catch(e){}}_addSlash(e){return e?e.startsWith("/")?e:"/"+e:""}async _loadModel(e,t,i,r={},o=!1){return new Promise(((e,a)=>{let s;const n=i=>{s&&i.model.id===s.id&&(t.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,n),e(s))};t.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,n),(o?t.start:t.loadModel).call(t,i,r,(e=>{s=e}),a),o&&(t.loadExtension("Autodesk.ViewCubeUi",t.config),Fe.getInstance().loadDataVisualizationExtension(t),t.impl.renderer().setClearAlpha(0),t.impl.glrenderer().setClearColor(16777215,0),t.impl.invalidate(!0))}))}async _waitModelIsLoading(){return new Promise(((e,t)=>{const i=()=>{this.waitBeforeDisplaySprites&&!this._allModelsAreLoaded()?setTimeout((()=>{i()}),500):(this.setWaitBeforeDisplaySprites(!1),e(!0))};i()}))}_classifyDbIdsByModel(e){const t=e.reduce(((e,{bimFileId:t,dbIds:i})=>(e[t]=i,e)),{}),i=W.getInstance().getModelList(),r=[];for(const[e,o]of i)for(const e of o){const i={model:e,dbIds:t[e.bimFileId]||[]};r.push(i)}return r}_getModel(e,t){const i=W.getInstance().getModelById(e.toString());if(i)return i.find((e=>e.bimFileId===t))}_allModelsAreLoaded(){return W.getInstance().allModelAreLoaded()}}function Ve(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}const Be=j.t4.getInstance();Be.setTarget(window.parent,"viewer"),Be.loging=!0;class Ue{static _instance;lastSelection;constructor(){}static getInstance(){return this._instance||(this._instance=new Ue),this._instance}listenAllEvents(e){return new Promise((t=>{const i=Ne.getInstance();function r(e){const t=[];for(const i of e.selections)t.push({dbIds:i.dbIdArray,modelId:z.getInstance().getSpinalModelID(i.model.id)});this.lastSelection=t,Be.emit(j.ZM,t)}Be.on(j.NF,(async t=>{const r=await i.load3DModels(e,t);Be.emit(ee.LOADED,{id:t.item.dynamicId,models:r})})),Be.on(j.zm,(t=>{if(t&&t.length>0)return i.viewerIsolation(e,t);i.showAllObject(e)})),Be.on(j.cG,(t=>{i.viewerSelect(e,t)})),Be.on(j.vt,(t=>{i.viewerFitToView(e,t)})),Be.on(ee.UNLOAD,(t=>{i.unloadModel(e,t),Be.emit(ee.UNLOADED)})),Be.on(j.y$,(t=>{i.setCamera(e,t)})),Be.on(j.MY,(e=>{})),Be.on(j.vL,(t=>{i.setObjColor(e,t)})),Be.on(j.Bk,(t=>{i.addSprite(e,t)})),Be.on(ee.VIEWER_ADD_COMPONENT_SPRITE,(t=>{i.addComponentAsSprite(e,t)})),Be.on(j.EB,(t=>{i.removeSprite(e,t)})),Be.on(j.wX,(()=>{i.removeAllSprites(e)})),Be.on(j.A8,(t=>{i.moveSprite(e,t)})),Be.on(j.EE,(t=>{i.addLine(e,t)})),Be.on(j.vo,(t=>{i.removeLine(e,t)})),Be.on(j.R6,(t=>{i.moveLine(e,t)})),Be.on(j.Z0,(t=>{i.addSphere(e,t)})),Be.on(j.Gg,(t=>{i.removeSphere(e,t)})),Be.on(j.I6,(t=>{i.moveSphere(e,t)})),e.addEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,r);const o=setInterval((()=>{Be.emit(j.Q8)}),3e3);Be.emit(j.Q8),t((function(){clearInterval(o),e.removeEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,r)}))}))}sendContextMenuClick(e){j.t4.getInstance().emit(j.Mj,{button:e,selection:this.lastSelection})}}let $e=class extends ce.lD{stopEventListener;async mounted(){const e=this.$refs.viewerDiv,t=await te.getInstance().initViewer(e);this.stopEventListener=await Ue.getInstance().listenAllEvents(t)}beforeDestroy(){this.stopEventListener&&this.stopEventListener()}};$e=function(e,t,i,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(s=(a<3?o(s):a>3?o(t,i,s):o(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s}([ce.uA],$e);var je=$e,We=(i(3991),(0,_e.A)(je,Te,[],!1,null,null,null).exports),ze=function(){var e=this,t=e._self._c;return e._self._setupProxy,t(oe.A,{staticClass:"cardContainer data-side",attrs:{elevation:"4"}},[e.selectedEntities.length>0?t("div",e._l(e.selectedEntities,(function(i){return t("div",{key:i.dynamicId},[t("div",{staticClass:"entitie",on:{click:function(t){return e.selectEntity(i)}}},[e._v(e._s(i.name))])])})),0):e.pageSate!==e.PAGE_STATES.loaded||e.isBuildingSelected?e.pageSate===e.PAGE_STATES.loaded&&e.isBuildingSelected?t("div",{staticClass:"centered"},[e._v("\n    Aucune donnée à afficher ! veuillez selectionner un étage ou une pièce.\n  ")]):e.pageSate===e.PAGE_STATES.loading?t("div",{staticClass:"centered"},[t(h.A,{attrs:{size:70,width:3,color:"purple",indeterminate:""}})],1):e.pageSate===e.PAGE_STATES.error?t("div",{staticClass:"centered"},[t("div",[t(ae.A,{staticStyle:{"font-size":"5em"},attrs:{color:"red"}},[e._v("mdi-alert-circle-outline")])],1),e._v(" "),t("div",{attrs:{color:"red"}},[e._v("\n      Quelque chose s'est mal passé ! Veuillez\n      "),t(de.A,{attrs:{small:"",outlined:"",color:"red"},on:{click:e.retry}},[e._v("réessayer ")])],1)]):e._e():t("div",{staticClass:"dataContainer"},[t("div",{staticClass:"detail_header"},[t("div",{staticClass:"title_date"},[t("div",{staticClass:"date",attrs:{title:"recharger"}})])]),e._v(" "),t("div",{style:{"overflow-y":"scroll",height:"calc(100% - 200px)"}},e._l(e.data,(function(i,r){return t("div",{key:r},[t("div",{staticClass:"entitie",on:{click:function(t){return e.selectEntity(i)}}},[e._v(e._s(i.name))])])})),0)]),e._v(" "),t("div",{staticClass:"expander-wrapper"},[e._t("expander")],2),e._v(" "),e._t("body")],2)};ze._withStripped=!0;var Ze,He=i(7602);!function(e){e.SET_BUILDINGS="SET_BUILDINGS",e.SET_SELECTED_ZONE="SET_SELECTED_ZONE",e.SET_SELECTED_ROOMS="SET_SELECTED_ROOMS",e.SET_FLOORS="SET_FLOORS",e.SET_ROOMS="SET_ROOMS",e.SET_EQUIPMENTS="SET_EQUIPMENTS",e.SET_VIEWINFO="SET_VIEWINFO",e.SET_TEMPORALITY="SET_TEMPORALITY",e.ADD_VIEWER_LOADED="ADD_VIEWER_LOADED",e.REMOVE_VIEWER_LOADED="REMOVE_VIEWER_LOADED",e.SET_ITEM_SELECTED="SET_ITEM_SELECTED",e.SET_DATA="SET_DATA"}(Ze||(Ze={}));const qe={[Ze.SET_BUILDINGS](e,t){e.buildings=t},[Ze.SET_SELECTED_ZONE](e,t){e.zoneSelected=t},[Ze.SET_FLOORS](e,{id:t,items:i}){e.floors[t]=i},[Ze.SET_ROOMS](e,{id:t,items:i}){e.rooms[t]=i},[Ze.SET_EQUIPMENTS](e,{id:t,items:i}){e.roomBimObj[t]=i},[Ze.SET_VIEWINFO](e,{id:t,items:i}){e.buildingInfo[t]=i},[Ze.SET_TEMPORALITY](e,t){e.temporalitySelected=t},[Ze.ADD_VIEWER_LOADED](e,{id:t}){const i=Object.assign({},e.viewerStartedList);i[t]||(i[t]=t),e.viewerStartedList=i},[Ze.REMOVE_VIEWER_LOADED](e,{id:t}){const i=Object.assign({},e.viewerStartedList);delete i[t],e.viewerStartedList=i},[Ze.SET_ITEM_SELECTED](e,t){e.itemSelected=t},[Ze.SET_DATA](e,t){e.data=t},[Ze.SET_SELECTED_ROOMS](e,t){e.selectedRooms=t}};var Ke=function(e,t,i,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(s=(a<3?o(s):a>3?o(t,i,s):o(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s};let Ye=class extends ce.lD{config;selectedZone;data;selectedEntities;PAGE_STATES=V;pageSate=V.loading;isBuildingSelected=!0;retry;viewManager;async mounted(){this.pageSate=V.loaded,this.viewManager=te.getInstance(),this.isBuildingSelected=!0}async retriveData(){try{this.pageSate=V.loading;const e=localStorage.getItem("idBuilding")??"",t=e,i=[this.$store.dispatch(B.GET_ROOMS,{buildingId:e,patrimoineId:t,floorId:this.selectedZone.staticId,id:this.selectedZone.dynamicId})],r=await Promise.all(i);this.$store.commit(Ze.SET_DATA,r[0]),this.pageSate=V.loaded}catch(e){console.log(e),this.retry=this.retriveData,this.pageSate=V.error}}selectDataView(e){this.$emit("clickOnDataView",e)}watchSelectedZone(){if("building"===this.selectedZone.type)return this.isBuildingSelected=!0,void this.$store.commit(Ze.SET_DATA,[]);this.isBuildingSelected=!1,this.retriveData()}selectEntity(e){return this.$emit("selectEntity",e),this.viewManager.select(e),this.viewManager.colorItems(e,localStorage.getItem("idBuilding")??""),e}WatchSelectedEntitie(){}watchData(){}};Ke([(0,ce.kv)()],Ye.prototype,"config",void 0),Ke([(0,ce.kv)()],Ye.prototype,"selectedZone",void 0),Ke([(0,ce.kv)()],Ye.prototype,"data",void 0),Ke([(0,ce.kv)({default:[]})],Ye.prototype,"selectedEntities",void 0),Ke([(0,ce.ox)("selectedZone")],Ye.prototype,"watchSelectedZone",null),Ke([(0,ce.O5)()],Ye.prototype,"selectEntity",null),Ke([(0,ce.ox)("selectedEntities")],Ye.prototype,"WatchSelectedEntitie",null),Ke([(0,ce.ox)("data")],Ye.prototype,"watchData",null),Ye=Ke([(0,He.Ay)({components:{},filters:{}})],Ye);var Qe=Ye,Xe=(i(1040),(0,_e.A)(Qe,ze,[],!1,null,null,null).exports),Je=function(){var e=this,t=e._self._c;return t(p.A,[t("SimpleModale",{directives:[{name:"show",rawName:"v-show",value:!e.dialogColor&&!e.dialogIcon,expression:"!dialogColor && !dialogIcon"}],attrs:{modaleTitle:"Gestion des regroupements d'espace","show-dialog":e.showModal,width:"80%",persistent:"","error-message":e.errorMessage},on:{save:e.close,close:e.close},scopedSlots:e._u([{key:"body",fn:function(){return[t("div",{staticClass:"d-flex flex-row justify-space-around py-2"},e._l(e.groupsToDisplay,(function(i,r){return t("div",{key:r,staticClass:"w-30 d-flex flex-row justify-space-around"},[t("transition",{attrs:{"appear-active-class":"appear-custom","appear-to-class":e.animationsClass[r],appear:""}},[t("ListV1",{attrs:{extraMenuContent:e.extraMenuContents[r],items:i,title:e.titleCards[r],tooltipsAddButton:e.tooltipAddButton[r],typeGroup:r,"is-loading":e.isLoading[r],selectedItemsGlobal:e.selectedItems},on:{"create:entity":e.preRequirement,"select:entity":e.selectItem,"delete:entity":e.deleteItem,"update:entity":e.preRequirement,extraMenuClick:e.extraMenuClick}})],1)],1)})),0)]},proxy:!0}])}),e._v(" "),t("ChooseColorModale",{ref:"colorModale",attrs:{showDialog:e.dialogColor,width:"fit-content"},on:{save:e.postRequirement,close:e.postRequirement}}),e._v(" "),t("ChooseIconModale",{ref:"colorIcon",attrs:{showDialog:e.dialogIcon,width:"fit-content"},on:{save:e.postRequirement,close:e.postRequirement}})],1)};Je._withStripped=!0;var et=i(1207),tt=i(7557),it=i(7939),rt=i(724),ot=i(8505),at=i(2572),st=i(3579),nt=i(7100),lt=i(1827),ct=function(){var e=this,t=e._self._c;return t(oe.A,{staticClass:"rounded-xl",attrs:{"data-cy":"listV1",elevation:"2",width:"90%","max-width":"90%",color:"secondary"}},[t(et.ri,[e._v(e._s(e.title))]),e._v(" "),t(nt.A,{attrs:{"data-cy":"listV1SearchBar",filled:"",label:"Rechercher","single-line":"","hide-details":"true",height:"30px",loading:e.isLoading},scopedSlots:e._u([{key:"prepend-inner",fn:function(){return[t(lt.A,{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:r}){return[t(ae.A,e._g(e._b({},"v-icon",r,!1),i),[e._v(" mdi-magnify ")])]}}])},[e._v(" "),t("span",[e._v("Rechercher")])])]},proxy:!0},{key:"append",fn:function(){return[t("div",{staticClass:"d-flex align-center",attrs:{height:"100%"}},[t(lt.A,{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:r}){return[t(ae.A,e._g(e._b({attrs:{"data-cy":"listV1AddButton",disabled:e.typeGroup>0&&void 0===e.selectedItemsGlobal[e.typeGroup-1],color:"primary"},on:{click:e.createEntity}},"v-icon",r,!1),i),[e._v("\n              mdi-plus-circle\n            ")])]}}])},[e._v(" "),t("span",[e._v(" "+e._s(e.tooltipsAddButton))])])],1)]},proxy:!0}]),model:{value:e.searchModel,callback:function(t){e.searchModel=t},expression:"searchModel"}}),e._v(" "),t(it.A,{attrs:{dense:"",height:"40vh"}},[0===e.itemsFiltered.length&&0===e.searchModel.length?t("div",{staticClass:"helper"},[e._v("\n      Il n'y a pas de données disponibles\n    ")]):e._e(),e._v(" "),0===e.itemsFiltered.length&&0!==e.searchModel.length?t("div",{staticClass:"helper"},[e._v("\n      Votre recherche ne correspond à aucun élément\n    ")]):e._e(),e._v(" "),t(rt.A,{attrs:{color:"primary"},model:{value:e.selectedItem,callback:function(t){e.selectedItem=t},expression:"selectedItem"}},[t("transition-group",{attrs:{name:"list",tag:"ul"}},e._l(e.itemsFiltered,(function(i,r){return t(pe.A,{key:r,on:{click:function(t){return e.selectEntity(i)}}},[t(he.pr,[t(he.UZ,{attrs:{"data-cy":"listV1ItemTitle"},domProps:{textContent:e._s(i.title)}})],1),e._v(" "),t(ue.A,[t(at.A,{attrs:{"offset-x":"",transition:"slide-x-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:r}){return[t(lt.A,{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:o}){return[t(de.A,e._g(e._b({attrs:{icon:"","data-cy":"listV1ItemMenuButton"}},"v-btn",r,!1),{...o,...i}),[t(ae.A,{attrs:{small:""}},[e._v("\n                        "+e._s(e.mdiDotsVertical)+"\n                      ")])],1)]}}],null,!0)},[e._v(" "),t("span",[e._v("Menu")])])]}}],null,!0)},[e._v(" "),t(it.A,[t(pe.A,{on:{click:function(t){return e.openCloseUpdateModale(!0,i)}}},[t(ot.A,[t(ae.A,[e._v("mdi-pencil")])],1),e._v(" "),t(he.UZ,[e._v("Modifier")])],1),e._v(" "),t(pe.A,{attrs:{"data-cy":"listV1ItemMenuButtonDelete"},on:{click:function(t){return e.openCloseDeleteModale(!0,i)}}},[t(ot.A,[t(ae.A,[e._v("mdi-delete")])],1),e._v(" "),t(he.UZ,[e._v("Supprimer")])],1),e._v(" "),e._l(e.extraMenuContent,(function(r,o){return t("div",{key:r.title,staticClass:"d-print-block"},[t(pe.A,{attrs:{"data-cy":"listV1ItemMenuButtonExtra"},on:{click:function(t){return e.extraMenuClick(i,o,r.globalIndex)}}},[t(ot.A,[t(ae.A,[e._v(e._s(r.icon))])],1),e._v(" "),t(he.UZ,[e._v(e._s(r.title))])],1)],1)}))],2)],1)],1)],1)})),1),e._v(" "),t(tt.A,{attrs:{width:"40vw"},model:{value:e.dialogDelete,callback:function(t){e.dialogDelete=t},expression:"dialogDelete"}},[t("div",{attrs:{"data-cy":"listV1DialogDelete"}},[t(oe.A,[t(et.ri,{staticClass:"text-h5"},[e._v('Êtes-vous certain de vouloir supprimer ce groupe : "'+e._s(e.itemToUpdate.title)+'" ?\n            ')]),e._v(" "),t(et.SL,[t(st.A),e._v(" "),t(de.A,{attrs:{color:"primary",text:""},on:{click:function(t){return e.openCloseDeleteModale(!1,e.itemToUpdate)}}},[e._v("Fermer")]),e._v(" "),t(de.A,{attrs:{color:"primary","data-cy":"listV1DialogDeleteConfirmation"},on:{click:function(t){return e.deleteEntity(e.itemToUpdate)}}},[e._v("Oui")]),e._v(" "),t(st.A)],1)],1)],1)]),e._v(" "),t(tt.A,{attrs:{width:"40vw"},model:{value:e.dialogUpdate,callback:function(t){e.dialogUpdate=t},expression:"dialogUpdate"}},[t(oe.A,[t(et.ri,{staticClass:"text-h5"},[e._v('Modification du groupe : "'+e._s(e.itemToUpdate.title)+'"\n          ')]),e._v(" "),t(et.OQ,[t(p.A,[t(nt.A,{attrs:{label:"Nouveau nom"},model:{value:e.newTitle,callback:function(t){e.newTitle=t},expression:"newTitle"}})],1)],1),e._v(" "),t(et.SL,[t(st.A),e._v(" "),t(de.A,{attrs:{color:"primary",text:""},on:{click:function(t){return e.openCloseUpdateModale(!1,e.itemToUpdate)}}},[e._v("Fermer")]),e._v(" "),t(de.A,{attrs:{color:"primary"},on:{click:function(t){return e.updateEntity(e.itemToUpdate,e.newTitle)}}},[e._v("Sauvegarder")]),e._v(" "),t(st.A)],1)],1)],1)],1)],1)],1)};ct._withStripped=!0;var dt=i(289),pt={components:{mdiDotsVertical:dt.mdiDotsVertical,VBtn:de.A,VCard:oe.A,VCardActions:et.SL,VCardTitle:et.ri,VDialog:tt.A,VIcon:ae.A,VList:it.A,VListItem:pe.A,VListItemTitle:he.UZ,VListItemContent:he.pr,VListItemAction:ue.A,VListItemIcon:ot.A,VListItemGroup:rt.A,VMenu:at.A,VSpacer:st.A,VTextField:nt.A,VTooltip:lt.A},props:{isLoading:{type:Boolean,required:!1,default:function(){return!1},validator:function(){return!0}},extraMenuContent:{type:Array,required:!1,default:()=>[],validator:function(e){for(const t of e)if(!Object.hasOwn(t,"title")&&!Object.hasOwn(t,"icon")&&!Object.hasOwn(t,"globalIndex"))return!1;return!0}},items:{type:Array,required:!0,default:function(){return[]},validator:function(e){let t=!1;for(const i of e)if(i.hasOwnProperty("id")||(t=!0),i.hasOwnProperty("title")||(t=!0),t)return!1;return!0}},title:{type:String,required:!0,default:function(){return""},validator:function(e){return e.length<40}},typeGroup:{type:Number,required:!0,default:function(){return 0},validator:function(e){return e>=0}},tooltipsAddButton:{type:String,required:!1,default:function(){return"Ajouter un groupe"},validator:function(){return!0}},selectedItemsGlobal:{type:Array,required:!1,default:function(){return[void 0,void 0,void 0]},validator:function(){return!0}}},data:function(){return{dialogDelete:!1,dialogUpdate:!1,searchModel:"",selectedItem:void 0,headers:[{text:"Title",align:"start",sortable:!0,value:"title",width:"95%"},{text:"Actions",value:"actions",sortable:!1,width:"5%",align:"end"}],itemToUpdate:{title:"qwqw",id:12121,display:!0},newTitle:"",idToModify:"",mdiDotsVertical:dt.mdiDotsVertical}},computed:{itemsFiltered:function(){return this.items.filter((e=>e.display)).filter((e=>e.title.startsWith(this.searchModel)))}},mounted(){},methods:{extraMenuClick(e,t,i){this.$emit("extraMenuClick",e,t,i)},createEntity(){this.$emit("create:entity",this.searchModel,this.typeGroup,l.API_CREATION),this.searchModel=""},openCloseDeleteModale(e,t){this.itemToUpdate=t,this.dialogDelete=e},openCloseUpdateModale(e,t){this.itemToUpdate=t,this.dialogUpdate=e,this.newTitle=""},deleteEntity(e){this.openCloseDeleteModale(!1,e),e&&this.$emit("delete:entity",e)},selectEntity(e){this.$emit("select:entity",e)},updateEntity(e,t){e&&(this.$emit("update:entity",t,this.typeGroup,l.API_UPDATE,e),this.openCloseUpdateModale(!1,e))}}},ut=(i(8780),(0,_e.A)(pt,ct,[],!1,null,"76037cdc",null).exports),ht=i(367),mt=function(){var e=this,t=e._self._c;return t(tt.A,e._b({attrs:{persistent:""},model:{value:e.showDialog,callback:function(t){e.showDialog=t},expression:"showDialog"}},"v-dialog",e.$attrs,!1),[t("div",{staticClass:"content",attrs:{"data-cy":"simpleModale"}},[t("transition",{attrs:{name:"fade"}},[e.errorMessage.length>0?t(ht.A,{attrs:{type:"error"}},[e._v("\n        "+e._s(e.errorMessage)+"\n      ")]):e._e()],1),e._v(" "),t(oe.A,{staticClass:"d-flex flex-column justify-space-between pa-4",attrs:{"min-height":"50vh"}},[t(et.ri,{staticClass:"d-flex justify-start"},[t("span",{staticClass:"text-h5 font-weight-bold text-uppercase"},[e._v(e._s(e.modaleTitle))])]),e._v(" "),t("div",{staticClass:"slot-body"},[e._t("body")],2),e._v(" "),t(et.SL,[t(st.A),e._v(" "),t(de.A,{attrs:{"data-cy":"simpleModaleCloseBtn",color:"primary",outlined:"",text:""},on:{click:function(t){return e.onClickButton("Close")}}},[e._v("Fermer")]),e._v(" "),t(de.A,{attrs:{"data-cy":"simpleModaleSubmitBtn",color:"primary"},on:{click:function(t){return e.onClickButton("Save")}}},[e._v("\n          "+e._s(e.validateButtonText)+"\n        ")])],1)],1)],1)])};mt._withStripped=!0;var gt={components:{VBtn:de.A,VCard:oe.A,VCardActions:et.SL,VDialog:tt.A,VSpacer:st.A,VCardTitle:et.ri,VAlert:ht.A},props:{errorMessage:{type:String,required:!1,default:()=>""},showDialog:{type:Boolean,required:!1,default:()=>!1},modaleTitle:{type:String,required:!1,default:()=>"",validator:e=>/^.{0,60}$/.test(e)},validateButtonText:{type:String,required:!1,default:()=>"Valider"}},methods:{onClickButton(e){"Close"===e?this.onClickButtonClose():"Save"===e&&this.onClickButtonSave()},onClickButtonClose(){this.$emit("close")},onClickButtonSave(){this.$emit("save")}}},ft=(i(4430),(0,_e.A)(gt,mt,[],!1,null,null,null).exports),vt=i(1157),_t=i(8037),yt=i(19),bt=function(){var e=this,t=e._self._c;return t("SimpleModale",e._g(e._b({attrs:{modaleTitle:"Choisissez une icon"},scopedSlots:e._u([{key:"body",fn:function(){return[t(oe.A,{attrs:{elevation:"0"}},[t(yt.A,{staticClass:"mt-6 pa-16 scroll-list",attrs:{"no-gutters":""}},[t(vt.A,{attrs:{"data-cy":"chooseIconModaleAutocomplete","item-text":"k","item-value":"k",items:e.arrayIcon,label:"Standard"},scopedSlots:e._u([{key:"item",fn:function({item:i}){return[t(yt.A,{attrs:{"data-cy":"chooseIconModaleRow"}},[t(_t.A,{attrs:{cols:"3"}},[t(ae.A,[e._v(" "+e._s(i.v))])],1),e._v(" "),t(_t.A,{attrs:{cols:"9"}},[t("div",{staticClass:"d-flex flex-row justify-end"},[e._v(e._s(i.k))])])],1)]}}]),model:{value:e.icon,callback:function(t){e.icon=t},expression:"icon"}})],1)],1)]},proxy:!0}])},"SimpleModale",e.$attrs,!1),e.$listeners))};bt._withStripped=!0;var wt={components:{SimpleModale:ft,VAutocomplete:vt.A,VCard:oe.A,VCol:_t.A,VRow:yt.A,VIcon:ae.A},data(){return{arrayIcon:[],icon:""}},expose:["icon"],mounted(){this.arrayIcon=Object.entries(dt)?.filter((([e,t])=>e.startsWith("mdi"))),this.arrayIcon=this.arrayIcon?.map((([e,t])=>({k:e,v:t}))),console.log("Array icon = ",this.arrayIcon)}},It=(0,_e.A)(wt,bt,[],!1,null,null,null).exports,xt=i(3848),At=function(){var e=this,t=e._self._c;return t("SimpleModale",e._g(e._b({attrs:{modaleTitle:"Choisissez une couleur"},scopedSlots:e._u([{key:"body",fn:function(){return[t(oe.A,{staticClass:"d-flex flex-row justify-center",attrs:{elevation:"0"}},[t(xt.A,{staticClass:"ma-2",attrs:{"data-cy":"chooseColorModalePicker","dot-size":"30"},model:{value:e.color,callback:function(t){e.color=t},expression:"color"}})],1)]},proxy:!0}])},"SimpleModale",e.$attrs,!1),e.$listeners))};At._withStripped=!0;var Ct={components:{SimpleModale:ft,VCard:oe.A,VColorPicker:xt.A},data(){return{color:""}},expose:["color"]},Et={components:{ListV1:ut,SimpleModale:ft,ChooseColorModale:(0,_e.A)(Ct,At,[],!1,null,null,null).exports,ChooseIconModale:It,VContainer:p.A,VListItemIcon:ot.A},props:{showModal:{type:Boolean,required:!1,default:()=>!1}},data(){let e,t;const i=Array(3).fill([]);let r,o=Array(3).fill(!1),a={title:"",icon:"",color:"",type:n.GRP_NONE,verb:l.API_CREATION},c=Array(3).fill(void 0);try{r=s.getInstance("http://localhost:2023"),e=new R(r),t=new A(e,3)}catch{console.error("[Error]: Internal error !")}return{animationsClass:["animated fadeInLeft0","animated fadeInLeft1","animated fadeInLeft2"],delayErrorDisplay:10,dialogIcon:!1,dialogColor:!1,extraMenuContents:[[],[{title:"Assignation des espaces",icon:"mdi-ruler-square",globalIndex:1}],[{title:"Nomenclature",icon:"mdi-typewriter",globalIndex:2}]],errorMessage:"",groupsToDisplay:i,grpCGCWithChildrenController:t,infoTmp:a,isLoading:o,itemTmp:undefined,selectedItems:c,spinalAPI:r,titleCards:["Contexte","Catégorie","Groupe"],tooltipAddButton:["Ajouter un groupe de contexte","Ajouter un groupe de catégories","Ajouter un groupe de groupes"]}},mounted(){try{this.isLoading=[...this.isLoading],this.loadData()}catch{this.isLoading[n.GRP_CONTEXT]=!1,console.error("Error in mounted function")}},methods:{addNewItem(){try{if(void 0===this.infoTmp.type)throw new Error("Des informations sont manquantes");this.grpCGCWithChildrenController?.addNewItem(b.build({...this.infoTmp})).then((()=>{this.groupsToDisplay=this.grpCGCWithChildrenController?.reloadGroupToDisplay()??[[],[],[]]})).catch((e=>{this.printError(e)}))}catch(e){this.printError(e)}},close(){this.$emit("close")},deleteItem(e){if(e)try{this.grpCGCWithChildrenController?.deleteItem(e).then((()=>{this.groupsToDisplay=this.grpCGCWithChildrenController?.reloadGroupToDisplay()??[[],[],[]]})).catch((e=>{this.printError(e)}))}catch(e){this.printError(e)}},extraMenuClick(e,t,i){0===t&&1===i?(console.log("Assignation des espaces ...",e),this.$emit("activateSpaceAssignation",e)):0===t&&2===i&&(console.log("Nomenclature ...",e),this.$emit("activateNomenclatureModale",e))},postRequirement(){switch(this.dialogColor&&(this.infoTmp.color=this.$refs?.colorModale?.color??""),this.dialogIcon&&(this.infoTmp.icon=this.$refs?.colorIcon?.icon??""),this.toggleDialogModale("color",!1),this.toggleDialogModale("icon",!1),console.log("InfoTmp = ",this.infoTmp),this.infoTmp.verb){case l.API_CREATION:this.addNewItem();break;case l.API_UPDATE:this.updateItem(this.itemTmp);break;case l.API_DELETION:this.deleteItem(this.itemTmp);break;default:throw new Error("Une erreur est survenue !")}},preRequirement(e,t,i,r){switch(this.infoTmp.title=e,this.infoTmp.type=t,this.infoTmp.verb=i,r&&(this.itemTmp={...r}),t){case n.GRP_CATEGORY:this.toggleDialogModale("icon",!0);break;case n.GRP_GROUP:this.toggleDialogModale("color",!0);break;case n.GRP_CONTEXT:i===l.API_CREATION?this.addNewItem():i===l.API_UPDATE&&this.updateItem(this.itemTmp);break;default:throw new Error("Une erreur est survenue")}},loadData(){this.isLoading[n.GRP_CONTEXT]=!0,this.grpCGCWithChildrenController?.loadData().then((()=>{this.isLoading[n.GRP_CONTEXT]=!1,this.groupsToDisplay=this.grpCGCWithChildrenController?.reloadGroupToDisplay()??[[],[],[]]})).catch((e=>{console.error("Error in mounted function"),this.isLoading[n.GRP_CONTEXT]=!1,console.error(e)}))},printError(e){this.errorMessage=String(e).replaceAll("Error:",""),setTimeout((()=>{this.errorMessage=""}),1e3*this.delayErrorDisplay)},selectItem(e){e&&(this.grpCGCWithChildrenController?.selectItem(e),this.groupsToDisplay=this.grpCGCWithChildrenController?.reloadGroupToDisplay()??[[],[],[]],this.selectedItems=this.grpCGCWithChildrenController?.getSelected()??[void 0,void 0,void 0])},toggleDialogModale(e,t){switch(e){case"icon":this.dialogIcon=t;break;case"color":this.dialogColor=t;break;default:throw new Error("Une erreur interne est survenue")}},updateItem(e){if(e)try{this.grpCGCWithChildrenController?.editItem(this.infoTmp,e).then((()=>{this.groupsToDisplay=this.grpCGCWithChildrenController?.reloadGroupToDisplay()??[[],[],[]]})).catch((e=>{this.errorMessage=String(e),this.printError(e)}))}catch(e){this.errorMessage=String(e),this.printError(e)}}}},Rt=(i(5636),(0,_e.A)(Et,Je,[],!1,null,null,null).exports),Tt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"list-wrapper",class:e.classesLegend},[t("div",{staticClass:"list"},e._l(e.listItem,(function(i,r){return t("div",{key:r,staticClass:"item"},[t("div",{staticClass:"color",style:{background:i.color}}),e._v(" "),t("div",{staticClass:"title"},[e._v(e._s(i.title))])])})),0)])};Tt._withStripped=!0;var St={props:{listItem:{type:Array,required:!1,default(){return[]},validator(e){for(const t of e)if(!t.hasOwnProperty("title")||!t.hasOwnProperty("color"))return!1;return!0}}},setup(e){return{props:e,toggledLegend:(0,c.KR)(!0)}},methods:{toggleLegend(){this.toggledLegend=!this.toggledLegend}},computed:{classesLegend(){return this.toggledLegend?"slide-down-anim":"slide-up-anim"}}},Gt=(i(214),(0,_e.A)(St,Tt,[],!1,null,"e2b16f44",null).exports),Mt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"button-wrapper"},[t("div",{staticClass:"buttons"},[t(de.A,{attrs:{color:"primary",fab:"",small:""},on:{click:function(t){return e.expandLeft()}}},[t(ae.A,{attrs:{dark:"",medium:""}},[e._v(e._s(e.iconLeft))])],1),e._v(" "),t(de.A,{staticClass:"mt-2",attrs:{color:"primary",fab:"",small:""},on:{click:function(t){return e.schrinkRight()}}},[t(ae.A,{attrs:{dark:"",medium:""}},[e._v(e._s(e.iconRight))])],1)],1)])};Mt._withStripped=!0;var kt={components:{VBtn:de.A,VIcon:ae.A},props:{iconLeft:{type:String,default:function(){return"mdi-arrow-left-bold"},required:!1},iconRight:{type:String,default:function(){return"mdi-arrow-right-bold"},required:!1},defaultExpansion:{type:String,default:function(){return"one-tier"},required:!1}},data(){return{currentExpansion:"one-tier"}},mounted(){this.currentExpansion=this.defaultExpansion},methods:{expandLeft(){switch(this.defaultExpansion,this.currentExpansion){case"zero":this.currentExpansion="one-tier",this.$emit("updateExpansion",this.currentExpansion);break;case"one-tier":this.currentExpansion="half",this.$emit("updateExpansion",this.currentExpansion);break;case"half":this.currentExpansion="full",this.$emit("updateExpansion",this.currentExpansion)}},schrinkRight(){switch(this.currentExpansion){case"zero":break;case"one-tier":this.currentExpansion="zero",this.$emit("updateExpansion",this.currentExpansion);break;case"half":this.currentExpansion="one-tier",this.$emit("updateExpansion",this.currentExpansion);break;case"full":this.currentExpansion="half",this.$emit("updateExpansion",this.currentExpansion)}}}},Dt=(i(2494),(0,_e.A)(kt,Mt,[],!1,null,"3fac6a15",null).exports),Ot=function(){var e=this,t=e._self._c;return t("div",{staticClass:"menu-wrapper"},[t("div",{staticClass:"arrow-left"}),e._v(" "),t("div",{staticClass:"menu"},[t("div",{staticClass:"cell"},[t("div",{staticClass:"icon",on:{click:e.clickFirstCell}},[t(ae.A,{attrs:{color:"primary"}},[e._v(e._s(e.firstCell.icon))])],1),e._v(" "),t("div",{staticClass:"text"},[e._v("\n                "+e._s(e.firstCell.title)+"\n            ")])]),e._v(" "),t("div",{staticClass:"cell-main"},[t("div",{staticClass:"icon",on:{click:e.clickMainCell}},[t(ae.A,{attrs:{color:"secondary"}},[e._v(e._s(e.mainCell.icon))])],1)]),e._v(" "),t("div",{staticClass:"cell"},[t("div",{staticClass:"icon",on:{click:e.clickSecondCell}},[t(ae.A,{attrs:{color:"primary"}},[e._v(e._s(e.secondCell.icon))])],1),e._v(" "),t("div",{staticClass:"text"},[e._v("\n                "+e._s(e.secondCell.title)+"\n            ")])]),e._v(" "),t("div",{staticClass:"arrow-right"})])])};Ot._withStripped=!0;var Pt={components:{VIcon:ae.A},props:{mainCell:{type:Object,default:()=>({title:"",icon:"mdi-home"}),required:!1,validator:e=>Object.hasOwn(e,"title")&&Object.hasOwn(e,"icon")},firstCell:{type:Object,default:()=>({title:"Groupe Manager",icon:"mdi-format-list-bulleted-type"}),required:!1,validator:e=>Object.hasOwn(e,"title")&&Object.hasOwn(e,"icon")},secondCell:{type:Object,default:()=>({title:"Nomenclature",icon:"mdi-format-list-bulleted"}),required:!1,validator:e=>Object.hasOwn(e,"title")&&Object.hasOwn(e,"icon")}},methods:{clickFirstCell(){this.$emit("clickFirstCell")},clickSecondCell(){this.$emit("clickSecondCell")},clickMainCell(){this.$emit("clickMainCell")}}},Lt=(i(1057),(0,_e.A)(Pt,Ot,[],!1,null,"084ba5c6",null).exports),Ft=i(6554),Nt=i(6513),Vt=i(8106),Bt=i(1526),Ut=function(){var e=this,t=e._self._c;return t("SimpleModale",{attrs:{modaleTitle:"Nomenclature","show-dialog":e.showModal,width:"50%",persistent:"","error-message":e.errorMessage,validateButtonText:e.validateButtonText},on:{save:e.next,close:e.close},scopedSlots:e._u([{key:"body",fn:function(){return[t(yt.A,{ref:"firstView",staticClass:"content-wrapper"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"one"===e.currentMode,expression:"currentMode === 'one'"}],staticClass:"first-view px-8"},[t("div",{staticClass:"action-wrapper"},[t("div",{staticClass:"d-flex flex-row justify-space-between"},[t(at.A,{attrs:{"offset-x":"",transition:"slide-y-transition","close-on-content-click":!e.showMenuConfFilter,"close-on-click":!e.showMenuConfFilter,dense:""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:r}){return[t(lt.A,{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:o}){return[t(de.A,e._g(e._b({attrs:{color:"primary",width:"10em"}},"v-btn",r,!1),{...o,...i}),[t(ae.A,[e._v("mdi-plus")]),e._v(" "),e._v("\n                      Filtre\n                    ")],1)]}}],null,!0)},[e._v(" "),t("span",[e._v("Ajouter un filtre")])])]}}])},[e._v(" "),e._l(e.categories,(function(i){return e.showMenuConfFilter?e._e():t(it.A,{staticClass:"pa-4"},[t(Bt.A,[e._v(e._s(i))]),e._v(" "),t(rt.A,{attrs:{color:"primary"}},e._l(e.customFilter,(function(r){return r.category===i?t(pe.A,[t(he.pr,[t(he.UZ,{on:{click:function(t){return e.updateNewSelectedFilter(r)}}},[e._v(e._s(r.displayName))])],1)],1):e._e()})),1)],1)})),e._v(" "),e.showMenuConfFilter?t(it.A,{staticClass:"pa-4",attrs:{dense:"",flat:""}},[t("div",{staticClass:"text-h5 font-weight-bold text-uppercase",attrs:{"text-uppercase":"",color:"primary"}},[e._v("\n                  "+e._s(e.newSelectedFilterItem.displayName)+"\n                ")]),e._v(" "),t(rt.A,{attrs:{color:"primary"},model:{value:e.selectedFilterType,callback:function(t){e.selectedFilterType=t},expression:"selectedFilterType"}},["number"===e.newSelectedFilterItem.type?t(pe.A,{scopedSlots:e._u([{key:"default",fn:function({active:i}){return[t("div",{staticClass:"d-flex flex-column"},[t("div",{staticClass:"d-flex flex-row justify-space-around"},[t(ue.A,[t(Ft.A,{attrs:{"input-value":i,color:"deep-purple accent-4"}})],1),e._v(" "),t(he.pr,[t(he.UZ,{staticClass:"body-2"},[e._v("Plus grand que")])],1)],1),e._v(" "),i?t("div",{staticClass:"d-flex flex-row justify-end align-end"},[t(nt.A,{staticClass:"mx-2",style:{width:"8em"},attrs:{type:"number",label:"Valeur",outlined:""},on:{click:function(e){e.stopPropagation()}},model:{value:e.newSelectedFilterItem.value,callback:function(t){e.$set(e.newSelectedFilterItem,"value",t)},expression:"newSelectedFilterItem.value"}})],1):e._e()])]}}],null,!1,1836914048)}):e._e(),e._v(" "),"number"===e.newSelectedFilterItem.type?t(pe.A,{scopedSlots:e._u([{key:"default",fn:function({active:i}){return[t("div",{staticClass:"d-flex flex-column"},[t("div",{staticClass:"d-flex flex-row"},[t(ue.A,[t(Ft.A,{attrs:{"input-value":i,color:"deep-purple accent-4"}})],1),e._v(" "),t(he.pr,[t(he.UZ,{staticClass:"body-2"},[e._v("Moins grand que")])],1)],1),e._v(" "),i?t("div",{staticClass:"d-flex flex-row justify-end align-end"},[t(nt.A,{staticClass:"mx-2",style:{width:"8em"},attrs:{type:"number",label:"Valeur",outlined:""},on:{click:function(e){e.stopPropagation()}},model:{value:e.newSelectedFilterItem.value,callback:function(t){e.$set(e.newSelectedFilterItem,"value",t)},expression:"newSelectedFilterItem.value"}})],1):e._e()])]}}],null,!1,1308961893)}):e._e(),e._v(" "),"number"===e.newSelectedFilterItem.type?t(pe.A,{scopedSlots:e._u([{key:"default",fn:function({active:i}){return[t("div",{staticClass:"d-flex flex-column"},[t("div",{staticClass:"d-flex flex-row"},[t(ue.A,[t(Ft.A,{attrs:{"input-value":i,color:"deep-purple accent-4"}})],1),e._v(" "),t(he.pr,[t(he.UZ,{staticClass:"body-2"},[e._v("Entre\n                            ")])],1)],1),e._v(" "),i?t("div",{staticClass:"d-flex flex-row justify-end align-end"},[t(nt.A,{staticClass:"mx-2",style:{width:"8em"},attrs:{type:"number",label:"Min",outlined:""},on:{click:function(e){e.stopPropagation()}},model:{value:e.newSelectedFilterItem.min,callback:function(t){e.$set(e.newSelectedFilterItem,"min",t)},expression:"newSelectedFilterItem.min"}}),e._v(" "),t(nt.A,{staticClass:"mx-2",style:{width:"8em"},attrs:{type:"number",label:"Max",outlined:""},on:{click:function(e){e.stopPropagation()}},model:{value:e.newSelectedFilterItem.max,callback:function(t){e.$set(e.newSelectedFilterItem,"max",t)},expression:"newSelectedFilterItem.max"}})],1):e._e()])]}}],null,!1,1005474257)}):e._e(),e._v(" "),t(pe.A,{scopedSlots:e._u([{key:"default",fn:function({active:i}){return[t("div",{staticClass:"d-flex flex-column"},[t("div",{staticClass:"d-flex flex-row"},[t(ue.A,[t(Ft.A,{attrs:{"input-value":i,color:"deep-purple accent-4"}})],1),e._v(" "),t(he.pr,[t(he.UZ,{staticClass:"body-2"},[e._v("Egal à\n                            ")])],1)],1),e._v(" "),i?t("div",{staticClass:"d-flex flex-row justify-end align-end"},[t(nt.A,{staticClass:"mx-2",style:{width:"8em"},attrs:{type:"text",label:"Valeur",outlined:""},on:{click:function(e){e.stopPropagation()}},model:{value:e.newSelectedFilterItem.value,callback:function(t){e.$set(e.newSelectedFilterItem,"value",t)},expression:"newSelectedFilterItem.value"}})],1):e._e()])]}}],null,!1,635121135)})],1)],1):e._e(),e._v(" "),t("div",{staticClass:"d-flex flex-row pa-4",style:{backgroundColor:"white"}},[t(de.A,{attrs:{"data-cy":"simpleModaleCloseBtn",color:"primary",outlined:"",text:""},on:{click:function(t){return e.closeFilterMenu()}}},[e._v("Fermer")]),e._v(" "),t(de.A,{attrs:{"data-cy":"simpleModaleSubmitBtn",color:"primary"},on:{click:function(t){return e.saveFilter()}}},[e._v("\n                  Enregistrer\n                ")])],1)],2),e._v(" "),t("div",{staticClass:"search-wrapper"},[t(nt.A,{attrs:{width:"40em",filled:"",solo:"","hide-details":"",dense:"",placeholder:"Rechercher"},on:{input:e.debounceUpdateSelected},scopedSlots:e._u([{key:"prepend-inner",fn:function(){return[t(lt.A,{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t(de.A,e._g({attrs:{icon:""},on:{click:function(t){return e.searchByFilter()}}},i),[t(ae.A,[e._v(" mdi-magnify ")])],1)]}}])},[e._v("\n                    Rechercher\n                  ")])]},proxy:!0}]),model:{value:e.searchModel,callback:function(t){e.searchModel=t},expression:"searchModel"}})],1)],1),e._v(" "),t("div",{staticClass:"d-flex flex-row justify-start align-start my-4 flex-wrap"},e._l(e.searchFilter,(function(i){return t(Nt.A,{staticClass:"mr-4 mb-2 elevation-2",attrs:{close:"",label:""},on:{"click:close":function(t){return e.deleteFilterSearch(i)},click:function(t){return e.updateFilter(i)}}},[t(ae.A,{attrs:{left:""}},[e._v(" mdi-filter-variant ")]),e._v("\n              "+e._s(e.generateFilterOutput(i)))],1)})),1)]),e._v(" "),t("div",{ref:"bodyWrapper",staticClass:"body-wrapper"},[t("SpinalTable",{ref:"spinalTable",attrs:{items:e.filteredRooms,headers:e.headersTable,height:e.dataTableHeight,selectedItems:e.selectedItems,"show-select":!0},on:{"update:selectedItems":function(t){e.selectedItems=t},"update:selected-items":function(t){e.selectedItems=t}}})],1)]),e._v(" "),"two"===e.currentMode?t("div",{staticClass:"second-view px-4"},[t("div",{staticClass:"recap pa-8"},[t("div",{staticClass:"header text-uppercase text-h6 font-weight-bold"},[e._v("\n            Recapitulatif\n          ")]),e._v(" "),t("div",{staticClass:"body"},[t("div",{staticClass:"body-1"},[e._v("\n              Assignation de\n              "),t("span",{staticClass:"bg-black"},[t("span",[e._v(" "+e._s(e.selectedItems?.length??0)+" ")]),e._v("pièce"),e.selectedItems?.length>1?t("span",[e._v("s")]):e._e()])]),e._v(" "),t("div",{staticClass:"assignation mt-2"},[t("div",{staticClass:"assignation-table"},[t("div",{staticClass:"text-wrapper"},[t("span",[e._v("Au groupe de "),t("span",{staticClass:"underlined"},[e._v("contexte")]),e._v(":\n                  ")])]),e._v(" "),t("div",{staticClass:"select-wrapper"},[t(Vt.A,{attrs:{items:e.grpToDisplay[0],dense:"",width:"100%","return-object":"","item-text":"title",label:"Groupe de contexte",outlined:"","hide-details":""},on:{change:function(t){return e.updateSelection(0)}},model:{value:e.selectedGrp[0],callback:function(t){e.$set(e.selectedGrp,0,t)},expression:"selectedGrp[0]"}})],1),e._v(" "),t("div",{staticClass:"text-wrapper"},[t("span",[e._v("Au groupe de "),t("span",{staticClass:"underlined"},[e._v(" catégorie")]),e._v(":\n                  ")])]),e._v(" "),t("div",{staticClass:"select-wrapper"},[e.selectedGrp[0]?t(Vt.A,{attrs:{items:e.grpToDisplay[1],dense:"","return-object":"","item-text":"title",label:"Groupe de catégorie",outlined:"","hide-details":""},on:{change:function(t){return e.updateSelection(1)}},model:{value:e.selectedGrp[1],callback:function(t){e.$set(e.selectedGrp,1,t)},expression:"selectedGrp[1]"}}):e._e()],1),e._v(" "),t("div",{staticClass:"text-wrapper"},[t("span",[e._v("Au groupe de "),t("span",{staticClass:"underlined"},[e._v("groupe")]),e._v(":\n                  ")])]),e._v(" "),t("div",{staticClass:"select-wrapper"},[e.selectedGrp[1]?t(Vt.A,{attrs:{items:e.grpToDisplay[2],dense:"","return-object":"","item-text":"title",label:"Groupe de groupe",outlined:"","hide-details":""},on:{change:function(t){return e.updateSelection(2)}},model:{value:e.selectedGrp[2],callback:function(t){e.$set(e.selectedGrp,2,t)},expression:"selectedGrp[2]"}}):e._e()],1)]),e._v(" "),t("ul")]),e._v(" "),t("div",{staticClass:"body-1 mt-4"},[e._v("\n              Application de\n              "),t("span",{staticClass:"bg-black"},[t("span",[e._v(" "+e._s(e.searchFilter?.length??0)+" ")]),e._v("filtre"),e.searchFilter?.length>1?t("span",[e._v("s")]):e._e()]),e._v(" "),t("div",{staticClass:"application"},e._l(e.searchFilter,(function(i){return t(Nt.A,{staticClass:"mr-4 mb-2 mt-2 elevation-2",attrs:{label:""}},[e._v(e._s(e.generateFilterOutput(i)))])})),1)])]),e._v(" "),t("div",{staticClass:"footer d-flex justify-end align-end"},[e.selectedGrp[0]&&e.selectedGrp[1]&&e.selectedGrp[2]&&e.selectedItems.length>0?t(de.A,{staticClass:"primary",attrs:{width:"inherit"},on:{click:function(t){return e.addRoomsToGroup()}}},[e._v("\n              Assigner\n              "),t(ae.A,[e._v(" mdi-check ")])],1):e._e()],1)])]):e._e()])]},proxy:!0}])})};Ut._withStripped=!0;var $t=i(8130),jt=i(3743),Wt=function(){var e=this,t=e._self._c;return t($t.A,{ref:"table",staticClass:"fixed-first-column",staticStyle:{overflow:"hidden","max-height":"75vh",background:"transparent !important"},attrs:{id:"my-data-table","mobile-breakpoint":"0","no-data-text":"Pas de données disponibles",headers:e.headers,items:e.items,"items-per-page":8e3,height:e.height,"fixed-header":"","show-select":e.showSelect},on:{click:function(e){}},scopedSlots:e._u([e._l(e.headers,(function(i){return{key:`header.${i.value}`,fn:function({header:i}){return[t("div",{staticStyle:{display:"flex","flex-direction":"row","justify-content":"space-between","align-items":"center",height:"40px"}},[t("div",{staticStyle:{width:"35px",overflow:"hidden",transform:"translate(-10px, -3px)"}},[i.filterable?t(Vt.A,{staticClass:"d-inline-block",staticStyle:{width:"20px","min-width":"20px","font-size":"14px !important",transform:"translate(-5%, 10%)"},attrs:{"menu-props":{offsetY:!0},label:" ",multiple:"","append-icon":"mdi-chevron-down",color:"#14202C","item-color":"#14202C",items:e.getUniqueColumnValues(e.filteredContexts,i.text)},scopedSlots:e._u([{key:"selection",fn:function({item:r,index:o}){return[0==o?t("div",{staticStyle:{position:"absolute","background-color":"#14202c",color:"white","border-radius":"10px",width:"14px",height:"14px","font-size":"11px",display:"flex","justify-content":"center","align-items":"center",transform:"translate(20px, -8px)"}},[e._v("\n              "+e._s(e.selections[i.text].length)+"\n            ")]):e._e()]}}],null,!0),model:{value:e.selections[i.text],callback:function(t){e.$set(e.selections,i.text,t)},expression:"selections[header.text]"}},[e._v("\n          >\n          ")]):e._e()],1),e._v(" "),t("span",{attrs:{id:"headerName"}},[e._v(e._s(i.text))]),e._v(" "),t("div",{staticStyle:{width:"30px",display:"flex","justify-content":"center","align-items":"center"}},[t(ae.A,{attrs:{color:"black"},on:{click:function(t){return e.test(i)}}},[e._v("mdi-arrow-up-thin")])],1),e._v(" "),t("div",{staticStyle:{"border-right":"2px solid #d9d9d9",height:"100%","background-color":"white",position:"absolute",transform:"translate(-16px)"}})])]}}})),{key:"header.data-table-select",fn:function({}){return[e.showSelect?t(jt.A,{on:{click:function(t){return e.selectRows("all","dynamicId")}},model:{value:e.selectAllModel,callback:function(t){e.selectAllModel=t},expression:"selectAllModel"}}):e._e()]}},{key:"item",fn:function({item:i}){return[t("tr",[e.showSelect?t("td",{staticClass:"d-flex min-width"},[t(jt.A,{on:{click:function(t){return e.selectRows("single","dynamicId")}},model:{value:e.lexiconShowSelect[i.dynamicId],callback:function(t){e.$set(e.lexiconShowSelect,i.dynamicId,t)},expression:"lexiconShowSelect[item.dynamicId]"}})],1):e._e(),e._v(" "),e._l(e.headers,(function(r,o){return t("td",{key:o},[e._v("\n        "+e._s(i[r.value])+"\n      ")])}))],2)]}}],null,!0)})};Wt._withStripped=!0;var zt={props:["items","headers","noDataText","itemsPerPage","tableHeight","shadow","selections","contexts","height","selectedItemTab","selectedItems","showSelect"],data(){return{lexiconShowSelect:{},selected_id:null,selectAllModel:!1}},computed:{filteredContexts(){if(this.contexts)return this.contexts[0]?.data},computedStyle(){return{boxShadow:this.shadow?"rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px":"",marginTop:"65px",overflow:"auto",maxHeight:"75vh",background:"transparent",overflowX:"hidden"}}},methods:{selectDataView(e){this.selected_id=e.dynamicId,this.$emit("item-selected",e)},handleTableClick(){this.$emit("table-click")},selectItem(e){this.$emit("item-selected",e)},test(e){this.$emit("filter",e)},filterColumn(e){console.log("test")},selectRows(e="common",t){let i=this.items.map((e=>e[t])),r=this.selectAllModel;if(0!==i.length){if("all"===e){console.log("NextValue = ",r);for(const e of i)this.$set(this.lexiconShowSelect,e,r);console.log("Lexicon after",this.lexiconShowSelect)}this.recomputeSelectedItems(t)}},recomputeSelectedItems(e){const t=[];console.log("Selection a change",this.items),this.selectedItems&&this.selectedItems.length>0&&this.selectedItems.splice(-1*this.selectedItems.length);for(const i of this.items)this.lexiconShowSelect[i?.[e]]&&!0===this.lexiconShowSelect[i?.[e]]&&t.push(i);this.selectedItems.splice(0,t.length,...t)},getUniqueColumnValues(e,t){const[i,r]=t.split("/"),o=new Set;let a=!1;return e.forEach((e=>{let t=!1;e.categoryAttributes.forEach((e=>{e.name===r&&e.attributs.forEach((e=>{e.label===i&&(o.add(e.value),t=!0)}))})),t||(a=!0)})),a&&o.add("<empty>"),o.size>=10?[]:[...o]},getAttributeValue(e,t){if(!Array.isArray(e.categoryAttributes))return e[t];for(const i of e.categoryAttributes){const e=i.attributs.find((e=>e.label===t));if(e)return e.value}return""},handleMouseEnter(e){e.target.querySelectorAll(".colortd").forEach((e=>{e.classList.add("custom-hover-color")}))},handleMouseLeave(e){e.target.querySelectorAll(".colortd").forEach((e=>{e.classList.remove("custom-hover-color")}))}},watch:{selectedItemTab(e,t){this.selected_id=e,this.$refs[`row-${e}`]&&this.$refs[`row-${e}`].scrollIntoView({behavior:"smooth",block:"center"})},lexiconShowSelect(){}}},Zt=(i(121),(0,_e.A)(zt,Wt,[],!1,null,"4b8e760a",null).exports),Ht=i(2935),qt=i.n(Ht),Kt={components:{SimpleModale:ft,SpinalTable:Zt},props:{showModal:{type:Boolean,required:!1,default:()=>!1}},data(){const e=new $;return{assignToMode:!1,categories:[],customFilter:{},dataTableHeight:0,errorMessage:"",falseBool:!1,grpToDisplay:Array(3).fill([]),headersTable:[{text:"Nom",align:"start",value:"name"},{text:"Type",align:"start",value:"type"}],modelFilter:{},newSelectedFilterItem:undefined,nomenclatureController:e,searchModel:"",selectedGrp:Array(3).fill(void 0),showMenuConfFilter:!1,searchFilter:[],selectedFilterType:0,selectedItems:[],itemsTree:[],tree:[],updateFilterMode:!1,updateMenuModel:!1,roomsAvailable:[],currentMode:"one",validateButtonText:"Suivant"}},mounted(){this.initTableHeight(),this.loadData(),this.animSwitchMode()},methods:{animSwitchMode(){try{"one"===this.currentMode?(this.$refs.firstView.classList.remove("animate__animated","animate__fadeInRight","animate__faster"),this.$refs.firstView.classList.add("animate__animated","animate__fadeOutRight","animate__faster"),setTimeout((()=>{this.$refs.firstView.classList.remove("animate__animated","animate__fadeOutRight","animate__faster"),this.$refs.firstView.classList.add("animate__animated","animate__fadeInLeft","animate__faster")}),1e3*this.delayAnimation)):"two"===this.currentMode&&(this.$refs.firstView.classList.remove("animate__animated","animate__fadeInLeft","animate__faster"),this.$refs.firstView.classList.add("animate__animated","animate__fadeOutLeft","animate__faster"),setTimeout((()=>{this.$refs.firstView.classList.remove("animate__animated","animate__fadeOutLeft","animate__faster"),this.$refs.firstView.classList.add("animate__animated","animate__fadeInRight","animate__faster")}),1e3*this.delayAnimation))}catch(e){console.error(e)}},switchMode(){"one"===this.currentMode?(this.currentMode="two",this.validateButtonText="Retour"):"two"===this.currentMode&&(this.currentMode="one",this.validateButtonText="Suivant")},close(){this.$emit("close")},closeFilterMenu(){this.newSelectedFilterItem=void 0,this.showMenuConfFilter=!1,this.updateFilterMode=!1,this.searchByFilter()},debounceUpdateSelected:qt().debounce((function(){this.updateSelected()}),600,{leading:!0}),updateFilter(e){this.newSelectedFilterItem=e,this.updateFilterMode=!0},updateSelected(){this.$refs.spinalTable?this.$refs.spinalTable.recomputeSelectedItems("dynamicId"):console.log("Spinal Table refs not defined",this.$refs)},deleteFilterSearch(e){this.searchFilter=this.searchFilter.filter((t=>t.name!==e.name)),this.searchByFilter()},generateFilterOutput(e){const t=e.displayName,i=e.value;if("number"===e.type)switch(e.comparaison){case"gt":return`${t} au dessus de ${i}`;case"lt":return`${t} en dessous de ${i}`;case"btw":return`${t} entre ${e.min} et ${e.max}`;case"eq":return`${t} égale à ${i}`}else if("string"===e.type)return`${t} contient ${i}`;return"[Error] Une erreur est survenue ..."},initTableHeight(){this.dataTableHeight=this.$refs.bodyWrapper.clientHeight},initCustomFilters(){for(const e of this.nomenclatureController.filters)(this.customFilter[e.name]||"number"!==e.type)&&(this.customFilter[e.name]||"string"!==e.type)||(this.customFilter[e.name]=e);this.categories=[...new Set(this.nomenclatureController.filters.map((e=>e.category)))]},loadData(){this.nomenclatureController.loadData().then((e=>{this.initCustomFilters(),this.searchByFilter()})).then((()=>this.nomenclatureController.reloadGroupToDisplay())).then((e=>this.grpToDisplay=e)).then((()=>this.itemsTree=this.grpToDisplay?.[0])).catch((e=>{console.error(e)}))},updateNewSelectedFilter(e){this.newSelectedFilterItem=e,this.showMenuConfFilter=!0},updateSelection(e){let t=[];this.nomenclatureController.selectItem(this.selectedGrp[e]),t=this.nomenclatureController.reloadGroupToDisplay(),this.grpToDisplay.splice(-1*this.grpToDisplay.length),this.grpToDisplay.splice(0,t.length,...t),0===this.grpToDisplay[0].length&&(this.selectedGrp[0]=void 0),0===this.grpToDisplay[1].length&&(this.selectedGrp[1]=void 0),0===this.grpToDisplay[2].length&&(this.selectedGrp[2]=void 0)},saveFilter(){let e=0;switch(this.selectedFilterType){case 0:this.newSelectedFilterItem.comparaison="gt";break;case 1:this.newSelectedFilterItem.comparaison="lt";break;case 2:this.newSelectedFilterItem.comparaison="btw";break;case 3:this.newSelectedFilterItem.comparaison="eq"}this.updateFilterMode?(e=this.searchFilter.find((e=>e.id===this.newSelectedFilterItem.id)),this.searchFilter[e]=this.newSelectedFilterItem):this.searchFilter.push({...this.newSelectedFilterItem}),this.closeFilterMenu()},searchByFilter(){let e=[];for(const t in this.customFilter)this.modelFilter[t]&&e.push(this.customFilter[t]);this.nomenclatureController.reloadRoomToDisplay(this.searchFilter).then((e=>{this.roomsAvailable=e,this.$nextTick().then((()=>{this.updateSelected()})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}))},next(){this.switchMode(),this.animSwitchMode()},addRoomsToGroup(){this.selectedGrp[2]&&this.nomenclatureController.commitChange(this.selectedItems,this.selectedGrp[2]).then((()=>{console.log("Commited")})).catch((e=>{console.error(e)}))}},computed:{avalaibleFilter:function(){return this.nomenclatureController?.filters?this.nomenclatureController.filters:[]},filteredRooms:function(){return this.roomsAvailable?this.roomsAvailable.filter((e=>e.name.startsWith(this.searchModel))):[]}},watch:{customFilter:function(e){console.log("customFilter = ",e)}}},Yt=(i(2655),(0,_e.A)(Kt,Ut,[],!1,null,"2febee4c",null).exports),Qt=function(){var e=this,t=e._self._c;return t(oe.A,{staticClass:"extend",attrs:{elevation:"2",height:"100%"}},[t("div",{staticClass:"grid-cont",class:e.gridClass},["radar-grid"===e.viewMode?t("div",{staticClass:"component-wrapper"},[t("div",{staticClass:"header-wrapper"},[t("div",{staticClass:"header"},[t("div",{staticClass:"title-wrapper"},[t("div",{staticClass:"title"},[t("div",{staticClass:"title-content"},[e._v("Radar")])]),e._v(" "),"GrpRoom"===e.grpRoomFocus?t("div",{staticClass:"subtitle-wrapper"},[t("div",{staticClass:"subtitle"},[e._v("\n                contient\n                "),t("span",{staticClass:"bold-element"},[e._v(e._s(e.grpRoomWithChildrenController.groupToDisplay.filter((e=>e.display)).length))]),e._v("\n                pièce"),t("span",[e._v("s")])])]):e._e()])])]),e._v(" "),t("div",{staticClass:"radar-wrapper big-radar"},[t("Radar",{attrs:{id:"radar-chart-chart",options:e.radarOptions,data:e.dataRadar}})],1)]):e._e(),e._v(" "),t("div",{staticClass:"component-wrapper"},[t("div",{staticClass:"icon-fullscreen"},[t(lt.A,{attrs:{bottom:"","z-index":"80"},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:r}){return[t(de.A,e._g(e._b({attrs:{icon:""},on:{click:function(t){return e.reset()}}},"v-btn",r,!1),i),[t(ae.A,{attrs:{color:"greyed"}},[e._v("mdi-restore")])],1)]}}])},[e._v(" "),t("span",{staticClass:"z-index-60"},[e._v("Reinitialiser")])])],1),e._v(" "),t("div",{staticClass:"header-wrapper"},[t("div",{staticClass:"header"},[t("div",{staticClass:"title-wrapper"},[t("div",{staticClass:"title"},["GrpRoomList"===e.grpRoomFocus?t("div",{staticClass:"title-content"},[e._v("\n                Assignation "),t("br"),e._v("\n                des espaces\n              ")]):"GrpRoom"===e.grpRoomFocus&&e.currentGrpRoom?t("div",{staticClass:"title-content"},[e._v("\n                "+e._s(e.currentGrpRoom.title??"")+"\n                ")]):e._e(),e._v(" "),e.currentGrpRoom&&e.currentGrpRoom.parentTitle&&"GrpRoomList"===e.grpRoomFocus?t("div",{staticClass:"sub-title"},[t("span",{staticClass:"sub-title-content"},[e._v("categorie :")]),e._v(" "),t("span",{staticClass:"name-category"},[e._v(e._s(e.currentGrpRoom.parentTitle))])]):e._e(),e._v(" "),t("div",{staticClass:"tooltip"},[t(lt.A,{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:r}){return[t(de.A,e._g(e._b({attrs:{color:"grey",dark:"",icon:""}},"v-btn",r,!1),i),[t(ae.A,[e._v("mdi-information-outline")])],1)]}}])},[e._v(" "),"GrpRoom"===e.grpRoomFocus?t("span",[t("span",{staticClass:"bold-element"},[e._v(e._s(e.currentGrpRoom.title))]),e._v("\n                    est un\n                    "),t("span",{staticClass:"bold-element"},[e._v("groupe de pièce")]),e._v(" qui\n                    appartient à la categorie ...")]):e._e(),e._v(" "),"GrpRoomList"===e.grpRoomFocus?t("span",[e._v("Le composant Assignation des espaces permet de: "),t("br"),e._v("\n                    - visualiser des groupes de pièces appartenant à la même\n                    catégorie "),t("br"),e._v("\n                    - assigner des pièces à des groupes de pièces")]):e._e()])],1)]),e._v(" "),"GrpRoom"===e.grpRoomFocus?t("div",{staticClass:"subtitle-wrapper"},[t("div",{staticClass:"subtitle"},[e._v("\n                contient\n                "),t("span",{staticClass:"bold-element"},[e._v(e._s(e.grpRoomWithChildrenController.groupToDisplay.filter((e=>e.display)).length))]),e._v("\n                pièce"),t("span",[e._v("s")])])]):e._e()]),e._v(" "),t("div",{staticClass:"info-wrapper"},[t("div",{staticClass:"area-wrapper"},[t("div",{staticClass:"initial-area area",class:e.globalKpiClass},[t("div",{staticClass:"value"},[e._v("\n                  "+e._s("GrpRoomList"===e.grpRoomFocus?e.grpRoomWithChildrenController.globalArea.toFixed(2):e.currentGrpRoom.area.toFixed(2))+"\n                ")]),e._v(" "),t("div",{staticClass:"unit"},[e._v("m2")])]),e._v(" "),0!==e.grpRoomWithChildrenController.totalGain.value?t("div",{staticClass:"separator-wrapper"},[t("div",{staticClass:"separator"})]):e._e(),e._v(" "),0!==e.grpRoomWithChildrenController.totalGain.value?t("div",{staticClass:"new-area area"},[t("div",{staticClass:"value"},[e._v("\n                  "+e._s(e.grpRoomWithChildrenController.totalArea.value.toFixed(2))+"\n                ")]),e._v(" "),t("div",{staticClass:"unit"},[e._v("m2")])]):e._e()]),e._v(" "),t("div",{staticClass:"gain-wrapper"},[t("div",{staticClass:"arrow"},[e.grpRoomWithChildrenController.totalGain.percentage>0?t(ae.A,{attrs:{color:"green"}},[e._v("mdi-arrow-up-thick")]):e.grpRoomWithChildrenController.totalGain.percentage<0?t(ae.A,{attrs:{color:"red"}},[e._v("mdi-arrow-down-thick")]):e._e()],1),e._v(" "),e.grpRoomWithChildrenController.totalGain.percentage>0||e.grpRoomWithChildrenController.totalGain.percentage<0?t("div",{staticClass:"text"},["m2"===e.unitMode?t("span",[e._v("\n                  "+e._s(e.grpRoomWithChildrenController.totalGain.value.toFixed(2))+" m2\n                ")]):"percentage"===e.unitMode?t("span",[e._v("\n                  "+e._s(e.grpRoomWithChildrenController.totalGain.percentage.toFixed(2))+" %\n                ")]):e._e()]):e._e()])])])]),e._v(" "),t("div",{staticClass:"body-wrapper"},[e.showRadar?e._e():t("div",{staticClass:"component-actions-wrapper"},[t("div",{staticClass:"actions"},[t("div",{staticClass:"search-wrapper"},["GrpRoom"===e.grpRoomFocus?t(vt.A,{attrs:{multiple:"",label:e.searchBarPlaceholder,items:e.availableRooms,"item-text":"name","item-value":"dynamicId","single-line":"","hide-details":"true",outlined:"",dense:"",loading:e.isLoading},scopedSlots:e._u([{key:"prepend-inner",fn:function(){return[t(lt.A,{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:r}){return[t(ae.A,e._g(e._b({},"v-icon",r,!1),i),[e._v(" mdi-magnify ")])]}}],null,!1,2776186081)},[e._v(" "),t("span",[e._v("Rechercher")])])]},proxy:!0},{key:"no-data",fn:function(){return[t(pe.A,[t(he.UZ,[e._v("\n                      "+e._s(e.searchBarPlaceholder)+"\n                    ")])],1)]},proxy:!0},{key:"selection",fn:function({attr:i,on:r,item:o,selected:a,index:s}){return[s<3?t(Nt.A,e._g(e._b({staticClass:"white--text ma-1",attrs:{"input-value":a,label:"",color:e.createColorPropChipsBefore(o),"text-color":e.createColorPropChipsBefore(o,"text"),"deletable-chips":"",close:""},on:{"click:close":function(t){return e.deleteChipFromRoomSelection(o)}}},"v-chip",i,!1),r),[t("span",{domProps:{textContent:e._s(o.name)}})]):e._e(),e._v(" "),3===s?t("span",{staticClass:"grey--text text-caption"},[e._v("\n                    (+"+e._s(e.searchModel.length-3)+" autre"),e.searchModel.length-3>1?t("span",[e._v("s")]):e._e(),e._v(")\n                  ")]):e._e()]}},{key:"item",fn:function({item:i}){return[t(he.pr,{staticClass:"d-flex inline chips-legend-container"},["GrpRoom"===e.grpRoomFocus?t("span",{staticClass:"chip-legend-item",style:e.createStyleTitleSelectBefore(i)}):e._e(),e._v(" "),t(he.UZ,{staticClass:"ml-4",domProps:{textContent:e._s(i.name)}})],1),e._v(" "),t(ot.A,[t(ae.A,{attrs:{color:e.getFutureOperation(i)}},[e._v("\n                      mdi-arrow-right-bold\n                    ")])],1)]}}],null,!1,2512843478),model:{value:e.searchModel,callback:function(t){e.searchModel=t},expression:"searchModel"}}):e._e(),e._v(" "),t(yt.A,[t(_t.A,{attrs:{lg:"8",md:"8",sm:"8"}},["GrpRoomList"===e.grpRoomFocus?t(nt.A,{attrs:{dense:"",label:"Rechercher un groupe de pièce",placeholder:"",outlined:"","hide-details":"true","single-line":""},model:{value:e.searchModelGrp,callback:function(t){e.searchModelGrp=t},expression:"searchModelGrp"}}):e._e()],1)],1)],1),e._v(" "),"GrpRoom"===e.grpRoomFocus?t("div",{staticClass:"button-wrapper"},[t(de.A,{attrs:{disabled:null===e.searchModel,width:"80%","max-width":"80%",color:"primary"},on:{click:function(t){return e.addRoom("search")}}},[e._v("Ajouter")])],1):e._e()])]),e._v(" "),e.showRadar&&"grid"===e.viewMode?t("div",{staticClass:"radar-wrapper"},[t("Radar",{attrs:{id:"radar-chart",options:e.radarOptions,data:e.dataRadar}})],1):e._e(),e._v(" "),t("RoomGroupDataTable",{ref:"roomGroupDataTable",attrs:{data:e.dataFiltered,showRadar:e.showRadar,"is-loading-data":e.isLoadingData,grpRoomFocus:e.grpRoomFocus,headersTable:e.headersTable,dataTableHeight:e.dataTableHeight,unitMode:e.unitMode,showSelect:!1},on:{selectItem:e.selectItem,getOperationsItem:e.getOperationsItem,guessItemColor:e.guessItemColor,restore:e.restore,deleteEntity:e.deleteEntity}})],1),e._v(" "),t("div",{staticClass:"footer-wrapper"},[t("div",{staticClass:"footer"},[t("div",{staticClass:"toggle-group"},[t("ToggleButtonV1",{attrs:{color1:"black",color2:"white","symbol-left":"mdi-tape-measure","symbol-right":"mdi-percent"},on:{toggled:e.toggleUnitMode}}),e._v(" "),"grid"===e.viewMode?t("ToggleButtonV1",{ref:"radar",attrs:{color1:"black",color2:"white","symbol-left":"mdi-grid","symbol-right":"mdi-radar"},on:{toggled:e.toggleRadarVisibility}}):e._e()],1),e._v(" "),t("div",{staticClass:"actions"},[t(de.A,{directives:[{name:"show",rawName:"v-show",value:"GrpRoomList"===e.grpRoomFocus,expression:"grpRoomFocus === 'GrpRoomList'"}],attrs:{color:"primary",text:"",outlined:""},on:{click:function(t){return e.updateDataTableHeight()}}},[e._v("Fermer")]),e._v(" "),t(de.A,{directives:[{name:"show",rawName:"v-show",value:"GrpRoom"===e.grpRoomFocus,expression:"grpRoomFocus === 'GrpRoom'"}],attrs:{color:"primary"},on:{click:function(t){return e.goBack()}}},[e._v("Retour")]),e._v(" "),t(de.A,{directives:[{name:"show",rawName:"v-show",value:"GrpRoomList"===e.grpRoomFocus&&!e.showRadar,expression:"grpRoomFocus === 'GrpRoomList' && !showRadar"}],attrs:{color:"primary"},on:{click:function(t){return e.commitChange()}}},[e._v("Valider\n            ")]),e._v(" "),t(de.A,{directives:[{name:"show",rawName:"v-show",value:"GrpRoom"===e.grpRoomFocus&&!e.showRadar,expression:"grpRoomFocus === 'GrpRoom' && !showRadar"}],attrs:{color:"primary"},on:{click:function(t){return e.commitChangeGrpRoom()}}},[e._v("Valider\n            ")])],1)])])])])])};Qt._withStripped=!0;var Xt=function(){var e=this,t=e._self._c;return t("div",{ref:"btn",staticClass:"con",on:{click:function(t){return e.toggleButton()}}},[t("div",{ref:"ball",staticClass:"ball"},[t("span",{ref:"text",staticClass:"text"},["1"===e.state?t(ae.A,[e._v(e._s(e.symbolLeft))]):t(ae.A,[e._v(e._s(e.symbolRight))])],1)])])};Xt._withStripped=!0;var Jt={components:{VIcon:ae.A},props:{color1:{type:String,required:!1,default:()=>"black"},color2:{type:String,required:!1,default:()=>"white"},symbolLeft:{type:String,required:!1,default:()=>"Op1"},symbolRight:{type:String,required:!1,default:()=>"Op2"}},setup(e){let t=(0,c.KR)("1");const i=(0,c.KR)(null),r=(0,c.KR)(null),o=(0,c.KR)(null),a={background:[`${e.color1}`,`${e.color1}`],border:[`0.2em solid ${e.color1}`,`0.2em solid ${e.color1}`],offset:[0,1]},s={background:[`${e.color2}`,`${e.color2}`],transform:["translateX(0)","translateX(1.5em)"],border:[`0.2em solid ${e.color2}`,`0.2em solid ${e.color2}`],offset:[0,1]};return{ballAnimation:void 0,ballTransitionKeyframes:void 0,bgAnimation:void 0,bgTransitionKeyframes:void 0,optionsbgTransition:a,optionsRotateLeft:{content:[e.symbolLeft,"","",e.symbolRight],transform:["rotate(0deg)","rotate(90deg)","rotate(-90deg)","rotate(0deg)"],opacity:[100,0,0,100],offset:[0,.5,.51,1],color:[`${e.color1}`,"","",`${e.color1}`]},ball:i,btn:r,keyframesOptions:{duration:300,fill:"both"},props:e,animationIsDone:(0,c.KR)(!0),optionsSlideLeft:s,state:t,text:o,textKeyframes:void 0,textAnimation:void 0}},mounted(){this.initData()},methods:{initData(){this.initBgAnimation(),this.initBallAnimation(),this.initTextAnimation()},initBgAnimation(){this.bgTransitionKeyframes=new KeyframeEffect(this.btn,this.optionsbgTransition,this.keyframesOptions),this.bgTransitionKeyframes&&(this.bgAnimation=new Animation(this.bgTransitionKeyframes,document.timeline),this.btn&&this.ball&&this.text&&(this.btn.style.background=this.props.color1,this.ball.style.background=this.props.color2,this.text.style.color=this.props.color1),this.bgAnimation&&this.bgAnimation.addEventListener("finish",(()=>{this.animationIsDone=!0})))},initBallAnimation(){this.ballTransitionKeyframes=new KeyframeEffect(this.ball,this.optionsSlideLeft,this.keyframesOptions),this.ballTransitionKeyframes&&(this.ballAnimation=new Animation(this.ballTransitionKeyframes,document.timeline))},initTextAnimation(){this.textKeyframes=new KeyframeEffect(this.text,this.optionsRotateLeft,this.keyframesOptions),this.textKeyframes&&(this.textAnimation=new Animation(this.textKeyframes,document.timeline))},toggleButton(){let e="1"===this.state?1:-1;this.animationIsDone&&(this.state="1"===this.state?"2":"1",this.$emit("toggled","1"===this.state?"symbolLeft":"symbolRight"),this.animationIsDone=!1,this.bgAnimation&&this.ballAnimation&&this.textKeyframes&&(this.bgAnimation.playbackRate=e,this.ballAnimation.playbackRate=e,this.textAnimation.playbackRate=e,this.bgAnimation.play(),this.ballAnimation.play(),this.textAnimation.play()))}}},ei=Jt,ti=(i(7817),(0,_e.A)(ei,Xt,[],!1,null,"60c833eb",null).exports),ii=function(){var e=this,t=e._self._c;return t("div",{ref:"btn",staticClass:"con",on:{click:function(t){return e.toggleButton()}}},[t("span",{ref:"text",staticClass:"text"},[t(ae.A,{attrs:{color:e.color1}},[e._v(e._s(e.symbol))])],1)])};ii._withStripped=!0;var ri={props:{color1:{type:String,required:!1,default:()=>"black"},symbol:{type:String,required:!1,default:()=>"Op1"}},setup(e){let t=(0,c.KR)("1");const i=(0,c.KR)(null),r=(0,c.KR)(null),o=(0,c.KR)(null);return{optionsRotateLeft:{transform:["rotate(0deg)","rotate(180deg)"],offset:[0,1],color:[`${e.color1}`]},ball:i,btn:r,keyframesOptions:{duration:300,fill:"both"},props:e,animationIsDone:(0,c.KR)(!0),state:t,text:o,textKeyframes:void 0,textAnimation:void 0}},mounted(){this.initData()},methods:{initData(){this.initTextAnimation()},initTextAnimation(){this.textKeyframes=new KeyframeEffect(this.text,this.optionsRotateLeft,this.keyframesOptions),this.textKeyframes&&(this.textAnimation=new Animation(this.textKeyframes,document.timeline),this.textAnimation&&this.textAnimation.addEventListener("finish",(()=>{this.animationIsDone=!0})))},toggleButton(){let e="1"===this.state?1:-1;this.animationIsDone&&(this.state="1"===this.state?"2":"1",this.$emit("toggled","1"===this.state?"left":"right"),this.animationIsDone=!1,this.textAnimation&&(this.textAnimation.playbackRate=e,this.textAnimation.play()))}}},oi=ri,ai=(i(2595),(0,_e.A)(oi,ii,[],!1,null,"7de34bc7",null).exports),si=function(){var e=this,t=e._self._c;return t("div",{ref:"dataTableWrapper",staticClass:"data-table-wrapper"},[e.showRadar?e._e():t($t.A,{ref:"dataTable",staticClass:"secondary",attrs:{loading:e.isLoadingData,headers:e.headersTable,"items-per-page":10,items:e.data,"loading-text":"En cours de chargement ...","hide-default-footer":e.data?.length<10,fixedHeader:"",height:e.dataTableHeight},scopedSlots:e._u([{key:"body",fn:function({items:i,headers:r}){return[i.length>0&&"GrpRoomList"===e.grpRoomFocus?t("transition-group",{tag:"tbody",attrs:{name:"list"}},e._l(i,(function(i){return t("tr",{key:i.id,on:{click:function(t){return e.selectItem(i,"item")}}},[t("td",{staticClass:"cursor-pointer"},[t("div",{staticClass:"font-weight-bold d-flex flex-row justify-start align-center"},[e._v("\n              "+e._s(i.title)+"\n            ")])]),e._v(" "),t("td",[t("div",{staticClass:"gain-cell d-flex flex-row justify-end align-center"},[i.gainKpi.value>0?t("div",{staticClass:"arrow-svg"},[t(ae.A,{attrs:{color:"green"}},[e._v("mdi-arrow-top-right-thick")])],1):e._e(),e._v(" "),i.gainKpi.value<0?t("div",{staticClass:"arrow-svg"},[t(ae.A,{attrs:{color:"red"}},[e._v("mdi-arrow-bottom-right-thick")])],1):e._e(),e._v(" "),i.gainKpi.value>0||i.gainKpi.value<0?t("div",{staticClass:"greyed"},["percentage"===e.unitMode?t("span",[e._v("\n                  "+e._s(i.gainKpi.percentage.toFixed(2))+" %\n                ")]):e._e(),e._v(" "),"m2"===e.unitMode?t("span",[e._v("\n                  "+e._s(i.gainKpi.value.toFixed(2))+" m2\n                ")]):e._e()]):e._e()])]),e._v(" "),t("td",[t("div",{staticClass:"d-flex flex-row justify-end align-center"},[e.getOperationsItem(i,"ToAssign")?t(Nt.A,{staticClass:"ma-2 primary",attrs:{text:"",outlined:"",label:""}},[e._v("\n                + "+e._s(e.getOperationsItem(i,"ToAssign"))+"\n              ")]):e._e(),e._v(" "),e.getOperationsItem(i,"ToDeAssign")?t(Nt.A,{staticClass:"ma-2 primary",attrs:{label:""}},[e._v("\n                - "+e._s(e.getOperationsItem(i,"ToDeAssign"))+"\n              ")]):e._e()],1)]),e._v(" "),t("td",[t("div",{staticClass:"greyed d-flex justify-end align-center"},[e._v("\n              "+e._s(i.children.filter((e=>"ToDeAssign"!==e.operations)).length??0)+"\n            ")])]),e._v(" "),t("td",[t("div",{staticClass:"greyed d-flex justify-end align-center"},[e._v("\n              "+e._s(i.area.toFixed(2))+"\n            ")])])])})),0):e._e(),e._v(" "),i.length>0&&"GrpRoom"===e.grpRoomFocus?t("transition-group",{tag:"tbody",attrs:{name:"list"}},e._l(i,(function(i){return t("tr",{key:i.id,on:{click:function(t){return e.selectItem(i,"item")}}},[t("td",[t("div",{staticClass:"bold-cell"},[i.display?e._e():t("span",{staticClass:"bold-darkgreyed"},[e._v("[Supprime]")]),e._v(" "),"GrpRoom"===e.grpRoomFocus?t("span",{staticClass:"chip-legend-item",style:e.createStyleTitle(i)}):e._e(),e._v("\n              "+e._s(i.title)+"\n            ")])]),e._v(" "),t("td",[t("div",{staticClass:"d-flex justify-start align-center def-size"},[e._v("\n              "+e._s(i.grandParentTitle)+"\n            ")])]),e._v(" "),t("td",[t("div",{staticClass:"d-flex justify-start align-center"},[e._v("\n              "+e._s(i.parentTitle)+"\n            ")])]),e._v(" "),t("td",[t("div",{staticClass:"d-flex justify-end align-center"},[e._v("\n              "+e._s(i.floorName)+"\n            ")])]),e._v(" "),t("td",[t("div",{staticClass:"d-flex justify-end align-center font-weight-bold"},[e._v("\n              "+e._s(i.area)+"\n            ")])]),e._v(" "),t("td",[t("div",{staticClass:"d-flex justify-end align-center"},[t(at.A,{attrs:{"offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:r}){return[t(lt.A,{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:o}){return[t(de.A,e._g(e._b({attrs:{icon:""}},"v-btn",r,!1),{...o,...i}),[t(ae.A,{attrs:{color:"greyed"}},[e._v("mdi-menu")])],1)]}}],null,!0)},[e._v(" "),t("span",[e._v("Menu")])])]}}],null,!0)},[e._v(" "),t(it.A,["ToDeAssign"===i.operations?t(pe.A,{on:{click:function(t){return e.restore(i)}}},[t(ot.A,[t(ae.A,[e._v("mdi-reload")])],1),e._v(" "),t(he.UZ,[e._v("Retablir")])],1):e._e(),e._v(" "),"ToDeAssign"!==i.operations?t(pe.A,{on:{click:function(t){return e.deleteEntity(i,"menu")}}},[t(ot.A,[t(ae.A,[e._v("mdi-delete")])],1),e._v(" "),t(he.UZ,[e._v("Supprimer")])],1):e._e()],1)],1)],1)])])})),0):e._e()]}}],null,!1,3590683726),model:{value:e.selectedRow,callback:function(t){e.selectedRow=t},expression:"selectedRow"}})],1)};si._withStripped=!0;var ni={data(){return{selectedRow:[],delayAnimation:.2}},props:{data:{type:Array,default:()=>[]},showRadar:{type:Boolean,default:()=>!1},isLoadingData:{type:Boolean,default:()=>!1},grpRoomFocus:{type:String,default:()=>{},validator:e=>["GrpRoomList","GrpRoom"].includes(e)},headersTable:{type:Array,required:!0,default:()=>[]},dataTableHeight:{type:Number,required:!0,default:()=>200},unitMode:{type:String,required:!0,default:()=>"m2"}},methods:{animDataTable(){try{"GrpRoom"===this.grpRoomFocus?(this.$refs.dataTable.$el.classList.remove("animate__animated","animate__fadeInRight","animate__faster"),this.$refs.dataTable.$el.classList.add("animate__animated","animate__fadeOutRight","animate__faster"),setTimeout((()=>{this.$refs.dataTable.$el.classList.remove("animate__animated","animate__fadeOutRight","animate__faster"),this.$refs.dataTable.$el.classList.add("animate__animated","animate__fadeInLeft","animate__faster")}),1e3*this.delayAnimation)):"GrpRoomList"===this.grpRoomFocus&&(this.$refs.dataTable.$el.classList.remove("animate__animated","animate__fadeInLeft","animate__faster"),this.$refs.dataTable.$el.classList.add("animate__animated","animate__fadeOutLeft","animate__faster"),setTimeout((()=>{this.$refs.dataTable.$el.classList.remove("animate__animated","animate__fadeOutLeft","animate__faster"),this.$refs.dataTable.$el.classList.add("animate__animated","animate__fadeInRight","animate__faster")}),1e3*this.delayAnimation))}catch(e){console.error(e)}},selectItem(e,t){this.$emit("selectItem",e,t)},getOperationsItem(e,t){let i=0;return 0===e.operations.length?0:(i=e.children?.reduce(((e,i)=>e+(i.operations===t?1:0)),0),"ToAssign"===t&&(i+=e.children?.reduce(((e,t)=>e+("ToReAssign"===t.operations?1:0)),0)),i)},guessItemColor(e){return re.guessItemColor(e.operations)},restore(e){this.$emit("restore",e)},deleteEntity(e,t){this.$emit("deleteEntity",e,t)},createStyleTitle(e){return{background:this.guessItemColor(e),height:"2em"}}}},li=(i(5499),(0,_e.A)(ni,si,[],!1,null,"4367b94a",null).exports),ci=i(416),di=i(2171),pi=i(2535);di.t1.register(di.dN,di.s$,di.pr,di.No,di.FN,di.hE);var ui,hi={components:{VAutocomplete:vt.A,VCard:oe.A,VChip:Nt.A,VTooltip:lt.A,VMenu:at.A,ToggleButtonV1:ti,ToggleButtonV2:ai,Radar:ci.Vd,VBtn:de.A,VIcon:ae.A,VDataTable:$t.A,VSelect:Vt.A,VList:it.A,VListIcon:pi.VListIcon,VListItem:pe.A,VListItemTitle:he.UZ,VListItemIcon:ot.A,VListItemContent:he.pr,VTextField:nt.A,RoomGroupDataTable:li},data(){let e=s.getInstance(),t=new R(e),i=new T,r=new G;const o=(0,c.KR)(null),a=(0,c.KR)({responsive:!0}),n=(0,c.KR)(!0),l=(0,c.KR)(null),d=(0,c.KR)(null),p=(0,c.KR)([]),u=(0,c.KR)(""),h=(0,c.KR)(null),m=(0,c.KR)("GrpRoomList"),g=(0,c.KR)(!1),f=(0,c.KR)(void 0),v=new re(t,i,r),_=[{text:"Groupe de pièces",align:"start",value:"title"},{text:"Gains",align:"end",value:"gain"},{text:"Actions",align:"end",value:"operations"},{text:"Nb pièces",align:"end",value:"length"},{text:"Superficie (m2)",align:"end",value:"newArea"}];return{searchModel:p,searchModelGrp:u,isLoading:g,headersTable:(0,c.KR)(_),data:(0,c.KR)(),dataTable:o,grpRoomFocus:m,currentGrpRoom:f,assignationSpaceHeaders:_,grpRoomHeader:[{text:"Pièces",align:"start",value:"title"},{text:"Categorie",align:"start",value:"categorie"},{text:"Groupe",align:"start",value:"groupe"},{text:"Etage",align:"start",value:"floorName"},{text:"Superficie (m2)",align:"end",value:"area"},{text:"Actions",align:"end",value:"action"}],grpRoomWithChildrenController:v,roomListAndObj:(0,c.KR)(N.build()),unitMode:"m2",showRadar:!1,showDataTableGrpRoom:!1,showDataTableGrpRoomList:!0,radarOptions:a,radar:d,isLoadingData:n,dataTableHeight:0,dataTableWrapper:l,categoriesModel:h,viewMode:"grid"}},mounted(){this.dataTableHeight=this.$refs.roomGroupDataTable.$el.clientHeight-130,this.loadData()},methods:{assignNewHeader(){"GrpRoom"===this.grpRoomFocus?this.headersTable=[...this.grpRoomHeader]:"GrpRoomList"===this.grpRoomFocus&&(this.headersTable=[...this.assignationSpaceHeaders])},loadData(e){e&&this.switchCategory(e),this.grpRoomWithChildrenController.loadData().then((()=>this.grpRoomWithChildrenController.reloadGroupToDisplay())).then((e=>{this.data=e,this.roomListAndObj=this.grpRoomWithChildrenController.rooms,this.categoriesModel=this.grpRoomWithChildrenController.currentCategory,this.isLoadingData=!1})).catch((e=>{console.error(e)}))},updateDataTableHeight(){console.log("this refs = ",this.$refs)},toggleComponentMode(e){try{if("GrpRoomList"!==this.grpRoomFocus&&"item"===e)return;this.grpRoomFocus="GrpRoomList"===this.grpRoomFocus?"GrpRoom":"GrpRoomList","GrpRoomList"===this.grpRoomFocus?(this.showDataTableGrpRoom=!1,this.showDataTableGrpRoomList=!this.showDataTableGrpRoom):"GrpRoom"===this.grpRoomFocus&&(this.showDataTableGrpRoom=!0,this.showDataTableGrpRoomList=!this.showDataTableGrpRoom),this.assignNewHeader(),this.updateDataTableHeight(),this.$refs.roomGroupDataTable.animDataTable()}catch(e){console.error(e)}},saveGrpRoom(){},commitChangeGrpRoom(){this.grpRoomWithChildrenController.commitChangeGrpRoom().then((()=>{console.log("Selected Grp Room Commited"),this.goBack()})).catch((e=>{console.error(e)}))},selectItem(e,t){this.updateDataTableHeight(),this.grpRoomWithChildrenController.selectItem(e),"GrpRoomList"!==this.grpRoomFocus&&"item"===t||(this.searchModel="",this.toggleComponentMode(t),this.grpRoomWithChildrenController.setFocus(this.grpRoomFocus),this.currentGrpRoom=this.grpRoomWithChildrenController.getSelected(),this.data=this.grpRoomWithChildrenController.reloadGroupToDisplay(),this.updateFocus())},goBack(){this.grpRoomFocus="GrpRoomList",this.searchModel="",this.updateFocus(),this.assignNewHeader(),this.reloadData(),this.$refs.roomGroupDataTable.animDataTable(),this.showRadar&&this.$refs.radar.$el.click()},setViewModeByExpansion(e){switch(e){case"one-tier":case"half":this.viewMode="grid";break;case"full":this.viewMode="radar-grid",this.showRadar=!1}},reloadData(){this.data=[...this.grpRoomWithChildrenController.reloadGroupToDisplay()]},reset(){this.grpRoomWithChildrenController.reset().then((()=>{this.reloadData()})).catch((e=>{console.error(e)}))},commitChange(){this.grpRoomWithChildrenController.commitChange().then((()=>{this.goBack()})).catch((e=>{console.error(e)}))},getOperationsItem(e,t){let i=0;return 0===e.operations.length?0:(i=e.children?.reduce(((e,i)=>e+(i.operations===t?1:0)),0),"ToAssign"===t&&(i+=e.children?.reduce(((e,t)=>e+("ToReAssign"===t.operations?1:0)),0)),i)},guessItemColor(e){return re.guessItemColor(e.operations)},getFutureOperation(e){const t=this.grpRoomWithChildrenController.getFutureOperation(e);return re.guessItemColor(t)},addRoom(e,t){let i=[];if(!t)for(const t of this.searchModel)i.push(this.grpRoomWithChildrenController.addItemFromViewer(e,r.iGroupRoomItemFactory.build({id:t})));Promise.all(i).then().then((()=>{this.reloadData()})).catch((e=>{console.error(e)})),this.searchModel=[]},updateFocus(){this.grpRoomWithChildrenController.setFocus(this.grpRoomFocus)},tmpItemClass(e){return e.display?e.tmp?"tmp-item":void 0:"soft-deleted-item"},deleteEntity(e,t){this.grpRoomWithChildrenController.deleteItem(e).then((()=>{this.reloadData()})).catch((e=>{console.error(e)}))},toggleUnitMode(){"m2"===this.unitMode?this.unitMode="percentage":"percentage"===this.unitMode&&(this.unitMode="m2")},restore(e){this.grpRoomWithChildrenController.restoreItem(e).then((()=>{})).catch((e=>{console.error(e)}))},toggleRadarVisibility(){this.showRadar=!this.showRadar},buildAreaBeforeGrpRoom(){return this.data.map((e=>"Assigned"===e.operations?e.area:0))},buildAreaAfterGrpRoom(){return this.data.map((e=>{switch(e.operations){case"Assigned":return e.newArea;case"Not-assigned":case"AssignedToAnother":return 0;default:return e.area}}))},createStyleTitleSelectBefore(e){let t,i=e.operations,r=this.grpRoomWithChildrenController.getFutureOperation(e),o={height:"2em"};if(this.grpRoomWithChildrenController.selectedGrpRoom.children.find((t=>t.title===e.name)))return o.background=re.guessItemColor("Assigned"),o;switch(r){case"ToAssign":default:i="Not-assigned";break;case"ToReAssign":i="AssignedToAnother"}return t=re.guessItemColor(i),o.background=t,o},createColorPropChipsBefore(e,t="bg"){let i,r=e.operations,o=this.grpRoomWithChildrenController.getFutureOperation(e),a="";if(this.grpRoomWithChildrenController.selectedGrpRoom.children.find((t=>t.title===e.name)))return i=re.guessItemColor("Assigned"),a="white","bg"===t?`${i}`:a;switch(o){case"ToAssign":r="Not-assigned",a="white";break;case"ToReAssign":r="AssignedToAnother",a="white";break;default:a="white",r="Not-assigned"}return i=re.guessItemColor(r),"bg"===t?`${i}`:a},deleteChipFromRoomSelection(e){this.searchModel=this.searchModel.filter((t=>t!==e.dynamicId))},switchCategory(e){this.isLoadingData=!0,e&&"number"==typeof e?this.grpRoomWithChildrenController.switchCategories(e).then((e=>{this.reloadData(),this.isLoadingData=!1})).catch((e=>{console.error(e)})):e&&"object"==typeof e&&this.grpRoomWithChildrenController.switchCategories(e.id).then((e=>{this.reloadData(),this.isLoadingData=!1})).catch((e=>{console.error(e)}))}},computed:{availableRooms(){try{const e=this.$store.state.appDataStore.zoneSelected,t=this.grpRoomWithChildrenController.rooms.list,i=this.grpRoomWithChildrenController.rooms.list.filter((t=>t.floorId===e.dynamicId));return 0===e.level?t:i}catch(e){}return[]},searchBarPlaceholder(){return"GrpRoomList"===this.grpRoomFocus?"Recherchez un groupe de pièces":"Selectionner une ou plusieurs pièce(s)"},globalKpiClass(){return 0!==this.grpRoomWithChildrenController.totalGain.value?"greyed mini-text":""},gridClass(){switch(this.viewMode){case"radar-grid":return"grid-fullscreen";case"grid":return""}return""},dataFiltered(){return"GrpRoom"===this.grpRoomFocus?this.data:"GrpRoomList"===this.grpRoomFocus?this.data?.filter((e=>e?.title.toLowerCase().startsWith(this.searchModelGrp.toLowerCase()))):[]},dataRadar(){let e=[],t=[],i=[];const r={};return r.labels=e,r.datasets=[],this.data&&Array.isArray(this.data)&&0!==this.data.length?(e=this.data.map((e=>e.title)),"GrpRoomList"===this.grpRoomFocus?(i=this.data.map((e=>e.newArea)),t=this.data.map((e=>e.area))):"GrpRoom"===this.grpRoomFocus&&(i=this.buildAreaAfterGrpRoom(),t=this.buildAreaBeforeGrpRoom()),r.datasets.push({label:"Nouvelle superficie (m2)",data:i,fill:!0,backgroundColor:"rgba(255, 0, 2, 0.2)",borderColor:"rgb(255, 0, 2)",pointBackgroundColor:"rgb(255, 0, 2)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(255, 0, 2)"}),r.datasets.push({label:"Ancienne superficie (m2)",data:t,fill:!0,backgroundColor:"rgba(20,32,44, 0.4)",borderColor:"rgb(20,32,44)",pointBackgroundColor:"rgb(20,32,44)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(20,32,44)"}),r.labels=e,r):r},roomList(){return this.roomManager?this.roomManager.rooms:[]}},watch:{categoriesModel:function(e){this.switchCategory(e)}}},mi=(i(5059),(0,_e.A)(hi,Qt,[],!1,null,"e815e0ee",null).exports);!function(e){e.currentValue="Valeur courante",e.day="journée",e.week="Semaine",e.month="Mois",e.year="Année"}(ui||(ui={}));const gi={viewButtons:"base",sprites:!1,viewerInfo:{roomRef:!0,floorRef:!0,equipments:"none"},temporality:[ui.currentValue,ui.day,ui.week,ui.month,ui.year]};let fi=class extends ce.lD{PAGE_STATES=V;pageSate=V.loading;$store;openSpaceSelector=!1;openTemporalitySelector=!1;config=gi;spaceSelectorButtons=Re[gi.viewButtons];emitterHandler=void 0;roomManager;roomsGroupApi;viewerManager=void 0;dataTable=[];dataSideFullscreen=!1;$refs;showModalEditGroup=!1;showNomenclatureModale=!1;selectedRoom;legendSpaceAssignation=re.legendSpaceAssignation;currentExpansionMode="one-tier";expsEventAttached=!1;async mounted(){try{this.emitterHandler=j.t4.getInstance(),this.viewerManager=te.getInstance(),this.pageSate=V.loading,this.listenSpritesEvent(),this.listenSelectEvent(),this.selectedRoom=[],this.roomsGroupApi=new G,this.listenExpansionEvent(),this.pageSate=V.loaded}catch(e){this.pageSate=V.error}}activateSpaceAssignation(e){this.showModalEditGroup=!1,this.currentExpansionMode="one-tier",this.$refs.roomsGroupTable&&this.$refs.roomsGroupTable.loadData(e.id)}activateNomenclatureModale(){this.showModalEditGroup=!1,this.showNomenclatureModale=!0,this.$refs.nomenclatureModale&&this.$refs.nomenclatureModale.loadData()}listenExpansionEvent(){this.$refs.dataSideApp&&!this.expsEventAttached&&this.$refs.dataSideApp.$el.addEventListener("transitionend",(()=>{console.log("Transition ended"),this.expsEventAttached=!0,this.viewerManager.resize(),console.log(this.$refs.roomsGroupTable)}))}closeModaleEditGroup(){this.showModalEditGroup=!1}closeModaleNomenclature(){this.showNomenclatureModale=!1}get selectedZone(){return this.$store.state.appDataStore.zoneSelected}set selectedZone(e){this.$store.commit(Ze.SET_SELECTED_ZONE,e)}get temporalitySelected(){return this.$store.state.appDataStore.temporalitySelected}set temporalitySelected(e){this.$store.commit(Ze.SET_TEMPORALITY,e)}get classDataSide(){switch(this.currentExpansionMode){case"zero":return"app-container-zero";case"one-tier":return"";case"half":return"app-container-halfscreen";case"full":return"app-container-fullscreen"}}get classViewerContainer(){switch(this.currentExpansionMode){case"zero":return"viewerContainer-zero";case"one-tier":return"";case"half":return"viewerContainer-half";case"full":return"viewerContainer-invisible"}}toggleModaleEditGroup(){this.showModalEditGroup=!this.showModalEditGroup}openModaleEditGroup(){this.showModalEditGroup=!0}openNomenclatureModale(){this.$refs.nomenclatureModale&&this.$refs.nomenclatureModale.loadData(),this.showNomenclatureModale=!0}async onSpaceSelectOpen(e){switch(e?.type){case void 0:const t=localStorage.getItem("idBuilding"),i=[this.$store.dispatch(B.GET_BUILDING_BY_ID,{buildingId:t})],[r,o]=await Promise.all(i);return[{name:r.name,staticId:r.id,categories:[],color:"#35CAE5",dynamicId:0,type:"building"}];case"building":return await this.$store.dispatch(B.GET_FLOORS,{buildingId:e.staticId,patrimoineId:e.patrimoineId});case"geographicFloor":return await this.$store.dispatch(B.GET_ROOMS,{floorId:e.dynamicId,buildingId:e.buildingId,patrimoineId:e.patrimoineId,id:e.dynamicId});default:return[]}}onTemporalitySelectOpen(e){return void 0===e?.type?gi.temporality.map(((e,t)=>({name:e,staticId:t,dynamicId:t,level:0,isOpen:!0,loading:!1,parents:[],drawLink:[],haveChildren:!1,type:"time"}))):[]}updateExpansion(e){console.log("New Expansion = ",e),this.currentExpansionMode=e,console.log("Refs = ",this.$refs),this.listenExpansionEvent(),this.$refs.roomsGroupTable.setViewModeByExpansion(this.currentExpansionMode)}onGoBack(){const e=this.$refs["space-selector"].getParentOfSelected();e&&(this.selectedZone=e)}getItemData(e){const t={platformId:this.selectedZone.platformId,id:new Set},i=Array.isArray(e)?e:[e];for(const e of i)t.id.add(e.dynamicId);return{platformId:t.platformId,id:t.id.size>0?Array.from(t.id):t.id.values().next().value}}toggleFullscreen(){this.dataSideFullscreen=!this.dataSideFullscreen}async onDataViewClicked(e){e&&(this.$store.commit(Ze.SET_ITEM_SELECTED,e),this.$store.dispatch(B.SELECT_SPRITES,[e.dynamicId]))}async onColor(e){}onActionClick({button:e,item:t}){const i={buildingId:t.buildingId,staticId:t.staticId,id:t.dynamicId,dynamicId:t.dynamicId,floorId:t.floorId,roomId:t.roomId,type:t.type};switch(e.onclickEvent){case B.OPEN_VIEWER:this.$store.dispatch(e.onclickEvent,{onlyThisModel:!0,config:this.config,item:i});break;case"OPEN_VIEWER_PLUS":this.$store.dispatch(B.OPEN_VIEWER,{onlyThisModel:!1,config:this.config,item:i});break;default:this.$store.dispatch(e.onclickEvent,i)}}listenSpritesEvent(){this.emitterHandler.on(j.UK,(e=>{if(this.$store.commit(Ze.SET_ITEM_SELECTED,e.node),e.node.dynamicId){const t=document.createElement("a");t.setAttribute("href",`#${e.node.dynamicId}`),t.click()}}))}async listenSelectEvent(){}selectRoom(e){this.roomManager?.getRoomByDynamicId(e?.dynamicId)}get displayedData(){return this.$store.state.appDataStore.data}get selectedEntities(){return this.$store.state.appDataStore.selectedRooms}getDataFormatted(){return[this._getHeader(),...this._getRows(this.displayedData)]}toggleHomeMode(){this.showModalEditGroup=!1,this.currentExpansionMode="zero"}_getHeader(){return{id:"id",name:"name",type:"type",value:"value"}}_getRows(e){return e?e.map((({color:e,displayValue:t,name:i,staticId:r,type:o})=>({name:i,type:o,value:Number.parseFloat(t).toFixed(2),id:r}))):[]}};fi=function(e,t,i,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(s=(a<3?o(s):a>3?o(t,i,s):o(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s}([(0,He.Ay)({components:{SpaceSelector:Ae,viewerApp:We,ScDownloadButton:Ce.A,dataSideApp:Xe,ModaleEditGroup:Rt,RoomsGroupTable:mi,LegendVue:Gt,Expansion:Dt,MenuV1:Lt,NomenclatureModale:Yt}})],fi);var vi=fi,_i=(i(6582),i(1343),(0,_e.A)(vi,m,[],!1,null,"626f5be7",null).exports),yi=i(3071),bi=i(651);const wi={buildings:[],zoneSelected:{buildingId:"",name:"Bâtiments",staticId:"",categories:[],color:"#FFFFFF",dynamicId:0,type:"building",level:0,isOpen:!0,loading:!1,patrimoineId:"patrimoineId",parents:[],isLastInGrp:!0,drawLink:[],haveChildren:!0},temporalitySelected:{patrimoineId:"",name:"Valeur courante",staticId:0,categories:[],color:"#FFFFFF",dynamicId:0,type:"time",level:0,isOpen:!0,loading:!1,parents:[],isLastInGrp:!0,drawLink:[],haveChildren:!0},floors:{},rooms:{},roomBimObj:{},buildingInfo:{},viewerStartedList:{},itemSelected:void 0,dataVizExtn:void 0,data:void 0,selectedRooms:Array};async function Ii(e){const t=s.getInstance(),i=t.createUrl(`api/v1/pam/get_all_buildings_from_portofolio/${e}`);return(await t.get(i)).data}async function xi(e){const t=s.getInstance(),i=t.createUrl(`api/v1/pam/get_building/${e}`);return(await t.get(i)).data}async function Ai(e,t){let i;i=e.entryPoint.context&&!e.entryPoint.category?await async function(e,t){const i=await Ti(e,t);if(!i)throw`No group context found with name ${t}`;const r=s.getInstance(),o=r.createUrlWithPlatformId(e,`/api/v1/groupContext/${i.dynamicId}/tree`);return(await r.get(o)).data}(t,e.entryPoint.context):await async function(e,t){const i=await Ti(e,t.context);if(!i)throw`No group context found with name ${t.context}`;return i.children=await async function(e,t,i){const r=await async function(e,t,i){const r=s.getInstance(),o=r.createUrlWithPlatformId(t,`/api/v1/groupeContext/${e}/category_list`);let a=await r.get(o);return i?a.data.filter((e=>e.name===i)):a.data}(t,e,i.category),o=r.map((async r=>(r.children=await async function(e,t,i,r){const o=await async function(e,t,i,r){const o=s.getInstance(),a=o.createUrlWithPlatformId(i,`/api/v1/groupeContext/${e}/category/${t}/group_list`);let n=await o.get(a);return r?n.data.reduce(((i,o,a,s)=>(o.name===r&&(o.categoryId=t,o.contextId=e,i.push(o),s.slice(a-1)),i)),[]):n.data.map((i=>(i.categoryId=t,i.contextId=e,i)))}(t,i,e,r.group),a=o.map((async r=>(r.children=await async function(e,t,i,r){let o;if("geographicRoomGroup"===r.type&&(o=`/api/v1/roomsGroup/${t}/category/${i}/group/${r.dynamicId}/roomList`),"BIMObjectGroup"===r.type&&(o=`/api/v1/equipementsGroup/${t}/category/${i}/group/${r.dynamicId}/equipementList`),o){const t=s.getInstance(),i=t.createUrlWithPlatformId(e,o);return(await t.get(i)).data||[]}return[]}(e,t,i,r),r)));return Promise.all(a)}(e,t,r.dynamicId,i),r)));return Promise.all(o)}(e,i.dynamicId,t),i}(t,e.entryPoint);const r=function(e){return(e.children||[]).reduce(((e,t)=>{const i=(t.children||[]).map((e=>e.children||[]));return e.push(...i.flat()),e}),[{}])}(i);return async function(e,t){const{dynamicIds:i,type:r,obj:o}=t.reduce(((e,t)=>(void 0===t?.dynamicId||(e.type=t.type,e.dynamicIds.push(t.dynamicId),e.obj[t.dynamicId]=t),e)),{dynamicIds:[],type:void 0,obj:{}}),a=await function(e,t,i,r=500){let o="/api/v1/equipment/get_position_multiple";"geographicRoom"===i&&(o="/api/v1/room/get_position_multiple");const a=Ht.chunk(t,r).map((t=>async function(e,t,i){const r=s.getInstance(),o=r.createUrlWithPlatformId(e,i);return(await r.post(o,t)).data||[]}(e,t,o)));return Promise.allSettled(a).then((e=>e.reduce(((e,{status:t,value:i})=>("fulfilled"===t&&e.push(...i),e)),[])))}(e,i,r,200);let n=new Map;return n.set(r,o),n.set("groupType",r),function(e,t,i){const r={},o={},a={};for(const{info:t,dynamicId:s}of e){if(!t)continue;const e=i[s],{building:l,floor:c,room:d}=t;e.buildingId=l.dynamicId,e.floorId=c?.dynamicId,e.roomId=d?.dynamicId,n(r,l,e),n(o,c,e),n(a,d,e)}return s("geographicBuilding",r),s("geographicFloor",o),s("geographicRoom",a),t;function s(e,i){for(const r in i)if(Object.prototype.hasOwnProperty.call(i,r)){const o=i[r];Ri(t,e,o)}}function n(e,t,i){t&&(e[t.dynamicId]||(t.children=[],e[t.dynamicId]=t),e[t.dynamicId].children.push(i))}}(a,n,o)}(t,r)}async function Ci(e,t){let i=await Ti(e,t);if(!i)throw new Error(`[regroupment] - No group context found for ${t}`);i=Array.isArray(i)?i:[i];const r=i.filter((e=>-1!==["BIMObjectGroupContext","geographicRoomGroupContext"].indexOf(e.type))).map((async t=>async function(e,t){const i=s.getInstance(),r=i.createUrlWithPlatformId(t,`/api/v1/context/${e}/tree/2/depth`);return(await i.get(r)).data}(t.dynamicId,e)));return Promise.all(r).then((e=>e.flat().reduce(((e,t)=>{const i=t.children;for(const r of i)e[r.name]||(e[r.name]=[]),e[r.name].push(...Ei(r.children,t.dynamicId,r.dynamicId));return e}),{})))}function Ei(e,t,i){return e.map((e=>(e.categoryId=i,e.contextId=t,e)))}function Ri(e,t,i){let r=e.get(t);r||(r={}),r[i.dynamicId]=i,e.set(t,r)}async function Ti(e,t){const i=s.getInstance(),r=i.createUrlWithPlatformId(e,"/api/v1/groupContext/list");let o=await i.get(r);return t?o.data.find((e=>e.name===t)):o.data}const Si={},Gi={async[B.GET_BUILDINGS]({commit:e,state:t},{patrimoineId:i,forceUpdate:r}){const o=s.getInstance();void 0===Si[B.GET_BUILDINGS]&&(Si[B.GET_BUILDINGS]={}),void 0!==Si[B.GET_BUILDINGS][i]&&!0!==r||(Si[B.GET_BUILDINGS][i]=o.createIteratorCall(Ii,i));const a=await Si[B.GET_BUILDINGS][i].next();return e(Ze.SET_BUILDINGS,a.value),a.value},async[B.GET_BUILDING_BY_ID]({commit:e,state:t},{buildingId:i,forceUpdate:r}){const o=s.getInstance();return void 0===Si[B.GET_BUILDING_BY_ID]&&(Si[B.GET_BUILDING_BY_ID]={}),void 0!==Si[B.GET_BUILDING_BY_ID][i]&&!0!==r||(Si[B.GET_BUILDING_BY_ID][i]=o.createIteratorCall(xi,i)),(await Si[B.GET_BUILDING_BY_ID][i].next()).value},async[B.GET_FLOORS]({commit:e},{buildingId:t,patrimoineId:i,forceUpdate:r}){const o=s.getInstance();void 0===Si[B.GET_FLOORS]&&(Si[B.GET_FLOORS]={});const a=Si[B.GET_FLOORS];void 0!==a[t]&&!0!==r||(a[t]=o.createIteratorCall(M,i,t));const n=await a[t].next();return e(Ze.SET_FLOORS,{id:t,items:n.value}),n.value},async[B.GET_ROOMS]({commit:e},{buildingId:t,patrimoineId:i,floorId:r,id:o,forceUpdate:a}){const n=s.getInstance();void 0===Si[B.GET_ROOMS]&&(Si[B.GET_ROOMS]={});const l=Si[B.GET_ROOMS];void 0!==l[o]&&!0!==a||(l[o]=n.createIteratorCall(k,i,t,r,o));const c=await l[o].next();return e(Ze.SET_ROOMS,{id:o,items:c.value}),c.value},async[B.GET_EQUIPMENTS]({commit:e},{floorId:t,roomId:i,patrimoineId:r,buildingId:o,id:a,forceUpdate:n}){const l=s.getInstance();void 0===Si[B.GET_EQUIPMENTS]&&(Si[B.GET_EQUIPMENTS]={});const c=Si[B.GET_EQUIPMENTS];void 0!==c[a]&&!0!==n||(c[a]=l.createIteratorCall(D,r,o,t,i,a));const d=await c[a].next();return e(Ze.SET_EQUIPMENTS,{id:a,items:d.value}),d.value},async[B.GET_GROUPS_ITEMS]({commit:e,state:t},{forceUpdate:i,config:r,buildingId:o}){const a=s.getInstance();void 0===Si[B.GET_GROUPS_ITEMS]&&(Si[B.GET_GROUPS_ITEMS]={}),(void 0===Si[B.GET_GROUPS_ITEMS][o]||i)&&(Si[B.GET_GROUPS_ITEMS][o]=a.createIteratorCall(Ai,r,o));const n=await Si[B.GET_GROUPS_ITEMS][o].next();return n?.value},async[B.GET_CATEGORIES_TREE]({commit:e,state:t},{forceUpdate:i,buildingId:r,context:o}){const a=s.getInstance();void 0===Si[B.GET_CATEGORIES_TREE]&&(Si[B.GET_CATEGORIES_TREE]={}),(void 0===Si[B.GET_CATEGORIES_TREE][r]||i)&&(Si[B.GET_CATEGORIES_TREE][r]=a.createIteratorCall(Ci,r,o));const n=await Si[B.GET_CATEGORIES_TREE][r].next();return n?.value},async[B.OPEN_VIEWER]({commit:e,dispatch:t,state:i},r){try{const o=r.config.viewerInfo,a={dynamicId:[r.item.dynamicId],roomRef:o.roomRef,floorRef:o.floorRef,equipements:!1,dbIdsToAdd:[]};if("all"===o.equipments)a.equipements=!0,a.dbIdsToAdd=[];else if("groupItem"===o.equipments){a.equipements=!1;const e=await t(B.GET_GROUPS_ITEMS,{config:r.config,buildingId:r.item.buildingId});a.dbIdsToAdd=function(e,t,i){const r=e.get(i);let o=[];if(r&&r[t]){const e=(r[t].children||[]).reduce(((e,t)=>(e[t.bimFileId]?e[t.bimFileId].dbIds.push(t.dbid):e[t.bimFileId]={bimFileId:t.bimFileId,dbIds:[t.dbid]},e)),{});o=Array.from(Object.values(e))}return o}(e,r.item.dynamicId,r.item.type)}await ie.getInstance().loadInViewer(r.item,r.onlyThisModel,a),r.onlyThisModel&&(i.viewerStartedList={}),e(Ze.ADD_VIEWER_LOADED,{id:r.item.dynamicId})}catch(e){console.log("errror",e)}},async[B.GET_VIEWER_INFO]({commit:e,state:t},i){return ie.getInstance().getViewerInfoMerged(i)},[B.SELECT_ITEMS]({commit:e,dispatch:t,state:i},r){console.log("Pas encore appele"),ie.getInstance().select(r)},[B.ISOLATE_ITEMS]({commit:e,dispatch:t,state:i},r){ie.getInstance().isolate(r)},[B.FIT_TO_VIEW_ITEMS]({commit:e,dispatch:t,state:i},r){ie.getInstance().fitToView(r)},async[B.UNLOAD_MODEL]({commit:e,dispatch:t,state:i},r){await ie.getInstance().unload(r),Array.isArray(r)||(r=[r]);for(const t of r)e(Ze.REMOVE_VIEWER_LOADED,{id:t.dynamicId})},[B.COLOR_ITEMS]({commit:e,dispatch:t,state:i},{items:r,buildingId:o}){return ie.getInstance().colorItems(r,o)},[B.ADD_SPRITES]({commit:e,dispatch:t,state:i},{items:r,buildingId:o}){return ie.getInstance().addSprites(r,o)},[B.ADD_COMPONENT_AS_SPRITES]({commit:e,dispatch:t,state:i},{items:r,buildingId:o,component:a}){return ie.getInstance().addComponentAsSprites(r,o,a)},[B.REMOVE_ALL_SPRITES]({commit:e,dispatch:t,state:i}){return Fe.getInstance().removeSprites()},[B.SELECT_SPRITES]({commit:e,dispatch:t,state:i},r){return Fe.getInstance().selectSprites(r)}};c.Ay.use(bi.Ay);const Mi=new bi.Ay.Store({modules:{appDataStore:{state:wi,mutations:qe,actions:Gi,getters:{}}}});var ki=i(427);i(2606),s.getInstance("http://localhost:2023"),c.Ay.use(ki.Ay),c.Ay.use(yi.A);const Di=new yi.A({theme:{themes:{light:{primary:"#14202c",secondary:"#f9f9f9",accent:"#14202c"}}}});new c.Ay({vuetify:Di,store:Mi,render:e=>e(_i)}).$mount("#app")},3104:function(){void 0===window.global&&(window.global=window)},6582:function(e,t,i){var r=i(7785);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("7a581ba2",r,!1,{})},1343:function(e,t,i){var r=i(422);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("2137c577",r,!1,{})},2165:function(e,t,i){var r=i(5442);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("69c79853",r,!1,{})},7409:function(e,t,i){var r=i(9890);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("414e91c9",r,!1,{})},1356:function(e,t,i){var r=i(1303);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("d6fe565a",r,!1,{})},121:function(e,t,i){var r=i(7074);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("6265246b",r,!1,{})},1040:function(e,t,i){var r=i(7273);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("6e864e38",r,!1,{})},2494:function(e,t,i){var r=i(5780);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("c7522966",r,!1,{})},214:function(e,t,i){var r=i(934);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("63afeeed",r,!1,{})},8780:function(e,t,i){var r=i(3787);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("2127caa4",r,!1,{})},1057:function(e,t,i){var r=i(4832);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("d4efb784",r,!1,{})},5636:function(e,t,i){var r=i(6849);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("01668214",r,!1,{})},2655:function(e,t,i){var r=i(9516);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("33a840ad",r,!1,{})},4430:function(e,t,i){var r=i(425);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("53561d9f",r,!1,{})},5499:function(e,t,i){var r=i(5030);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("049404be",r,!1,{})},5059:function(e,t,i){var r=i(8164);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("3e6186f2",r,!1,{})},7817:function(e,t,i){var r=i(4690);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("6be44d83",r,!1,{})},2595:function(e,t,i){var r=i(5702);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("1cd73414",r,!1,{})},3991:function(e,t,i){var r=i(9424);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(4424).A)("1c31cac4",r,!1,{})},7363:function(e){"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTY0IiBoZWlnaHQ9IjE2NCIgdmlld0JveD0iMCAwIDE2NCAxNjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8ZyBmaWx0ZXI9InVybCgjZmlsdGVyMF9kKSI+CiAgICAgICAgPGNpcmNsZSBjeD0iODEuNzM2MyIgY3k9IjgxLjgyMTIiIHI9IjcwLjMzODkiIGZpbGw9IiM1MzUzNTMiIC8+CiAgICAgICAgPGNpcmNsZSBjeD0iODEuNzM2MyIgY3k9IjgxLjgyMTIiIHI9IjYyLjMxMTIiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMTYuMDU1NCIgLz4KICAgIDwvZz4KICAgIDxkZWZzPgogICAgICAgIDxmaWx0ZXIgaWQ9ImZpbHRlcjBfZCIgeD0iMC4xNzQ3NjMiIHk9IjAuMjU5NjAyIiB3aWR0aD0iMTYzLjEyMyIgaGVpZ2h0PSIxNjMuMTIzIiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+CiAgICAgICAgICAgIDxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4IiAvPgogICAgICAgICAgICA8ZmVDb2xvck1hdHJpeCBpbj0iU291cmNlQWxwaGEiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIgLz4KICAgICAgICAgICAgPGZlT2Zmc2V0IC8+CiAgICAgICAgICAgIDxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjUuNjExMzUiIC8+CiAgICAgICAgICAgIDxmZUNvbG9yTWF0cml4IHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwLjI1IDAiIC8+CiAgICAgICAgICAgIDxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93IiAvPgogICAgICAgICAgICA8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImVmZmVjdDFfZHJvcFNoYWRvdyIgcmVzdWx0PSJzaGFwZSIgLz4KICAgICAgICA8L2ZpbHRlcj4KICAgIDwvZGVmcz4KPC9zdmc+"}},function(e){e.O(0,[96],(function(){return 5459,e(e.s=5459)})),e.O()}]);